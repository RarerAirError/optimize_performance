var Fc=Object.create;var Za=Object.defineProperty;var xc=Object.getOwnPropertyDescriptor;var Ic=Object.getOwnPropertyNames;var Ac=Object.getPrototypeOf,Ec=Object.prototype.hasOwnProperty;var Xa=i=>{throw TypeError(i)};var Qt=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var Tc=(i,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Ic(e))!Ec.call(i,s)&&s!==t&&Za(i,s,{get:()=>e[s],enumerable:!(r=xc(e,s))||r.enumerable});return i};var Qa=(i,e,t)=>(t=i!=null?Fc(Ac(i)):{},Tc(e||!i||!i.__esModule?Za(t,"default",{value:i,enumerable:!0}):t,i));var Bo=(i,e,t)=>e.has(i)||Xa("Cannot "+t);var n=(i,e,t)=>(Bo(i,e,"read from private field"),t?t.call(i):e.get(i)),l=(i,e,t)=>e.has(i)?Xa("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),a=(i,e,t,r)=>(Bo(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t),h=(i,e,t)=>(Bo(i,e,"access private method"),t);var Ya=(i,e,t,r)=>({set _(s){a(i,e,s,t)},get _(){return n(i,e,r)}});var la=Qt(($b,ml)=>{var Gm=Object.prototype.toString;ml.exports=function(e){if(e===void 0)return"undefined";if(e===null)return"null";var t=typeof e;if(t==="boolean")return"boolean";if(t==="string")return"string";if(t==="number")return"number";if(t==="symbol")return"symbol";if(t==="function")return Km(e)?"generatorfunction":"function";if(Jm(e))return"array";if(Qm(e))return"buffer";if(Xm(e))return"arguments";if(qm(e))return"date";if(zm(e))return"error";if($m(e))return"regexp";switch(cl(e)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(Zm(e))return"generator";switch(t=Gm.call(e),t){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return t.slice(8,-1).toLowerCase().replace(/\s/g,"")};function cl(i){return typeof i.constructor=="function"?i.constructor.name:null}function Jm(i){return Array.isArray?Array.isArray(i):i instanceof Array}function zm(i){return i instanceof Error||typeof i.message=="string"&&i.constructor&&typeof i.constructor.stackTraceLimit=="number"}function qm(i){return i instanceof Date?!0:typeof i.toDateString=="function"&&typeof i.getDate=="function"&&typeof i.setDate=="function"}function $m(i){return i instanceof RegExp?!0:typeof i.flags=="string"&&typeof i.ignoreCase=="boolean"&&typeof i.multiline=="boolean"&&typeof i.global=="boolean"}function Km(i,e){return cl(i)==="GeneratorFunction"}function Zm(i){return typeof i.throw=="function"&&typeof i.return=="function"&&typeof i.next=="function"}function Xm(i){try{if(typeof i.length=="number"&&typeof i.callee=="function")return!0}catch(e){if(e.message.indexOf("callee")!==-1)return!0}return!1}function Qm(i){return i.constructor&&typeof i.constructor.isBuffer=="function"?i.constructor.isBuffer(i):!1}});var hl=Qt((Kb,gl)=>{"use strict";var pl=Symbol.prototype.valueOf,Ym=la();function ep(i,e){switch(Ym(i)){case"array":return i.slice();case"object":return Object.assign({},i);case"date":return new i.constructor(Number(i));case"map":return new Map(i);case"set":return new Set(i);case"buffer":return np(i);case"symbol":return sp(i);case"arraybuffer":return ip(i);case"float32array":case"float64array":case"int16array":case"int32array":case"int8array":case"uint16array":case"uint32array":case"uint8clampedarray":case"uint8array":return rp(i);case"regexp":return tp(i);case"error":return Object.create(i);default:return i}}function tp(i){let e=i.flags!==void 0?i.flags:/\w+$/.exec(i)||void 0,t=new i.constructor(i.source,e);return t.lastIndex=i.lastIndex,t}function ip(i){let e=new i.constructor(i.byteLength);return new Uint8Array(e).set(new Uint8Array(i)),e}function rp(i,e){return new i.constructor(i.buffer,i.byteOffset,i.length)}function np(i){let e=i.length,t=Buffer.allocUnsafe?Buffer.allocUnsafe(e):Buffer.from(e);return i.copy(t),t}function sp(i){return pl?Object(pl.call(i)):{}}gl.exports=ep});var bl=Qt((Zb,fl)=>{"use strict";fl.exports=function(e){return e!=null&&typeof e=="object"&&Array.isArray(e)===!1}});var kl=Qt((Xb,vl)=>{"use strict";var op=bl();function yl(i){return op(i)===!0&&Object.prototype.toString.call(i)==="[object Object]"}vl.exports=function(e){var t,r;return!(yl(e)===!1||(t=e.constructor,typeof t!="function")||(r=t.prototype,yl(r)===!1)||r.hasOwnProperty("isPrototypeOf")===!1)}});var Sl=Qt((Qb,Cl)=>{"use strict";var ap=hl(),dp=la(),lp=kl();function ua(i,e){switch(dp(i)){case"object":return up(i,e);case"array":return cp(i,e);default:return ap(i)}}function up(i,e){if(typeof e=="function")return e(i);if(e||lp(i)){let t=new i.constructor;for(let r in i)t[r]=ua(i[r],e);return t}return i}function cp(i,e){let t=new i.constructor(i.length);for(let r=0;r<i.length;r++)t[r]=ua(i[r],e);return t}Cl.exports=ua});var mc=Qt(ho=>{"use strict";ho.byteLength=Hp;ho.toByteArray=Wp;ho.fromByteArray=Jp;var Oe=[],Pe=[],_p=typeof Uint8Array<"u"?Uint8Array:Array,ja="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Vt=0,uc=ja.length;Vt<uc;++Vt)Oe[Vt]=ja[Vt],Pe[ja.charCodeAt(Vt)]=Vt;var Vt,uc;Pe[45]=62;Pe[95]=63;function cc(i){var e=i.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=i.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Hp(i){var e=cc(i),t=e[0],r=e[1];return(t+r)*3/4-r}function jp(i,e,t){return(e+t)*3/4-t}function Wp(i){var e,t=cc(i),r=t[0],s=t[1],o=new _p(jp(i,r,s)),d=0,c=s>0?r-4:r,m;for(m=0;m<c;m+=4)e=Pe[i.charCodeAt(m)]<<18|Pe[i.charCodeAt(m+1)]<<12|Pe[i.charCodeAt(m+2)]<<6|Pe[i.charCodeAt(m+3)],o[d++]=e>>16&255,o[d++]=e>>8&255,o[d++]=e&255;return s===2&&(e=Pe[i.charCodeAt(m)]<<2|Pe[i.charCodeAt(m+1)]>>4,o[d++]=e&255),s===1&&(e=Pe[i.charCodeAt(m)]<<10|Pe[i.charCodeAt(m+1)]<<4|Pe[i.charCodeAt(m+2)]>>2,o[d++]=e>>8&255,o[d++]=e&255),o}function Vp(i){return Oe[i>>18&63]+Oe[i>>12&63]+Oe[i>>6&63]+Oe[i&63]}function Gp(i,e,t){for(var r,s=[],o=e;o<t;o+=3)r=(i[o]<<16&16711680)+(i[o+1]<<8&65280)+(i[o+2]&255),s.push(Vp(r));return s.join("")}function Jp(i){for(var e,t=i.length,r=t%3,s=[],o=16383,d=0,c=t-r;d<c;d+=o)s.push(Gp(i,d,d+o>c?c:d+o));return r===1?(e=i[t-1],s.push(Oe[e>>2]+Oe[e<<4&63]+"==")):r===2&&(e=(i[t-2]<<8)+i[t-1],s.push(Oe[e>>10]+Oe[e>>4&63]+Oe[e<<2&63]+"=")),s.join("")}});function p(i,e){if(i==null)throw Error(e??"Expected nonnullish value.")}function Ct(i,e){if(!i)throw Error(e)}var ee;(function(i){i.COMMENT="t1_",i.ACCOUNT="t2_",i.LINK="t3_",i.MESSAGE="t4_",i.SUBREDDIT="t5_",i.AWARD="t6_"})(ee||(ee={}));function Ve(i){return i.startsWith(ee.COMMENT)}function Os(i){return i.startsWith(ee.ACCOUNT)}function St(i){return i.startsWith(ee.LINK)}function ed(i){return i.startsWith(ee.MESSAGE)}function td(i){return i.startsWith(ee.SUBREDDIT)}function id(i){return i.startsWith(ee.AWARD)}function Rc(i){Ct(Ve(i),`Expected comment id to start with ${ee.COMMENT}, got ${i}}`)}function Oc(i){Ct(Os(i),`Expected account id to start with ${ee.ACCOUNT}, got ${i}}`)}function Mc(i){Ct(St(i),`Expected link id to start with ${ee.LINK}, got ${i}}`)}function Bc(i){Ct(ed(i),`Expected message id to start with ${ee.MESSAGE}, got ${i}}`)}function Uc(i){Ct(td(i),`Expected subreddit id to start with ${ee.SUBREDDIT}, got ${i}}`)}function Dc(i){Ct(id(i),`Expected award id to start with ${ee.AWARD}, got ${i}}`)}function Yt(i){return Rc(i),i}function te(i){return Oc(i),i}function de(i){return Mc(i),i}function Nc(i){return Bc(i),i}function $(i){return Uc(i),i}function Lc(i){return Dc(i),i}function he(i){if(Ve(i))return Yt(i);if(Os(i))return te(i);if(St(i))return de(i);if(ed(i))return Nc(i);if(td(i))return $(i);if(id(i))return Lc(i);throw new Error(`Expected thing id to start with ${Object.values(ee).join(", ")} got ${i}}`)}function Uo(i){return Ve(i)}import*as k from"@devvit/protos";var Ms=class{constructor(e){}};var Do=(t=>(t.Installation="installation",t.App="app",t))(Do||{});function Pt(i,e=new Set){for(let t of i){if(t.type==="group"){Pt(t.fields,e);continue}let r=t.name;if(e.has(r))throw new Error(`Duplicate field name: ${r}`);e.add(r)}_c(i)}function _c(i){for(let e of i)if(e.type==="string"&&e.isSecret&&e.scope!=="app")throw`Invalid setting: only app settings can be secrets. Add "scope: SettingScope.App" to field "${e.name}"`}var Ge=Object.freeze({INTERVAL:0,FORM:1,STATE:2,CHANNEL:3,WEB_VIEW:4});var xg=["3rd-party","activity","add-emoji","add","add-media","add-to-feed","admin","ads","ai","align-center","align-left","align-right","all","ama","appearance","approve","archived","aspect-ratio","aspect-rectangle","attach","audience","audio","author","automod","avatar-style","award","back","backup","ban","best","block","blockchain","bold","boost","bot","bounce","brand-awareness","browse","browser","cake","calendar","camera","campaign","caret-down","caret-left","caret-right","caret-up","chat","chat-group","chat-new","chat-private","checkbox-dismiss","checkbox","checkmark","chrome","clear","client-list","close","closed-captioning","code-block","code-inline","coins-color-old","coins","collapse-left","collapse-right","collectible-expressions","collection","comment","comments","communities","community","confidence","contest","controversial","conversion","copy-clipboard","crop","crosspost","crowd-control","custom-feed","customize","dashboard","day","delete-column","delete","delete-row","devvit","discover","dismiss-all","distinguish","down-arrow","down","download","downvote","downvotes","drag","drugs","duplicate","edit","effect","embed","emoji","end-live-chat","error","expand-left","expand-right","external","feed-video","filter","format","forward","funnel","gif-post","gold","hashtag","heart","help","hide","history","home","hot","ignore-reports","image-post","inbox","info","insert-column-left","insert-column-right","insert-row-above","insert-row-below","internet","invite","italic","join","joined","jump-down","jump-up","karma","keyboard","kick","language","leave","left","link","link-post","list-bulleted","list-numbered","live-chat","live","load","location","lock","logout","loop","macro","mark-read","marketplace","mask","media-gallery","meme","menu","message","mic","mic-mute","mod","mod-mail","mod-mode","mod-mute","mod-overflow","mod-queue","mod-unmute","music","mute","new","night","no-internet","notification","notification-frequent","notification-off","nsfw","nsfw-language","nsfw-violence","official","original","overflow-caret","overflow-horizontal","overflow-vertical","pause","payment","peace","pending-posts","phone","pin","play","poll-post","popular","posts","powerup","predictions","premium","privacy","profile","qa","qr-code","quarantined","quote","r-slash","radar","radio-button","raise-hand","random","ratings-everyone","ratings-mature","ratings-nsfw","ratings-violence","recovery-phrase","refresh","removal-reasons","remove","reply","report","reverse","rich-text","right","rising","rotate","rotate-image","rpan","rules","safari","save","save-view","saved","saved-response","search","self","send","settings","severity","share","share-new","show","side-menu","skipback10","skipforward10","sort-az","sort","sort-price","sort-za","spam","spoiler","sponsored","spreadsheet","star","statistics","status-live","sticker","strikethrough","subtract","superscript","swap-camera","swipe-back","swipe-down","swipe","swipe-up","table","tag","tap","text","text-post","text-size","toggle","tools","top","topic-activism","topic-addictionsupport","topic-advice","topic-animals","topic-anime","topic-art","topic-beauty","topic-business","topic-careers","topic-cars","topic-celebrity","topic-craftsdiy","topic-crypto","topic-culture","topic-diy","topic-entertainment","topic-ethics","topic-family","topic-fashion","topic","topic-fitness","topic-food","topic-funny","topic-gender","topic-health","topic-help","topic-history","topic-hobbies","topic-homegarden","topic-internet","topic-law","topic-learning","topic-lifestyle","topic-marketplace","topic-mature","topic-mensfashion","topic-menshealth","topic-meta","topic-military","topic-movies","topic-music","topic-news","topic-other","topic-outdoors","topic-pets","topic-photography","topic-places","topic-podcasts","topic-politics","topic-programming","topic-reading","topic-religion","topic-science","topic-sexorientation","topic-sports","topic-style","topic-tabletop","topic-technology","topic-television","topic-traumasupport","topic-travel","topic-videogaming","topic-womensfashion","topic-womenshealth","translate","translation-off","trim","u-slash","unban","undo","unheart","unlock","unmod","unpin","unstar","unverified","up-arrow","up","upload","upvote","upvotes","user","user-note","users","vault","verified","video-camera","video-feed","video-post","video-thread","video-transcription","view-card","view-classic","view-compact","view-grid","view-sort","views","volume","wallet","warning","webhook","whale","wiki-ban","wiki","wiki-unban","world","coins-color","powerup-color","powerup-fill-color","share-android","share-ios","video-live-1","video-live-fill-1","video-live","volume-mute","binoculars","caret-updown","planet","telescope"];import{AppSettingsDefinition as em,GetFieldsResponse as tm}from"@devvit/protos";import{FormFieldType as fe}from"@devvit/protos";function Ue(i){return i.map(e=>{switch(e.type){case"string":return Hc(e);case"image":return jc(e);case"paragraph":return Wc(e);case"number":return Vc(e);case"select":return Gc(e);case"boolean":return Jc(e);case"group":return zc(e);default:throw new Error("Unknown field type.")}})}function Hc(i){return{defaultValue:{fieldType:fe.STRING,stringValue:i.defaultValue},disabled:i.disabled,fieldConfig:{stringConfig:{placeholder:i.placeholder}},fieldId:i.name,fieldType:fe.STRING,helpText:i.helpText,label:i.label,required:i.required,isSecret:i.isSecret}}function jc(i){return{disabled:i.disabled,fieldId:i.name,fieldType:fe.IMAGE,helpText:i.helpText,label:i.label,required:i.required}}function Wc(i){return{defaultValue:{fieldType:fe.PARAGRAPH,stringValue:i.defaultValue},disabled:i.disabled,fieldConfig:{paragraphConfig:{lineHeight:i.lineHeight,placeholder:i.placeholder}},fieldId:i.name,fieldType:fe.PARAGRAPH,helpText:i.helpText,label:i.label,required:i.required}}function Vc(i){return{defaultValue:{fieldType:fe.NUMBER,numberValue:i.defaultValue},disabled:i.disabled,fieldConfig:{numberConfig:{}},fieldId:i.name,fieldType:fe.NUMBER,helpText:i.helpText,label:i.label,required:i.required}}function Gc(i){return{defaultValue:{fieldType:fe.SELECTION,selectionValue:{values:i.defaultValue??[]}},disabled:i.disabled,fieldConfig:{selectionConfig:{choices:i.options,multiSelect:i.multiSelect}},fieldId:i.name,fieldType:fe.SELECTION,helpText:i.helpText,label:i.label,required:i.required}}function Jc(i){return{defaultValue:{fieldType:fe.BOOLEAN,boolValue:i.defaultValue},disabled:i.disabled,fieldId:i.name,fieldType:fe.BOOLEAN,helpText:i.helpText,label:i.label}}function zc(i){return{fieldId:"",fieldType:fe.GROUP,fieldConfig:{groupConfig:{fields:Ue(i.fields)}},label:i.label,helpText:i.helpText}}function R(i,e){u.prototype[i]=e}import{ValidateFormResponse as Yc}from"@devvit/protos";import{RealtimeSubscriptionStatus as nd}from"@devvit/protos";var P=Object.freeze({Actor:"devvit-actor",App:"devvit-app",AppUser:"devvit-app-user",AppViewerAuthToken:"devvit-app-viewer-authorization",Caller:"devvit-caller",CallerPortID:"devvit-caller-port-id",Canary:"devvit-canary",Debug:"devvit-debug",GQLHost:"devvit-gql-host",Installation:"devvit-installation",ModPermissions:"devvit-mod-permissions",Post:"devvit-post",PostAuthor:"devvit-post-author",R2Auth:"devvit-sec-authorization",R2Host:"devvit-r2-host",RemoteHostname:"devvit-remote-hostname",SettingsUri:"devvit-sec-settings-uri",StreamID:"devvit-stream-id",Subreddit:"devvit-subreddit",SubredditName:"devvit-subreddit-name",TraceID:"devvit-trace-id",User:"devvit-user",Username:"devvit-user-name",UserAgent:"devvit-user-agent",Version:"devvit-version",Language:"devvit-accept-language",Timezone:"devvit-accept-timezone",Traceparent:"traceparent",AppDependencies:"devvit-app-dependencies"}),rd;(function(i){i.Blocks="blocks",i.EmitSnapshots="emitSnapshots",i.EmitState="emitState",i.Realtime="realtime",i.Runtime="runtime",i.Surface="surface",i.UseAsync="useAsync",i.Payments="payments",i.Bootstrap="bootstrap",i.WebView="webView"})(rd||(rd={}));function sd(i){function e(t){let s=i.currentHookIndex,o=i.getCurrentComponentState(),d=i.getPreviousComponentState(),c=i.metadata[P.App]?.values[0];p(c,"useChannel - app is missing from Context");let m=i.metadata[P.Installation]?.values[0];p(m,"useChannel - installation is missing from Context");async function y(M){let Y=o[s].channel;if(o[s].active)if(o[s].connected)await i.realtime.send(Y,M);else throw Error(`Failed to send to channel '${Y}'; it is active but not yet connected`);else throw Error(`Cannot send a message over inactive channel: ${Y}`)}function v(){if(!o[s].active){let M=o[s].channel;o[s].active=!0,i.addRealtimeChannel(M)}}function f(){if(o[s].active){let M=o[s].channel;o[s].active=!1,i.removeRealtimeChannel(M)}}function S(M){return async()=>{let Y;switch(M.status){case nd.REALTIME_SUBSCRIBED:o[s].connected=!0,Y=t.onSubscribed?.();break;case nd.REALTIME_UNSUBSCRIBED:o[s].connected=!1,Y=t.onUnsubscribed?.();break;default:Y=t.onMessage(M.event?.data?.msg);break}await Y}}let b={channel:`${c}:${m}:${t.name}`,active:!1,connected:!1,preventCallback:!1,type:Ge.CHANNEL};s in o?b=o[s]:s in d&&(b=d[s]);let O=i.realtimeEvent;i.isInitialRender?b.active=!1:O&&b.active&&O.event.channel===b.channel&&(b.preventCallback||i.runHook(S(O)),i.rerenderIn(0)),o[s]=b,i.currentHookIndex++;let L=0;return b.active&&b.connected?L=2:b.active&&!b.connected?L=1:!b.active&&b.connected?L=3:!b.active&&!b.connected&&(L=4),{subscribe:v,unsubscribe:f,send:y,status:L}}return e}import{FormFieldType as ei}from"@devvit/protos";function No(i){switch(i.fieldType){case ei.STRING:return i.stringValue;case ei.IMAGE:return i.stringValue;case ei.PARAGRAPH:return i.stringValue;case ei.NUMBER:return i.numberValue;case ei.BOOLEAN:return i.boolValue;case ei.SELECTION:return i.selectionValue?.values??[];default:return}}function Je(i){return Object.keys(i).reduce((e,t)=>{let r=No(i[t]);return r!==void 0&&(e[t]=r),e},{})}function od(i){function e(t,r){let s=i.currentHookIndex,o=i.getCurrentComponentKey(),d=i.getCurrentComponentState(),c=i.getPreviousComponentState(),m=`form.hook.${o}.${s}`,y={formKey:m,preventSubmit:!1,type:Ge.FORM};s in d?y=d[s]:s in c&&(y=c[s]),d[s]=y,i.forms.set(m,t);let v=i.formSubmittedEvent;return v&&!y.preventSubmit&&v.formId===m&&i.runHook(async()=>{let f=r(Je(v.results));f&&f instanceof Promise&&await f,i.rerenderIn(0)}),d[s].preventSubmit=!1,i.currentHookIndex++,m}return e}function ad(i){function e(t,r){let s=i.currentHookIndex,o=i.getCurrentComponentState(),d=i.getPreviousComponentState(),c=100,m=Math.max(c,r),y={lastRun:void 0,running:!1,preventCallback:!1,type:Ge.INTERVAL};s in o?y=o[s]:s in d&&(y=d[s]);function v(){r<c&&console.error(`useInterval delay must be at least ${c}ms. Your interval of ${r}ms was automatically extended.`);for(let[S,b]of Object.entries(o))if(S!==s.toString()&&b?.type===Ge.INTERVAL&&b?.running)throw new Error("Only one useInterval hook may be running at a time");o[s]={running:!0,lastRun:o[s]?.lastRun??Date.now(),preventCallback:!1,type:Ge.INTERVAL},i.rerenderIn(m)}function f(){o[s].running=!1,o[s].lastRun=void 0,o[s].preventCallback=!1}return i.isEffectRender&&y.running&&(y.preventCallback||(y.lastRun===void 0||y.lastRun+m<Date.now())&&i.runHook(async()=>{let S=t();S&&S instanceof Promise&&await S,y.lastRun=Date.now()}),i.rerenderIn(m)),y.preventCallback=!1,o[s]=y,i.currentHookIndex++,{start:v,stop:f}}return e}function dd(i){function e(t){let r=i.currentHookIndex,s=i.getCurrentComponentState(),o=i.getPreviousComponentState();if(r in s)return i.currentHookIndex++,[s[r],d];if(i.isInitialRender||!(r in o)){let c=t instanceof Function?t():t;if(c instanceof Promise)throw(async()=>{s[r]=await c,i.currentHookIndex=0})();s[r]=c}else s[r]=o[r];function d(c){if(i.isRendering)throw new Error("Cannot call setState while rendering.");s[r]=c instanceof Function?c(s[r]):c}return i.currentHookIndex++,[s[r],d]}return e}var jo={now(){return new Date}};function ld(i){return`__autocache__${i}`}function ud(i){return`__lock__${i}`}var $c=300,Kc=1e3,Bs=5e3,Lo=3,cd=.1,md=1e3,Zc=3e4;function pd(i){if(i.error)throw new Error(i.error);return i.value}var ze,qe,be,ti,J,gd,hd,fd,_o,bd,yd,Ho,vd,Us=class{constructor(e,t,r=jo){l(this,J);l(this,ze);l(this,qe,{});l(this,be);l(this,ti);a(this,ze,e),a(this,ti,t),a(this,be,r)}async cache(e,t){a(this,qe,n(this,ti).__cache=n(this,ti).__cache??{}),h(this,J,vd).call(this,t);let r=h(this,J,gd).call(this,t.key);if(r!==void 0)return r;let s=await h(this,J,Ho).call(this,t.key),o=await h(this,J,hd).call(this,t,s,e);return pd(o)}};ze=new WeakMap,qe=new WeakMap,be=new WeakMap,ti=new WeakMap,J=new WeakSet,gd=function(e){let t=n(this,qe)[e];if(t){let r=n(this,be).now().getTime(),s=t?.error&&t?.errorTime&&t.errorCount<Lo&&Math.random()<cd&&t.errorTime+md<r;if(t?.expires&&t.expires<r&&t.checkedAt+md<r||s){delete n(this,qe)[e];return}else return pd(t)}},hd=async function(e,t,r){let s=t?.expires,o=s?h(this,J,yd).call(this,s):1;return!t||t?.error&&t.errorCount<Lo&&cd>Math.random()||o>Math.random()?h(this,J,fd).call(this,e,t,r):t},fd=async function(e,t,r){let s=ud(e.key),o=n(this,be).now().getTime(),d=new Date(o+e.ttl/2);if(await n(this,ze).set(s,"1",{expiration:d,nx:!0}))return h(this,J,bd).call(this,e.key,t,r,e.ttl);if(t)return t;{let m=n(this,be).now();return h(this,J,_o).call(this,m,e.key,e.ttl)}},_o=async function(e,t,r){let s=Math.min(r,Kc),o=await h(this,J,Ho).call(this,t);if(o)return o;if(n(this,be).now().getTime()-e.getTime()>=s)throw new Error(`Cache request timed out trying to get data at key: ${t}`);return await new Promise(d=>setTimeout(d,$c)),h(this,J,_o).call(this,e,t,r)},bd=async function(e,t,r,s){let o=n(this,be).now().getTime()+s;t=t??{value:null,expires:o,errorCount:0,error:null,errorTime:null,checkedAt:0};try{t.value=await r(),t.error=null,t.errorCount=0,t.errorTime=null}catch(d){t.value=null,t.error=d.message??"Unknown error",t.errorTime=n(this,be).now().getTime(),t.errorCount++}return n(this,qe)[e]=t,await n(this,ze).set(ld(e),JSON.stringify(t),{expiration:new Date(o+Zc)}),t.error&&t.errorCount<Lo&&await n(this,ze).del(ud(e)),t},yd=function(e){let t=n(this,be).now().getTime(),r=e-t;return r<0?1:r<1e3?.1:r<2e3?.01:r<3e3?.001:0},Ho=async function(e){let t=await n(this,ze).get(ld(e));if(t){let r=JSON.parse(t);return r.checkedAt=n(this,be).now().getTime(),n(this,qe)[e]=r,r}},vd=function(e){e.ttl<Bs&&(console.warn(`Cache TTL cannot be less than ${Bs} milliseconds! Updating ttl value of ${e.ttl} to ${Bs}.`),e.ttl=Bs)};function kd(i,e,t=jo){let r=new Us(i,e,t);return r.cache.bind(r)}function Cd(i){new URL(i.slice(0,i.indexOf(",")))}var ii,ri,si,Sd,Pd,ni=class{constructor(){l(this,si);l(this,ii,{});l(this,ri,{});a(this,ii,u.assets),a(this,ri,u.webViewAssets)}getURL(e,t){return typeof e=="string"?h(this,si,Sd).call(this,e,t??{webView:!1}):h(this,si,Pd).call(this,e,t??{webView:!1})}};ii=new WeakMap,ri=new WeakMap,si=new WeakSet,Sd=function(e,t){let r=t.webView?n(this,ri)[e]:n(this,ii)[e];if(r)return r;try{return Cd(e),encodeURI(e)}catch{return""}},Pd=function(e,t){let r={},s=[],o=t.webView?n(this,ri):n(this,ii);if(o)for(let d of e)if(o[d])r[d]=o[d];else try{Cd(d),r[d]=encodeURI(d)}catch{s.push(d)}else s=e;if(s.length>0)throw new Error(`The following assets were missing from the assets list: ${s.join(", ")}`);return r};var $e,oi=class{constructor(e){l(this,$e);a(this,$e,e)}async get(e){let{messages:t}=await u.kvStorePlugin.Get({keys:[e]},n(this,$e));try{if(t[e])return JSON.parse(t[e])}catch{return}}async put(e,t){let r={};r[e]=JSON.stringify(t),await u.kvStorePlugin.Put({messages:r},n(this,$e))}async delete(e){await u.kvStorePlugin.Del({keys:[e]},n(this,$e))}async list(){let{keys:e}=await u.kvStorePlugin.List({filter:"*"},n(this,$e));return e}};$e=new WeakMap;var Er,ai=class{constructor(e){l(this,Er);a(this,Er,e)}async upload(e){let t=await u.mediaPlugin.Upload(e,n(this,Er));if(!t.mediaId)throw new Error("unable to get mediaId via uploads");return Promise.resolve({mediaId:t.mediaId,mediaUrl:t.mediaUrl})}};Er=new WeakMap;var Tr,di=class{constructor(e){l(this,Tr);a(this,Tr,e)}async add(e){await u.modLogPlugin.Add(e,n(this,Tr))}};Tr=new WeakMap;var Rr,li=class{constructor(e){l(this,Rr);a(this,Rr,e)}async send(e,t){await u.realtimePlugin.Send({channel:e,data:{msg:t}},n(this,Rr))}};Rr=new WeakMap;var g,Or,Mr,Br,ui=class{constructor(e){l(this,g);l(this,Or);l(this,Mr);l(this,Br);a(this,g,e),a(this,Or,new Ns(e))}get modMail(){return n(this,Or)}getSubredditById(e){return le.getById(he(e),n(this,g))}getSubredditInfoById(e){return xd(e,n(this,g))}getSubredditByName(e){return le.getByName(e,n(this,g))}getSubredditInfoByName(e){return Id(e,n(this,g))}addSubredditRemovalReason(e,t){return le.addRemovalReason(e,t.title,t.message,n(this,g))}getSubredditRemovalReasons(e){return le.getRemovalReasons(e,n(this,g))}async getCurrentSubredditName(){let e=n(this,g)?.[P.SubredditName]?.values[0];if(e)return e;let t=n(this,g)?.[P.Subreddit]?.values[0],r=await Wo($(t),n(this,g));if(!r)throw new Error("Couldn't get current subreddit's name");return r}async getCurrentSubreddit(){let e=await le.getFromMetadata(n(this,g));if(!e)throw new Error("Couldn't get current subreddit");return e}getPostById(e){return V.getById(he(e),n(this,g))}submitPost(e){return V.submit(e,n(this,g))}crosspost(e){return V.crosspost(e,n(this,g))}getUserById(e){return C.getById(he(e),n(this,g))}getUserByUsername(e){return C.getByUsername(e,n(this,g))}async getCurrentUsername(){return n(this,Br)??a(this,Br,wd(n(this,g))),n(this,Br)}async getCurrentUser(){return n(this,Mr)??a(this,Mr,this.getCurrentUsername().then(e=>e?C.getByUsername(e,n(this,g)):void 0)),n(this,Mr)}getAppUser(){return C.getFromMetadata(P.AppUser,n(this,g))}getSnoovatarUrl(e){return C.getSnoovatarUrl(e,n(this,g))}getCommentById(e){return X.getById(he(e),n(this,g))}getComments(e){return X.getComments(e,n(this,g))}getCommentsByUser(e){return X.getCommentsByUser(e,n(this,g))}submitComment(e){return X.submit({...e,id:he(e.id)},n(this,g))}getControversialPosts(e){return V.getControversialPosts(e,n(this,g))}getTopPosts(e){return V.getTopPosts(e,n(this,g))}getHotPosts(e){return V.getHotPosts(e,n(this,g))}getNewPosts(e){return V.getNewPosts(e,n(this,g))}getRisingPosts(e){return V.getRisingPosts(e,n(this,g))}getPostsByUser(e){return V.getPostsByUser(e,n(this,g))}getCommentsAndPostsByUser(e){return C.getOverview(e,n(this,g))}getModerationLog(e){return Ds(e,n(this,g))}getApprovedUsers(e){return C.getSubredditUsersByType({type:"contributors",...e},n(this,g))}approveUser(e,t){return C.createRelationship({username:e,subredditName:t,type:"contributor"},n(this,g))}removeUser(e,t){return C.removeRelationship({username:e,subredditName:t,type:"contributor"},n(this,g))}getWikiContributors(e){return C.getSubredditUsersByType({type:"wikicontributors",...e},n(this,g))}addWikiContributor(e,t){return C.createRelationship({username:e,subredditName:t,type:"wikicontributor"},n(this,g))}removeWikiContributor(e,t){return C.removeRelationship({username:e,subredditName:t,type:"wikicontributor"},n(this,g))}getBannedUsers(e){return C.getSubredditUsersByType({type:"banned",...e},n(this,g))}banUser(e){return C.createRelationship({username:e.username,subredditName:e.subredditName,type:"banned",banReason:e.reason,banMessage:e.message,note:e.note,duration:e.duration,banContext:e.context},n(this,g))}unbanUser(e,t){return C.removeRelationship({username:e,subredditName:t,type:"banned"},n(this,g))}getBannedWikiContributors(e){return C.getSubredditUsersByType({type:"wikibanned",...e},n(this,g))}banWikiContributor(e){return C.createRelationship({...e,type:"wikibanned"},n(this,g))}unbanWikiContributor(e,t){return C.removeRelationship({username:e,subredditName:t,type:"wikibanned"},n(this,g))}getModerators(e){return C.getSubredditUsersByType({type:"moderators",...e},n(this,g))}inviteModerator(e){return C.createRelationship({type:"moderator_invite",subredditName:e.subredditName,username:e.username,permissions:e.permissions??[]},n(this,g))}revokeModeratorInvite(e,t){return C.removeRelationship({username:e,subredditName:t,type:"moderator_invite"},n(this,g))}removeModerator(e,t){return C.removeRelationship({type:"moderator",subredditName:t,username:e},n(this,g))}setModeratorPermissions(e,t,r){return C.setModeratorPermissions(e,t,r,n(this,g))}getMutedUsers(e){return C.getSubredditUsersByType({type:"muted",...e},n(this,g))}muteUser(e){return C.createRelationship({...e,type:"muted"},n(this,g))}unmuteUser(e,t){return C.removeRelationship({username:e,subredditName:t,type:"muted"},n(this,g))}getModNotes(e){return ye.get(e,n(this,g))}deleteModNote(e){return ye.delete(e,n(this,g))}addModNote(e){let t={...e,redditId:e.redditId?he(e.redditId):void 0};return ye.add(t,n(this,g))}addRemovalNote(e){return ye.addRemovalNote(e,n(this,g))}async sendPrivateMessage(e){return wt.send(e,n(this,g))}async sendPrivateMessageAsSubreddit(e){return wt.sendAsSubreddit(e,n(this,g))}async approve(e){if(Ve(e))return X.approve(e,n(this,g));if(St(e))return V.approve(e,n(this,g));throw new Error("id must start with either t1_ or t3_")}async remove(e,t){if(Ve(e))return X.remove(e,t,n(this,g));if(St(e))return V.remove(e,t,n(this,g));throw new Error("id must start with either t1_ or t3_")}async getPostFlairTemplates(e){return ne.getPostFlairTemplates(e,n(this,g))}async getUserFlairTemplates(e){return ne.getUserFlairTemplates(e,n(this,g))}async createPostFlairTemplate(e){return ne.createPostFlairTemplate(e,n(this,g))}async createUserFlairTemplate(e){return ne.createUserFlairTemplate(e,n(this,g))}async editFlairTemplate(e){return ne.editFlairTemplate(e,n(this,g))}async deleteFlairTemplate(e,t){return ne.deleteFlairTemplate(e,t,n(this,g))}async setUserFlair(e){return ve.setUserFlair(e,n(this,g))}async removeUserFlair(e,t){return ve.removeUserFlair(e,t,n(this,g))}async setPostFlair(e){return ve.setPostFlair(e,n(this,g))}async removePostFlair(e,t){return ve.removePostFlair(e,de(t),n(this,g))}async getWidgets(e){return ie.getWidgets(e,n(this,g))}async deleteWidget(e,t){return ie.delete(e,t,n(this,g))}async addWidget(e){return ie.add(e,n(this,g))}async reorderWidgets(e,t){return ie.reorder(e,t,n(this,g))}async getWikiPage(e,t){return ue.getPage(e,t,n(this,g))}async getWikiPages(e){return ue.getPages(e,n(this,g))}async createWikiPage(e){return ue.createPage(e,n(this,g))}async updateWikiPage(e){return ue.updatePage(e,n(this,g))}getWikiPageRevisions(e){return ue.getPageRevisions(e,n(this,g))}async revertWikiPage(e,t,r){return ue.revertPage(e,t,r,n(this,g))}async getWikiPageSettings(e,t){return ue.getPageSettings(e,t,n(this,g))}async updateWikiPageSettings(e){return ue.updatePageSettings(e,n(this,g))}async addEditorToWikiPage(e,t,r){return ue.addEditor(e,t,r,n(this,g))}async removeEditorFromWikiPage(e,t,r){return ue.removeEditor(e,t,r,n(this,g))}getMessages(e){return wt.getMessages(e,n(this,g))}markAllMessagesAsRead(){return wt.markAllAsRead(n(this,g))}report(e,t){return u.redditAPIPlugins.LinksAndComments.Report({reason:t.reason,thingId:e.id,srName:e.subredditName,usernames:e.authorName},n(this,g))}getModQueue(e){return le.aboutLocation({...e,location:"modqueue"},n(this,g))}getReports(e){return le.aboutLocation({...e,location:"reports"},n(this,g))}getSpam(e){return le.aboutLocation({...e,location:"spam"},n(this,g))}getUnmoderated(e){return le.aboutLocation({...e,location:"unmoderated"},n(this,g))}getEdited(e){return le.aboutLocation({...e,location:"edited"},n(this,g))}getVaultByAddress(e){return Td(e,n(this,g))}getVaultByUserId(e){return Rd(he(e),n(this,g))}getSubredditLeaderboard(e){return Ad(e,n(this,g))}getSubredditStyles(e){return Ed(e,n(this,g))}async subscribeToCurrentSubreddit(){let e=await this.getCurrentSubreddit();await u.redditAPIPlugins.Subreddits.Subscribe({action:"sub",actionSource:"",srName:e.name,sr:"",skipInitialDefaults:!0},n(this,g))}async unsubscribeFromCurrentSubreddit(){let e=await this.getCurrentSubreddit();await u.redditAPIPlugins.Subreddits.Subscribe({action:"unsub",actionSource:"",srName:e.name,sr:"",skipInitialDefaults:!1},n(this,g))}};g=new WeakMap,Or=new WeakMap,Mr=new WeakMap,Br=new WeakMap;import{RedisKeyScope as Vo}from"@devvit/protos";function Ls(i){return i&&typeof i=="object"&&"message"in i&&i.message!==void 0&&typeof i.message=="string"?i.message.includes("redis: nil"):!1}var x,I,A,Go=class{constructor(e,t,r){l(this,x);l(this,I);l(this,A);a(this,x,e),a(this,I,t),a(this,A,r)}async get(e){return await n(this,x).Get({key:e,transactionId:n(this,I)},n(this,A)),this}async multi(){await n(this,x).Multi(n(this,I),n(this,A))}async set(e,t,r){let s;return r?.expiration&&(s=Math.floor((r.expiration.getTime()-Date.now())/1e3),s<1&&(s=1)),await n(this,x).Set({key:e,value:t,nx:r?.nx===!0,xx:r?.xx===!0,expiration:s||0,transactionId:n(this,I)},n(this,A)),this}async del(...e){return await n(this,x).Del({keys:e,transactionId:n(this,I)},n(this,A)),this}async type(e){return await n(this,x).Type({key:e,transactionId:n(this,I)},n(this,A)),this}async exec(){let e=await n(this,x).Exec(n(this,I),n(this,A)),t=[];for(let r of e.response)r.members?t.push(r.members):r.nil!==void 0?t.push(null):r.num!==void 0?t.push(r.num):r.values!==void 0?t.push(r.values.values):r.str!==void 0?t.push(r.str):r.dbl!==void 0&&t.push(r.dbl);return t}async discard(){await n(this,x).Discard(n(this,I),n(this,A))}async watch(...e){return await n(this,x).Watch({keys:e,transactionId:n(this,I)},n(this,A)),this}async unwatch(){return await n(this,x).Unwatch(n(this,I),n(this,A)),this}async getRange(e,t,r){return await n(this,x).GetRange({key:e,start:t,end:r,transactionId:n(this,I)},n(this,A)),this}async setRange(e,t,r){return await n(this,x).SetRange({key:e,offset:t,value:r,transactionId:n(this,I)},n(this,A)),this}async strlen(e){return this.strLen(e)}async strLen(e){return await n(this,x).Strlen({key:e,transactionId:n(this,I)},n(this,A)),this}async mget(e){return this.mGet(e)}async mGet(e){return await n(this,x).MGet({keys:e,transactionId:n(this,I)},n(this,A)),this}async mset(e){return this.mSet(e)}async mSet(e){let t=Object.entries(e).map(([r,s])=>({key:r,value:s}));return await n(this,x).MSet({kv:t,transactionId:n(this,I)},n(this,A)),this}async incrBy(e,t){return await n(this,x).IncrBy({key:e,value:t,transactionId:n(this,I)},n(this,A)),this}async expire(e,t){return await n(this,x).Expire({key:e,seconds:t,transactionId:n(this,I)},n(this,A)),this}async expireTime(e){return await n(this,x).ExpireTime({key:e,transactionId:n(this,I)},n(this,A)),this}async zAdd(e,...t){return await n(this,x).ZAdd({key:e,members:t,transactionId:n(this,I)},n(this,A)),this}async zScore(e,t){return await n(this,x).ZScore({key:{key:e,transactionId:n(this,I)},member:t},n(this,A)),this}async zRank(e,t){return await n(this,x).ZRank({key:{key:e,transactionId:n(this,I)},member:t},n(this,A)),this}async zIncrBy(e,t,r){return await n(this,x).ZIncrBy({key:e,member:t,value:r,transactionId:n(this,I)},n(this,A)),this}async zScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,transactionId:n(this,I)};return await n(this,x).ZScan(o,n(this,A)),this}async zCard(e){return await n(this,x).ZCard({key:e,transactionId:n(this,I)},n(this,A)),this}async zRange(e,t,r,s){let o={rev:!1,byLex:!1,byScore:!1,offset:0,count:1e3};return s?.reverse&&(o.rev=s.reverse),s?.by==="lex"?o.byLex=!0:s?.by==="score"&&(o.byScore=!0),await n(this,x).ZRange({key:{key:e,transactionId:n(this,I)},start:t+"",stop:r+"",...o},n(this,A)),this}async zRem(e,t){return await n(this,x).ZRem({key:{key:e,transactionId:n(this,I)},members:t},n(this,A)),this}async zRemRangeByLex(e,t,r){return await n(this,x).ZRemRangeByLex({key:{key:e,transactionId:n(this,I)},min:t,max:r},n(this,A)),this}async zRemRangeByRank(e,t,r){return await n(this,x).ZRemRangeByRank({key:{key:e,transactionId:n(this,I)},start:t,stop:r},n(this,A)),this}async zRemRangeByScore(e,t,r){return await n(this,x).ZRemRangeByScore({key:{key:e,transactionId:n(this,I)},min:t,max:r},n(this,A)),this}async hgetall(e){return this.hGetAll(e)}async hGetAll(e){return await n(this,x).HGetAll({key:e,transactionId:n(this,I)},n(this,A)),this}async hget(e,t){return this.hGet(e,t)}async hGet(e,t){return await n(this,x).HGet({key:e,field:t,transactionId:n(this,I)},n(this,A)),this}async hMGet(e,t){return await n(this,x).HMGet({key:e,fields:t,transactionId:n(this,I)},n(this,A)),this}async hset(e,t){return this.hSet(e,t)}async hSet(e,t){let r=Object.entries(t).map(([s,o])=>({field:s,value:o}));return await n(this,x).HSet({key:e,fv:r,transactionId:n(this,I)},n(this,A)),this}async hincrby(e,t,r){return this.hIncrBy(e,t,r)}async hIncrBy(e,t,r){return await n(this,x).HIncrBy({key:e,field:t,value:r,transactionId:n(this,I)},n(this,A)),this}async hdel(e,t){return this.hDel(e,t)}async hDel(e,t){return await n(this,x).HDel({key:e,fields:t,transactionId:n(this,I)},n(this,A)),this}async hscan(e,t,r,s){return this.hScan(e,t,r,s)}async hScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,transactionId:n(this,I)};return await n(this,x).HScan(o,n(this,A)),this}async hkeys(e){return this.hKeys(e)}async hKeys(e){return await n(this,x).HKeys({key:e,transactionId:n(this,I)},n(this,A)),this}async hlen(e){return this.hLen(e)}async hLen(e){return await n(this,x).HLen({key:e,transactionId:n(this,I)},n(this,A)),this}};x=new WeakMap,I=new WeakMap,A=new WeakMap;var T,ci,Jo=class Jo{constructor(e,t=void 0,r=Vo.INSTALLATION){l(this,T);l(this,ci);a(this,T,e),a(this,ci,t),this.scope=r,this.global=r===Vo.INSTALLATION?new Jo(n(this,T),n(this,ci),Vo.GLOBAL):this}get storage(){return n(this,ci)||u.redisPlugin}async watch(...e){let t=await this.storage.Watch({keys:e},n(this,T));return new Go(this.storage,t,n(this,T))}async get(e){try{let t=await this.storage.Get({key:e,scope:this.scope},{...n(this,T),"throw-redis-nil":{values:["true"]}});return t!==null?t.value??void 0:t}catch(t){if(Ls(t))return;throw t}}async set(e,t,r){let s;return r?.expiration&&(s=Math.floor((r.expiration.getTime()-Date.now())/1e3),s<1&&(s=1)),(await this.storage.Set({key:e,value:t,nx:r?.nx===!0&&!r.xx,xx:r?.xx===!0&&!r.nx,expiration:s||0,scope:this.scope},n(this,T))).value}async del(...e){await this.storage.Del({keys:e,scope:this.scope},n(this,T))}async incrBy(e,t){return(await this.storage.IncrBy({key:e,value:t,scope:this.scope},n(this,T))).value}async getRange(e,t,r){let s=await this.storage.GetRange({key:e,start:t,end:r,scope:this.scope},n(this,T));return s!==null?s.value:s}async setRange(e,t,r){return(await this.storage.SetRange({key:e,offset:t,value:r,scope:this.scope},n(this,T))).value}async strlen(e){return this.strLen(e)}async strLen(e){return(await this.storage.Strlen({key:e,scope:this.scope},n(this,T))).value}async expire(e,t){await this.storage.Expire({key:e,seconds:t,scope:this.scope},n(this,T))}async expireTime(e){return(await this.storage.ExpireTime({key:e,scope:this.scope},n(this,T))).value}async zAdd(e,...t){return(await this.storage.ZAdd({key:e,members:t,scope:this.scope},n(this,T))).value}async zRange(e,t,r,s){let o={rev:!1,byLex:!1,byScore:!1,offset:0,count:1e3};return s?.reverse&&(o.rev=s.reverse),s?.by==="lex"?o.byLex=!0:s?.by==="score"?o.byScore=!0:(o.offset=0,o.count=0),(await this.storage.ZRange({key:{key:e},start:t+"",stop:r+"",...o,scope:this.scope},n(this,T))).members}async zRem(e,t){return(await this.storage.ZRem({key:{key:e},members:t,scope:this.scope},n(this,T))).value}async zRemRangeByLex(e,t,r){return(await this.storage.ZRemRangeByLex({key:{key:e},min:t,max:r,scope:this.scope},n(this,T))).value}async zRemRangeByRank(e,t,r){return(await this.storage.ZRemRangeByRank({key:{key:e},start:t,stop:r,scope:this.scope},n(this,T))).value}async zRemRangeByScore(e,t,r){return(await this.storage.ZRemRangeByScore({key:{key:e},min:t,max:r,scope:this.scope},n(this,T))).value}async zScore(e,t){try{let r=await this.storage.ZScore({key:{key:e},member:t,scope:this.scope},{...n(this,T),"throw-redis-nil":{values:["true"]}});return r!==null?r.value:r}catch(r){if(Ls(r))return;throw r}}async zRank(e,t){try{let r=await this.storage.ZRank({key:{key:e},member:t,scope:this.scope},{...n(this,T),"throw-redis-nil":{values:["true"]}});return r!==null?r.value:r}catch(r){if(Ls(r))return;throw r}}async zIncrBy(e,t,r){let s=await this.storage.ZIncrBy({key:e,member:t,value:r,scope:this.scope},n(this,T));return s!==null?s.value:s}async mget(e){return this.mGet(e)}async mGet(e){let t=await this.storage.MGet({keys:e,scope:this.scope},n(this,T));return t!==null?t.values.map(r=>r||null):t}async mset(e){return this.mSet(e)}async mSet(e){let t=Object.entries(e).map(([r,s])=>({key:r,value:s}));await this.storage.MSet({kv:t,scope:this.scope},n(this,T))}async zCard(e){let t=await this.storage.ZCard({key:e,scope:this.scope},n(this,T));return t!==null?t.value:t}async zScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,scope:this.scope};return await this.storage.ZScan(o,n(this,T))}async type(e){let t=await this.storage.Type({key:e,scope:this.scope},n(this,T));return t!==null?t.value:t}async hget(e,t){return this.hGet(e,t)}async hGet(e,t){try{let r=await this.storage.HGet({key:e,field:t,scope:this.scope},{...n(this,T),"throw-redis-nil":{values:["true"]}});return r!==null?r.value??void 0:r}catch(r){if(Ls(r))return;throw r}}async hMGet(e,t){let r=await this.storage.HMGet({key:e,fields:t,scope:this.scope},n(this,T));return r!==null?r.values.map(s=>s||null):r}async hset(e,t){return this.hSet(e,t)}async hSet(e,t){let r=Object.entries(t).map(([o,d])=>({field:o,value:d}));return(await this.storage.HSet({key:e,fv:r,scope:this.scope},n(this,T))).value}async hgetall(e){return this.hGetAll(e)}async hGetAll(e){let t=await this.storage.HGetAll({key:e,scope:this.scope},n(this,T));return t!==null?t.fieldValues:t}async hdel(e,t){return this.hDel(e,t)}async hDel(e,t){return(await this.storage.HDel({key:e,fields:t,scope:this.scope},n(this,T))).value}async hscan(e,t,r,s){return this.hScan(e,t,r,s)}async hScan(e,t,r,s){let o={key:e,cursor:t,pattern:r,count:s,scope:this.scope};return await this.storage.HScan(o,n(this,T))}async hkeys(e){return this.hKeys(e)}async hKeys(e){let t=await this.storage.HKeys({key:e,scope:this.scope},n(this,T));return t!==null?t.keys:t}async hincrby(e,t,r){return this.hIncrBy(e,t,r)}async hIncrBy(e,t,r){return(await this.storage.HIncrBy({key:e,field:t,value:r,scope:this.scope},n(this,T))).value}async hlen(e){return this.hLen(e)}async hLen(e){return(await this.storage.HLen({key:e,scope:this.scope})).value}};T=new WeakMap,ci=new WeakMap;var mi=Jo;var Ft,pi=class{constructor(e){l(this,Ft);a(this,Ft,e)}async runJob(e){return(await u.schedulerPlugin.Schedule({action:{type:e.name,data:e.data},cron:"cron"in e?e.cron:void 0,when:"runAt"in e?e.runAt:void 0},n(this,Ft))).id}async cancelJob(e){await u.schedulerPlugin.Cancel({id:e},n(this,Ft))}async listJobs(){return(await u.schedulerPlugin.List({after:new Date(0),before:new Date(Date.now()+31536e7)},n(this,Ft))).actions.map(t=>(p(t.request?.action,"Scheduled job is malformed"),"when"in t.request&&t.request.when!=null?{id:t.id,name:t.request.action.type,runAt:t.request.when,data:t.request.action.data}:{id:t.id,name:t.request.action.type,cron:t.request.cron??"",data:t.request.action}))}};Ft=new WeakMap;var Ur,gi=class{constructor(e){l(this,Ur);a(this,Ur,e)}async get(e){return(await this.getAll())[e]}async getAll(){let t=await u.settingsPlugin.GetSettings({},n(this,Ur));if(!t.installationSettings)throw new Error("Could not get installation settings");if(!t.appSettings)throw new Error("Could not get app settings");return{...Od(t.installationSettings.settings,u.installationSettings),...Od(t.appSettings.settings,u.appSettings)}}};Ur=new WeakMap;function Od(i,e){let t=Object.keys(i).reduce((r,s)=>(r[s]=No(i[s]),r),{});return e&&Md(t,e),t}function Md(i,e){for(let t of e)t.type==="group"?Md(i,t.fields):!(t.name in i)&&"defaultValue"in t&&(i[t.name]=t.defaultValue)}import{EffectType as _s,ToastAppearance as Bd}from"@devvit/protos";var Ke,hi,Dr,js,Hs=class{constructor(e){l(this,Ke,[]);l(this,hi);l(this,Dr);l(this,js,(e,t)=>{let r=t!==void 0?e:"",s=t!==void 0?t:e;n(this,Ke).push({type:_s.EFFECT_WEB_VIEW,webView:{postMessage:{webViewId:r,app:{message:s}}}})});a(this,hi,e),a(this,Dr,{postMessage:n(this,js)})}get webView(){return n(this,Dr)}showForm(e,t){let r=u.formDefinitions.get(e);if(!r&&n(this,hi)){let d=n(this,hi).forms.get(e);d&&(r={form:d,onSubmit:()=>{}})}if(!r)throw new Error("Form does not exist. Make sure you have added it using Devvit.createForm at the root of your app.");let s=r.form instanceof Function?r.form(t??{}):r.form,o={fields:[],id:e,title:s.title,acceptLabel:s.acceptLabel,cancelLabel:s.cancelLabel,shortDescription:s.description};Pt(s.fields),o.fields=Ue(s.fields),n(this,Ke).push({type:_s.EFFECT_SHOW_FORM,showForm:{form:o}})}showToast(e){let t;e instanceof Object?t={text:e.text,appearance:e.appearance==="success"?Bd.SUCCESS:Bd.NEUTRAL}:t={text:e},n(this,Ke).push({type:_s.EFFECT_SHOW_TOAST,showToast:{toast:t}})}navigateTo(e){let t;typeof e=="string"?t=new URL(e).toString():t=new URL(e.permalink,"https://www.reddit.com").toString(),n(this,Ke).push({type:_s.EFFECT_NAVIGATE_TO_URL,navigateToUrl:{url:t}})}get __effects(){return n(this,Ke)}};Ke=new WeakMap,hi=new WeakMap,Dr=new WeakMap,js=new WeakMap;function ke({metadata:i,ui:e,hooks:t,reconciler:r}){let s=new di(i),o=new oi(i),d=new mi(i),c=kd(d,r?r.state:{}),m=new ui(i),y=new pi(i),v=new gi(i),f=e?new Hs(r):void 0,S=new ai(i),b=new ni,O=new li(i),L=t&&r?dd(r):void 0,M=t&&r?ad(r):void 0,Y=t&&r?od(r):void 0,Xt=t&&r?sd(r):void 0;return{modLog:s,kvStore:o,redis:d,reddit:m,scheduler:y,settings:v,media:S,assets:b,realtime:O,get useForm(){return Y??(()=>{throw new Error("useForm() is unavailable")})},get cache(){return c??(()=>{throw new Error("cache() is unavailable")})},get useState(){return L??(()=>{throw new Error("useState() is unavailable")})},get useInterval(){return M??(()=>{throw new Error("useInterval() is unavailable")})},get useChannel(){return Xt??(()=>{throw new Error("useChannel() is unavailable")})},get ui(){if(!f)throw new Error("ui client is not available");return f}}}var Ud={name:"@devvit/public-api",version:"0.11.7-dev",license:"BSD-3-Clause",repository:{type:"git",url:"https://developers.reddit.com/"},type:"module",exports:{".":"./dist/index.js","./package.json":"./package.json","./*":"./dist/*"},main:"./dist/index.js",files:["dist/**"],scripts:{build:"yarn build:icon-types && yarn build:semantic-colors && tsc && cp -af devvit.tsconfig.json dist/ && yarn build:types && yarn build:min && yarn build:unmin","build:icon-types":"make-icons src/types/icons.ts","build:min":"esbuild --bundle --sourcemap=linked --target=es2020 --format=esm  --metafile=dist/meta.min.json --outfile=dist/public-api.min.js --external:@devvit/protos --minify src/index.ts","build:semantic-colors":"node scripts/make-semantic-colors.js","build:types":"api-extractor run && sed -ne '/declare global {/,$ p' src/devvit/Devvit.ts >> dist/public-api.d.ts","build:unmin":"esbuild --bundle --sourcemap=inline --target=es2020 --format=iife --metafile=dist/meta.json     --outfile=dist/public-api.iife.js --global-name=devvitPublicAPI                    src/index.ts",clean:"rm -rf .turbo api-extractor coverage dist src/devvit/internals/semanticColors.ts src/types/icons.ts || :",clobber:"yarn clean && rm -rf node_modules",dev:"tsc -w","dev:build":"chokidar ./src --command 'yarn build' --ignore './src/types/icons.ts' --ignore './src/devvit/internals/semanticColors.ts'",lint:"redlint .","lint:fix":"yarn lint --fix",prepublishOnly:"publish-package-json",test:"yarn test:unit && yarn test:types && yarn test:size","test:size":"filesize","test:types":"tsc --noEmit","test:unit":"vitest run","test:unit-with-coverage":"vitest run --coverage"},types:"./dist/index.d.ts",dependencies:{"@devvit/protos":"0.11.7-dev","@devvit/shared-types":"0.11.7-dev","base64-js":"1.5.1","clone-deep":"4.0.1",moderndash:"4.0.0"},devDependencies:{"@ampproject/filesize":"4.3.0","@devvit/repo-tools":"0.11.7-dev","@devvit/tsconfig":"0.11.7-dev","@microsoft/api-extractor":"7.41.0","@reddit/faceplate-ui":"18.0.1","@types/clone-deep":"4.0.1","@vitest/coverage-c8":"0.32.0","chokidar-cli":"3.0.0",esbuild:"0.23.0",eslint:"9.11.1",typescript:"5.3.2",vitest:"1.6.0"},publishConfig:{directory:"dist"},filesize:{"dist/public-api.min.js":{gzip:"60 KB",none:"211 KB"}},source:"./src/index.ts"};function se(i,e,t){let r=i[P.Subreddit]?.values[0];p(r,"subreddit is missing from Context");let s=i[P.SubredditName]?.values[0],o=i[P.AppUser]?.values[0],d=i[P.App]?.values[0],c=i[P.Version]?.values[0],m=i[P.User]?.values[0],y=Qc(i);return{get appAccountId(){return p(o,"appAccountId is missing from Context"),o},subredditId:r,subredditName:s,userId:m,postId:e,commentId:t,appName:d,appVersion:c,debug:y,toJSON(){return{appAccountId:o,appName:d,appVersion:c,subredditId:r,subredditName:s,userId:m,postId:e,commentId:t,debug:y}}}}function Qc(i){let e={blocks:void 0,emitSnapshots:void 0,emitState:void 0,realtime:void 0,runtime:void 0,surface:void 0,useAsync:void 0,payments:void 0,bootstrap:void 0,webView:void 0},t={};for(let s in e)t[s.toLowerCase()]=s;let r={};for(let s of(i[P.Debug]?.values??[]).join().split(",")){let[o,d]=s.split("=");o&&(o=o.trim(),d=d?.trim(),o.toLowerCase()in t&&(o=t[o.toLowerCase()]),r[o]??(r[o]=d||"true"))}return i[P.Debug]&&console.info(`[api] @devvit/public-api v${Ud.version} ${Object.entries(r).map(([s,o])=>`${s}=${o}`).join(" ")}`),{...r,metadata:i}}function Dd(i){return i.flatMap(e=>e.type==="group"?Dd(e.fields):e)}async function Ws(i,e,t){if(!e)throw new Error("Settings were not defined.");let r={success:!0,errors:{}},s=Je(i.fieldValues),o=Dd(e);return await Promise.all(o.map(async d=>{let c=d.name;if(c&&d.onValidate){let m=s[c],y=d.onValidate,v=Object.assign(ke({metadata:t}),se(t)),f=await y({value:m,isEditing:i.editing},v);f&&(r.success=!1,r.errors[c]=f)}})),Yc.fromJSON(r)}async function im(){if(!u.appSettings)throw new Error("App settings were not defined.");return tm.fromJSON({fields:{fields:Ue(u.appSettings)}})}async function rm(i,e){return Ws(i,u.appSettings,e)}function Nd(i){i.provides(em),R("GetAppSettingsFields",im),R("ValidateAppForm",rm)}import{CustomPostDefinition as um,RenderPostResponse as cm}from"@devvit/protos";import{BlockRenderEventType as sa,EffectType as Qd}from"@devvit/protos";function fi(i){return i.__effects}function Ld(){let i=new Set;return e=>{let t=e,r=1;for(;i.has(t);)t=`${e}.${r++}`;return i.add(t),t}}import{BlockActionType as na,BlockAvatarBackground as $d,BlockAvatarFacing as Kd,BlockAvatarSize as Ze,BlockBorderWidth as zs,BlockButtonAppearance as Xe,BlockButtonSize as Zo,BlockGap as qs,BlockHorizontalAlignment as Xo,BlockIconSize as $s,BlockImageResizeMode as Nr,BlockPadding as Lr,BlockRadius as _r,BlockSpacerShape as Qo,BlockSpacerSize as Ks,BlockStackDirection as Yo,BlockTextOutline as ea,BlockTextOverflow as ta,BlockTextSize as yi,BlockTextStyle as ia,BlockTextWeight as Zd,BlockType as Ee,BlockVerticalAlignment as ra}from"@devvit/protos";var zo={"alienblue-100":"#DCE2FB","alienblue-200":"#B8C5FC","alienblue-25":"#F7F8FD","alienblue-300":"#90A9FD","alienblue-400":"#648EFC","alienblue-50":"#EEF0FB","alienblue-500":"#1870F4","alienblue-600":"#115BCA","alienblue-700":"#0A449B","alienblue-75":"#E6E9FB","alienblue-800":"#0A2F6C","alienblue-900":"#0A1A3F","alienblue-950":"#07102B","berrypurple-100":"#F3DAFB","berrypurple-200":"#EAB3FD","berrypurple-25":"#FBF6FD","berrypurple-300":"#DE8BFF","berrypurple-400":"#CF5FFF","berrypurple-50":"#F8EDFC","berrypurple-500":"#BC0EFF","berrypurple-600":"#9B00D4","berrypurple-700":"#7600A3","berrypurple-75":"#F6E4FB","berrypurple-800":"#520472","berrypurple-900":"#300643","berrypurple-950":"#20042A",black:"#000000","black-opacity-0":"#00000000","black-opacity-10":"#00000019","black-opacity-15":"#00000026","black-opacity-20":"#00000033","black-opacity-25":"#0000003F","black-opacity-33":"#00000054","black-opacity-5":"#0000000C","black-opacity-50":"#0000007F","black-opacity-60":"#00000099","black-opacity-67":"#000000AA","black-opacity-80":"#000000CC","black-opacity-90":"#000000E5","brown-100":"#F1DFCF","brown-200":"#E9BE95","brown-25":"#FBF7F4","brown-300":"#DC9D5D","brown-400":"#BA854E","brown-50":"#F7EFE9","brown-500":"#9A6D3F","brown-600":"#7B5631","brown-700":"#5D4023","brown-75":"#F4E7DC","brown-800":"#3F2C19","brown-900":"#221A11","brown-950":"#15100A","coolgray-100":"#DBE4E9","coolgray-150":"#C9D7DE","coolgray-200":"#B7CAD4","coolgray-25":"#F6F8F9","coolgray-250":"#A4BDCA","coolgray-300":"#97AFBC","coolgray-350":"#8BA2AD","coolgray-400":"#7F949F","coolgray-450":"#748791","coolgray-50":"#EEF1F3","coolgray-500":"#667780","coolgray-525":"#576F76","coolgray-550":"#5C6C74","coolgray-600":"#536168","coolgray-650":"#48545B","coolgray-700":"#3D494E","coolgray-75":"#E5EBEE","coolgray-750":"#333D42","coolgray-800":"#2A3236","coolgray-850":"#21272A","coolgray-900":"#181C1F","coolgray-950":"#0E1113","global-black":{light:"#000000",dark:"#000000"},"global-brand-orangered":{light:"#FF4500",dark:"#FF4500"},"global-white":{light:"#FFFFFF",dark:"#FFFFFF"},"kiwigreen-100":"#A8F5A0","kiwigreen-200":"#58E15B","kiwigreen-25":"#EBFDE7","kiwigreen-300":"#00C61C","kiwigreen-400":"#01A816","kiwigreen-50":"#DDF8D7","kiwigreen-500":"#008A10","kiwigreen-600":"#016E0B","kiwigreen-700":"#005306","kiwigreen-75":"#CAF5C2","kiwigreen-800":"#033902","kiwigreen-900":"#0D2005","kiwigreen-950":"#081404","lightblue-100":"#CAE7FB","lightblue-200":"#87D0FD","lightblue-25":"#F3F9FD","lightblue-300":"#02B9FB","lightblue-400":"#029DD5","lightblue-50":"#E6F3FC","lightblue-500":"#007FAE","lightblue-600":"#01668D","lightblue-700":"#014D6B","lightblue-75":"#D9EDFB","lightblue-800":"#03354B","lightblue-900":"#051E2B","lightblue-950":"#04131A","lime-100":"#B7F28E","lime-200":"#90DA58","lime-25":"#EEFDDC","lime-300":"#6DBF01","lime-400":"#5BA200","lime-50":"#E0F8C8","lime-500":"#4A8500","lime-600":"#3A6A00","lime-700":"#2A5000","lime-75":"#CEF5AD","lime-800":"#1E3702","lime-900":"#151E05","lime-950":"#0D1304","mintgreen-100":"#9BF5D9","mintgreen-200":"#00E2B7","mintgreen-25":"#E7FDF5","mintgreen-300":"#00C29D","mintgreen-400":"#01A484","mintgreen-50":"#D7F8EC","mintgreen-500":"#01876D","mintgreen-600":"#006C56","mintgreen-700":"#015140","mintgreen-75":"#C0F5E3","mintgreen-800":"#00382B","mintgreen-900":"#032019","mintgreen-950":"#03140F","orangered-100":"#FCDBCF","orangered-200":"#FDB498","orangered-25":"#FDF6F4","orangered-300":"#FF895D","orangered-400":"#FF4500","orangered-50":"#FCEEE8","orangered-500":"#D93900","orangered-600":"#AE2C00","orangered-700":"#842100","orangered-75":"#FBE5DC","orangered-800":"#591B02","orangered-900":"#2F1405","orangered-950":"#1C0D04","periwinkle-100":"#E6DFFB","periwinkle-200":"#CDBEFD","periwinkle-25":"#F9F7FD","periwinkle-300":"#B29FFF","periwinkle-400":"#9580FF","periwinkle-50":"#F2EFFC","periwinkle-500":"#6A5CFF","periwinkle-600":"#523DFF","periwinkle-700":"#4001EA","periwinkle-75":"#ECE7FB","periwinkle-800":"#250AA6","periwinkle-900":"#160E5B","periwinkle-950":"#0C083F","poopbrown-100":"#FEEEDD","poopbrown-200":"#F6DDC3","poopbrown-300":"#EECCAA","poopbrown-400":"#CAA075","poopbrown-50":"#FEF7EE","poopbrown-500":"#9A6D3F","poopbrown-600":"#6E4924","poopbrown-700":"#54371A","poopbrown-800":"#3B2510","poopbrown-900":"#29190A","poopbrown-950":"#110B04","puregray-100":"#F2F2F2","puregray-150":"#EBEBEB","puregray-200":"#E4E4E4","puregray-250":"#DDDDDD","puregray-300":"#D6D6D6","puregray-350":"#C3C3C3","puregray-400":"#ACACAC","puregray-450":"#919191","puregray-50":"#F8F8F8","puregray-500":"#767676","puregray-550":"#5C5C5C","puregray-600":"#434343","puregray-650":"#393939","puregray-700":"#303030","puregray-750":"#272727","puregray-800":"#1E1E1E","puregray-850":"#181818","puregray-900":"#131313","puregray-950":"#080808","red-100":"#FBDBD4","red-200":"#FDB3A4","red-25":"#FDF6F5","red-300":"#FF8773","red-400":"#FF4F40","red-50":"#FCEEEA","red-500":"#EB001F","red-600":"#BC0117","red-700":"#90000F","red-75":"#FBE4DF","red-800":"#650405","red-900":"#340F05","red-950":"#1F0B04","sakurapink-100":"#FBD9EB","sakurapink-200":"#FDAEDA","sakurapink-25":"#FDF6F9","sakurapink-300":"#FF7ECA","sakurapink-400":"#FF38BB","sakurapink-50":"#FCEDF4","sakurapink-500":"#DE019F","sakurapink-600":"#B2007F","sakurapink-700":"#880060","sakurapink-75":"#FBE3EF","sakurapink-800":"#5F0443","sakurapink-900":"#380626","sakurapink-950":"#250419",transparent:"transparent",white:"#ffffff","white-opacity-0":"#FFFFFF00","white-opacity-10":"#FFFFFF19","white-opacity-15":"#FFFFFF26","white-opacity-20":"#FFFFFF33","white-opacity-25":"#FFFFFF3F","white-opacity-5":"#FFFFFF0C","white-opacity-50":"#FFFFFF7F","yellow-100":"#FFE284","yellow-200":"#FFBF0B","yellow-25":"#FFF9E0","yellow-300":"#D8A100","yellow-400":"#B78800","yellow-50":"#FFF3C0","yellow-500":"#977000","yellow-600":"#785800","yellow-700":"#5B4200","yellow-75":"#FFEAA2","yellow-800":"#3F2D00","yellow-900":"#231A03","yellow-950":"#161003","yelloworange-100":"#FCDCC8","yelloworange-200":"#FDB586","yelloworange-25":"#FDF7F3","yelloworange-300":"#FF8A35","yelloworange-400":"#E46C00","yelloworange-50":"#FCEEE6","yelloworange-500":"#BD5800","yelloworange-600":"#974500","yelloworange-700":"#733300","yelloworange-75":"#FBE5D7","yelloworange-800":"#4E2402","yelloworange-900":"#2A1705","yelloworange-950":"#1A0E04","action-downvote":{light:"#6A5CFF",dark:"#6A5CFF"},"action-upvote":{light:"#D93900",dark:"#D93900"},"ai-background-weaker":{light:"#E7FDF5",dark:"#00382B"},"ai-plain":{light:"#006C56",dark:"#01A484"},"ai-plain-hover":{light:"#015140",dark:"#00C29D"},"alert-caution":{light:"#977000",dark:"#977000"},"avatar-gradient":{light:"",dark:""},"brand-background":{light:"#D93900",dark:"#D93900"},"brand-background-hover":{light:"#AE2C00",dark:"#AE2C00"},"brand-gradient-active":{light:"",dark:""},"brand-gradient-active-highlight":{light:"",dark:""},"brand-gradient-default":{light:"",dark:""},"brand-gradient-default-highlight":{light:"",dark:""},"brand-gradient-hover":{light:"",dark:""},"brand-gradient-hover-highlight":{light:"",dark:""},"brand-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"category-live":{light:"#D93900",dark:"#D93900"},"category-nsfw":{light:"#DE019F",dark:"#DE019F"},"category-spoiler":{light:"#131313",dark:"#F2F2F2"},"caution-background":{light:"#FFBF0B",dark:"#D8A100"},"caution-background-hover":{light:"#D8A100",dark:"#FFBF0B"},"caution-onBackground":{light:"#000000",dark:"#000000"},"caution-plain":{light:"#785800",dark:"#FFBF0B"},"caution-plain-hover":{light:"#5B4200",dark:"#FFE284"},"danger-background":{light:"#EB001F",dark:"#BC0117"},"danger-background-disabled":{light:"#FDB3A4",dark:"#340F05"},"danger-background-hover":{light:"#BC0117",dark:"#EB001F"},"danger-background-weaker":{light:"#FBDBD4",dark:"#650405"},"danger-content":{light:"#BC0117",dark:"#FF4F40"},"danger-content-default":{light:"#ffffff",dark:"#ffffff"},"danger-content-hover":{light:"#90000F",dark:"#FF8773"},"danger-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"danger-plain":{light:"#BC0117",dark:"#FF8773"},"danger-plain-hover":{light:"#90000F",dark:"#FDB3A4"},"downvote-background":{light:"#6A5CFF",dark:"#6A5CFF"},"downvote-background-disabled":{light:"#6a5cff4d",dark:"#6a5cff4d"},"downvote-background-hover":{light:"#523DFF",dark:"#523DFF"},"downvote-content":{light:"#523DFF",dark:"#9580FF"},"downvote-content-weak":{light:"#6A5CFF",dark:"#6A5CFF"},"downvote-disabled":{light:"#523DFF4c",dark:"#9580FF4c"},"downvote-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"downvote-onStrongScrim":{light:"#B29FFF",dark:"#B29FFF"},"downvote-onStrongScrim-disabled":{light:"#b29fff4d",dark:"#b29fff4d"},"downvote-onStrongScrim-weaker":{light:"#9580FF",dark:"#9580FF"},"downvote-plain":{light:"#523DFF",dark:"#9580FF"},"downvote-plain-disabled":{light:"#523dff4d",dark:"#9580ff4d"},"downvote-plain-weaker":{light:"#6A5CFF",dark:"#6A5CFF"},"elevation-large1":{light:"#0000003F",dark:"#0000007F"},"elevation-large2":{light:"#00000026",dark:"#00000033"},"elevation-medium1":{light:"#0000003F",dark:"#0000007F"},"elevation-medium2":{light:"#00000019",dark:"#00000033"},"elevation-small":{light:"#00000026",dark:"#00000054"},"elevation-xsmall":{light:"#0000003F",dark:"#000000AA"},favorite:{light:"#977000",dark:"#B78800"},"global-admin":{light:"#D93900",dark:"#D93900"},"global-alienblue":{light:"#1870F4",dark:"#1870F4"},"global-darkblue":{light:"#2A3236",dark:"#2A3236"},"global-focus":{light:"#029DD5",dark:"#007FAE"},"global-gold":{light:"#B78800",dark:"#D8A100"},"global-moderator":{light:"#008A10",dark:"#008A10"},"global-nsfw":{light:"#DE019F",dark:"#DE019F"},"global-offline":{light:"#667780",dark:"#667780"},"global-online":{light:"#00C61C",dark:"#00C61C"},"global-orangered":{light:"#FF4500",dark:"#FF4500"},"global-stars":{light:"#977000",dark:"#D8A100"},"gradient-media":{light:"",dark:""},"gradient-media-strong":{light:"",dark:""},"identity-admin":{light:"#D93900",dark:"#D93900"},"identity-coins":{light:"#B78800",dark:"#B78800"},"identity-moderator":{light:"#008A10",dark:"#008A10"},"identity-self":{light:"#01876D",dark:"#01876D"},"interactive-background-disabled":{light:"#0000000C",dark:"#FFFFFF0C"},"interactive-content-disabled":{light:"#0000003F",dark:"#FFFFFF3F"},"interactive-focused":{light:"#007FAE",dark:"#007FAE"},"interactive-pressed":{light:"#00000026",dark:"#FFFFFF26"},"inverted-interactive-background-disabled":{light:"#FFFFFF0C",dark:"#0000000C"},"inverted-interactive-content-disabled":{light:"#FFFFFF3F",dark:"#0000003F"},"inverted-interactive-pressed":{light:"#FFFFFF26",dark:"#00000026"},"inverted-neutral-background":{light:"#0E1113",dark:"#FFFFFF"},"inverted-neutral-background-hover":{light:"#181C1F",dark:"#F6F8F9"},"inverted-neutral-border":{light:"#FFFFFF33",dark:"#00000033"},"inverted-neutral-content":{light:"#B7CAD4",dark:"#333D42"},"inverted-neutral-content-strong":{light:"#EEF1F3",dark:"#181C1F"},"inverted-secondary-background":{light:"#2A3236",dark:"#E5EBEE"},"inverted-secondary-background-hover":{light:"#333D42",dark:"#DBE4E9"},"inverted-secondary-background-selected":{light:"#3D494E",dark:"#C9D7DE"},"inverted-secondary-onBackground":{light:"#FFFFFF",dark:"#000000"},"inverted-secondary-plain":{light:"#DBE4E9",dark:"#181C1F"},"inverted-secondary-plain-hover":{light:"#FFFFFF",dark:"#000000"},"media-background":{light:"#00000099",dark:"#00000099"},"media-background-hover":{light:"#000000cc",dark:"#000000cc"},"media-background-selected":{light:"#000000cc",dark:"#000000cc"},"media-border-selected":{light:"#FFFFFF",dark:"#FFFFFF"},"media-border-weak":{light:"#FFFFFF19",dark:"#FFFFFF19"},"media-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"media-onBackground-disabled":{light:"#FFFFFF3F",dark:"#FFFFFF3F"},"media-onBackground-weak":{light:"#E5EBEE",dark:"#E5EBEE"},"media-onbackground":{light:"#ffffff",dark:"#ffffff"},"media-onbackground-disabled":{light:"#ffffff3f",dark:"#ffffff3f"},"media-onbackground-weak":{light:"#B7CAD4",dark:"#B7CAD4"},"neutral-background":{light:"#FFFFFF",dark:"#0E1113"},"neutral-background-container":{light:"#F6F8F9",dark:"#181C1F"},"neutral-background-container-hover":{light:"#EEF1F3",dark:"#21272A"},"neutral-background-container-strong":{light:"#EEF1F3",dark:"#21272A"},"neutral-background-container-strong-hover":{light:"#E5EBEE",dark:"#2A3236"},"neutral-background-gilded":{light:"#FFF9E0",dark:"#181C1F"},"neutral-background-gilded-hover":{light:"#FFF3C0",dark:"#21272A"},"neutral-background-hover":{light:"#F6F8F9",dark:"#181C1F"},"neutral-background-medium":{light:"#F8F8F8",dark:"#131313"},"neutral-background-pinned":{light:"#FFFFFF",dark:"#0E1113"},"neutral-background-selected":{light:"#E5EBEE",dark:"#2A3236"},"neutral-background-strong":{light:"#FFFFFF",dark:"#181C1F"},"neutral-background-strong-hover":{light:"#F6F8F9",dark:"#21272A"},"neutral-background-weak":{light:"#F6F8F9",dark:"#000000"},"neutral-background-weak-hover":{light:"#EEF1F3",dark:"#0E1113"},"neutral-border":{light:"#00000033",dark:"#FFFFFF33"},"neutral-border-medium":{light:"#0000007F",dark:"#FFFFFF7F"},"neutral-border-strong":{light:"#181C1F",dark:"#F6F8F9"},"neutral-border-weak":{light:"#00000019",dark:"#FFFFFF19"},"neutral-content":{light:"#333D42",dark:"#B7CAD4"},"neutral-content-disabled":{light:"#D6D6D6",dark:"#303030"},"neutral-content-strong":{light:"#181C1F",dark:"#EEF1F3"},"neutral-content-weak":{light:"#5C6C74",dark:"#8BA2AD"},offline:{light:"#767676",dark:"#767676"},online:{light:"#01A816",dark:"#01A816"},"opacity-08":{light:"#13131314",dark:"#13131314"},"opacity-50":{light:"#0000007f",dark:"#F2F2F27f"},"opacity-highlight":{light:"",dark:""},pizzaRed:{light:"#ef5350",dark:"#c62828"},primary:{light:"#115BCA",dark:"#648EFC"},"primary-background":{light:"#0A449B",dark:"#115BCA"},"primary-background-hover":{light:"#0A2F6C",dark:"#1870F4"},"primary-background-selected":{light:"#0A1A3F",dark:"#648EFC"},"primary-border":{light:"#0A449B",dark:"#648EFC"},"primary-border-hover":{light:"#0A2F6C",dark:"#90A9FD"},"primary-hover":{light:"#0A449B",dark:"#90A9FD"},"primary-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"primary-onBackground-selected":{light:"#FFFFFF",dark:"#000000"},"primary-plain":{light:"#0A449B",dark:"#648EFC"},"primary-plain-hover":{light:"#0A2F6C",dark:"#90A9FD"},"primary-plain-visited":{light:"#7600A3",dark:"#CF5FFF"},"primary-visited":{light:"#9B00D4",dark:"#CF5FFF"},scrim:{light:"#00000099",dark:"#00000099"},"scrim-background":{light:"#00000099",dark:"#00000099"},"scrim-background-strong":{light:"#000000CC",dark:"#000000CC"},"scrim-gradient":{light:"",dark:""},"scrim-strong":{light:"#000000cc",dark:"#000000cc"},secondary:{light:"#21272A",dark:"#DBE4E9"},"secondary-background":{light:"#E5EBEE",dark:"#2A3236"},"secondary-background-hover":{light:"#DBE4E9",dark:"#333D42"},"secondary-background-selected":{light:"#C9D7DE",dark:"#3D494E"},"secondary-hover":{light:"#000000",dark:"#ffffff"},"secondary-onBackground":{light:"#000000",dark:"#FFFFFF"},"secondary-plain":{light:"#181C1F",dark:"#DBE4E9"},"secondary-plain-hover":{light:"#000000",dark:"#FFFFFF"},"secondary-plain-weak":{light:"#5C6C74",dark:"#8BA2AD"},"secondary-weak":{light:"#576F76",dark:"#748791"},"success-background":{light:"#008A10",dark:"#016E0B"},"success-background-hover":{light:"#016E0B",dark:"#008A10"},"success-content":{light:"#016E0B",dark:"#01A816"},"success-hover":{light:"#005306",dark:"#00C61C"},"success-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"success-plain":{light:"#016E0B",dark:"#00C61C"},"success-plain-hover":{light:"#005306",dark:"#58E15B"},"tone-1":{light:"#131313",dark:"#F2F2F2"},"tone-2":{light:"#434343",dark:"#ACACAC"},"tone-3":{light:"#ACACAC",dark:"#434343"},"tone-4":{light:"#E4E4E4",dark:"#303030"},"tone-5":{light:"#F2F2F2",dark:"#1E1E1E"},"tone-6":{light:"#F8F8F8",dark:"#131313"},"tone-7":{light:"#ffffff",dark:"#080808"},"transparent-background-hover":{light:"#74879119",dark:"#66778019"},"ui-canvas":{light:"#F2F2F2",dark:"#080808"},"ui-modalbackground":{light:"#FFFFFF",dark:"#181C1F"},"upvote-background":{light:"#D93900",dark:"#D93900"},"upvote-background-disabled":{light:"#d939004d",dark:"#d939004d"},"upvote-background-hover":{light:"#AE2C00",dark:"#AE2C00"},"upvote-content":{light:"#AE2C00",dark:"#FF4500"},"upvote-content-weak":{light:"#FF4500",dark:"#FF4500"},"upvote-disabled":{light:"#AE2C004c",dark:"#FF45004c"},"upvote-onBackground":{light:"#FFFFFF",dark:"#FFFFFF"},"upvote-onStrongScrim":{light:"#FF895D",dark:"#FF895D"},"upvote-onStrongScrim-disabled":{light:"#ff895d4d",dark:"#ff895d4d"},"upvote-onStrongScrim-weaker":{light:"#FF4500",dark:"#FF4500"},"upvote-plain":{light:"#AE2C00",dark:"#FF895D"},"upvote-plain-disabled":{light:"#ae2c004d",dark:"#ff895d4d"},"upvote-plain-weaker":{light:"#FF4500",dark:"#FF4500"},"warning-background":{light:"#B78800",dark:"#B78800"},"warning-background-hover":{light:"#977000",dark:"#D8A100"},"warning-content":{light:"#785800",dark:"#B78800"},"warning-content-hover":{light:"#5B4200",dark:"#D8A100"},"warning-onBackground":{light:"#000000",dark:"#000000"}};var _d={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",transparent:"#FFFFFF00",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Hd=i=>!!i.match(/^(#[0-9a-fA-F]{3,8}).*/),jd=i=>i in zo,qo=i=>i in _d,Wd=i=>!!i.match(/^rgba?\(.*/),Vd=i=>!!i.match(/^hsla?\(.*/),Gd=(i,e="light")=>{if(qo(i))return Vs(i);let r=zo[i];return typeof r=="string"?r:r[e]},Vs=i=>_d[i]??i,Jd=i=>{let[e,t,r,s]=i.replace(/^rgba?\(|\s+|\)$/g,"").split(",");if(!e||!t||!r)return i;let d=[...[e,t,r].map(m=>parseFloat(m))];if(s){let m=parseFloat(s),y=Math.round(m*255);d.push(y)}return`#${d.map(m=>m.toString(16).padStart(2,"0")).join("")}`};import{BlockStackDirection as Gs}from"@devvit/protos";var $o={stackParentLayout:{hasHeight:!0,hasWidth:!0,direction:Gs.UNRECOGNIZED,alignment:void 0}};function qd(i,e,t){if(!e)return{hasHeight:!1,hasWidth:!1};let{growDirection:r,stretchDirection:s}=nm(i?.grow,e.direction,e.alignment),o=t?.height?.value?.value||t?.height?.min?.value||zd(2,r,s,e.hasHeight),d=t?.width?.value?.value||t?.width?.min?.value||zd(1,r,s,e.hasWidth);return{hasHeight:!!o,hasWidth:!!d}}function zd(i,e,t,r){return e===i&&r||t===i&&r}function nm(i,e,t){let r=e===Gs.STACK_VERTICAL||e===Gs.UNRECOGNIZED,s=e===Gs.STACK_HORIZONTAL,o=0;s&&i?o=1:r&&i&&(o=2);let d=t===void 0||t.horizontal===void 0,c=t===void 0||t.vertical===void 0,m=s?!!c:r?!!d:!1,y=0;return s&&m?y=2:r&&m&&(y=1),{growDirection:o,stretchDirection:y}}import{BlockSizeUnit as xt,BlockStackDirection as Js}from"@devvit/protos";function bi(i){if(i==null)return;if(typeof i=="number")return{value:i,unit:xt.SIZE_UNIT_PERCENT};let e=i.match(/^(\d+(?:\.\d+)?)(px|%)?$/);if(e==null)return;let t=xt.SIZE_UNIT_PERCENT;return e.at(2)==="px"&&(t=xt.SIZE_UNIT_PIXELS),{value:Number.parseFloat(e[1]),unit:t}}function sm(i,e){return(i.width?.value?.unit===xt.SIZE_UNIT_PERCENT||i.width?.min?.unit===xt.SIZE_UNIT_PERCENT)&&(e.direction===Js.STACK_HORIZONTAL||e.direction===Js.STACK_DEPTH)&&(e.hasWidth||(i.width=void 0)),(i.height?.value?.unit===xt.SIZE_UNIT_PERCENT||i.height?.min?.unit===xt.SIZE_UNIT_PERCENT)&&(e.direction===Js.STACK_VERTICAL||e.direction===Js.STACK_DEPTH)&&(e.hasHeight||(i.height=void 0)),i}function Ko(i,e){if(i){let t=i.width!=null||i.minWidth!=null||i.maxWidth!=null,r=i.height!=null||i.minHeight!=null||i.maxHeight!=null;if(t||r||i.grow!=null){let s={width:t?{value:bi(i.width),min:bi(i.minWidth),max:bi(i.maxWidth)}:void 0,height:r?{value:bi(i.height),min:bi(i.minHeight),max:bi(i.maxHeight)}:void 0,grow:i.grow};return e.stackParentLayout&&(s=sm(s,e.stackParentLayout)),s}}}var Xd="data-",om=new Set(["onPress","onMessage"]),am=new Map([["onPress",na.ACTION_CLICK],["onMessage",na.ACTION_WEBVIEW]]),Hr,vi=class{constructor(e=()=>{}){l(this,Hr);a(this,Hr,e)}createBlocksElementOrThrow({type:e,props:t,children:r}){let s=this.createBlocksElement({type:e,props:t,children:r},$o);if(!s)throw new Error(`Could not create block of type ${e}`);return s}createBlocksElement({type:e,props:t,children:r},s){switch(e){case"blocks":return this.makeRoot(t,...r);case"hstack":return this.makeHStack(t,s,...r);case"vstack":return this.makeVStack(t,s,...r);case"zstack":return this.makeZStack(t,s,...r);case"text":return this.makeText(t,s,...r);case"button":return this.makeButton(t,s,...r);case"image":return this.makeImage(t,s);case"spacer":return this.makeSpacer(t,s);case"icon":return this.makeIcon(t,s);case"avatar":return this.makeAvatar(t,s);case"webview":return this.makeWebView(t,s);case"__fragment":throw new Error("root fragment is not supported - use 'blocks' instead")}}makeRootHeight(e){switch(e){case"regular":return 320;case"tall":return 512}}makeBlockPadding(e){switch(e){case"none":return Lr.PADDING_NONE;case"xsmall":return Lr.PADDING_XSMALL;case"small":return Lr.PADDING_SMALL;case"medium":return Lr.PADDING_MEDIUM;case"large":return Lr.PADDING_LARGE}}makeBlockRadius(e){switch(e){case"none":return _r.RADIUS_NONE;case"small":return _r.RADIUS_SMALL;case"medium":return _r.RADIUS_MEDIUM;case"large":return _r.RADIUS_LARGE;case"full":return _r.RADIUS_FULL}}makeBlockGap(e){switch(e){case"none":return qs.GAP_NONE;case"small":return qs.GAP_SMALL;case"medium":return qs.GAP_MEDIUM;case"large":return qs.GAP_LARGE}}makeBlockAlignment(e){if(e===void 0)return;let t,r;if(e.includes("top")?t=ra.ALIGN_TOP:e.includes("middle")?t=ra.ALIGN_MIDDLE:e.includes("bottom")&&(t=ra.ALIGN_BOTTOM),e.includes("start")?r=Xo.ALIGN_START:e.includes("center")?r=Xo.ALIGN_CENTER:e.includes("end")&&(r=Xo.ALIGN_END),t!==void 0||r!==void 0)return{vertical:t,horizontal:r}}makeBlockBorder(e,t,r,s){if(!e&&!t)return;let o;switch(e){case"none":o=zs.BORDER_WIDTH_NONE;break;case"thin":o=zs.BORDER_WIDTH_THIN;break;case"thick":o=zs.BORDER_WIDTH_THICK;break;default:o=zs.BORDER_WIDTH_THIN;break}let d=t??"neutral-border-weak",c=this.getThemedColors(d,r,s);return{width:o,color:c?.light,colors:c}}makeBlockTextSize(e){switch(e){case"xsmall":return yi.TEXT_SIZE_XSMALL;case"small":return yi.TEXT_SIZE_SMALL;case"medium":return yi.TEXT_SIZE_MEDIUM;case"large":return yi.TEXT_SIZE_LARGE;case"xlarge":return yi.TEXT_SIZE_XLARGE;case"xxlarge":return yi.TEXT_SIZE_XXLARGE}}makeBlockTextStyle(e){switch(e){case"body":return ia.TEXT_STYLE_BODY;case"metadata":return ia.TEXT_STYLE_METADATA;case"heading":return ia.TEXT_STYLE_HEADING}}makeBlockTextOutline(e){switch(e){case"none":return ea.TEXT_OUTLINE_NONE;case"thin":return ea.TEXT_OUTLINE_THIN;case"thick":return ea.TEXT_OUTLINE_THICK}}makeBlockTextWeight(e){switch(e){case"regular":return Zd.TEXT_WEIGHT_REGULAR;case"bold":return Zd.TEXT_WEIGHT_BOLD}}makeBlockTextOverflow(e){switch(e){case"clip":return ta.TEXT_OVERFLOW_CLIP;case"ellipsis":return ta.TEXT_OVERFLOW_ELLIPSE}return ta.TEXT_OVERFLOW_ELLIPSE}makeBlockButtonAppearance(e){switch(e){case"secondary":return Xe.BUTTON_APPEARANCE_SECONDARY;case"primary":return Xe.BUTTON_APPEARANCE_PRIMARY;case"plain":return Xe.BUTTON_APPEARANCE_PLAIN;case"bordered":return Xe.BUTTON_APPEARANCE_BORDERED;case"media":return Xe.BUTTON_APPEARANCE_MEDIA;case"destructive":return Xe.BUTTON_APPEARANCE_DESTRUCTIVE;case"caution":return Xe.BUTTON_APPEARANCE_CAUTION;case"success":return Xe.BUTTON_APPEARANCE_SUCCESS}}makeBlockButtonSize(e){switch(e){case"small":return Zo.BUTTON_SIZE_SMALL;case"medium":return Zo.BUTTON_SIZE_MEDIUM;case"large":return Zo.BUTTON_SIZE_LARGE}}makeBlockImageResizeMode(e){switch(e){case"none":return Nr.IMAGE_RESIZE_NONE;case"fit":return Nr.IMAGE_RESIZE_FIT;case"fill":return Nr.IMAGE_RESIZE_FILL;case"cover":return Nr.IMAGE_RESIZE_COVER;case"scale-down":return Nr.IMAGE_RESIZE_SCALE_DOWN}}makeBlockSpacerSize(e){switch(e){case"xsmall":return Ks.SPACER_XSMALL;case"small":return Ks.SPACER_SMALL;case"medium":return Ks.SPACER_MEDIUM;case"large":return Ks.SPACER_LARGE}}makeBlockSpacerShape(e){switch(e){case"invisible":return Qo.SPACER_INVISIBLE;case"thin":return Qo.SPACER_THIN;case"square":return Qo.SPACER_SQUARE}}makeBlockIconSize(e){switch(e){case"xsmall":return $s.ICON_SIZE_XSMALL;case"small":return $s.ICON_SIZE_SMALL;case"medium":return $s.ICON_SIZE_MEDIUM;case"large":return $s.ICON_SIZE_LARGE}}makeBlockAvatarSize(e){switch(e){case"xxsmall":return Ze.AVATAR_SIZE_XXSMALL;case"xsmall":return Ze.AVATAR_SIZE_XSMALL;case"small":return Ze.AVATAR_SIZE_SMALL;case"medium":return Ze.AVATAR_SIZE_MEDIUM;case"large":return Ze.AVATAR_SIZE_LARGE;case"xlarge":return Ze.AVATAR_SIZE_XXLARGE;case"xxlarge":return Ze.AVATAR_SIZE_XXLARGE;case"xxxlarge":return Ze.AVATAR_SIZE_XXXLARGE}}makeBlockAvatarFacing(e){switch(e){case"left":return Kd.AVATAR_FACING_LEFT;case"right":return Kd.AVATAR_FACING_RIGHT}}makeBlockAvatarBackground(e){switch(e){case"dark":return $d.AVATAR_BG_DARK;case"light":return $d.AVATAR_BG_LIGHT}}getDataSet(e){return Object.keys(e).filter(t=>t.startsWith(Xd)).reduce((t,r)=>(t[r.substring(Xd.length)]=e[r],t),{})}makeActions(e,t){let r=[],s=this.getDataSet(t);return om.forEach(o=>{if(o in t){let d=t[o];r.push({type:am.get(o)??na.UNRECOGNIZED,id:d.toString(),data:s})}}),r}blockColorToHex(e,t="light"){if(e)return e=e.toLowerCase(),Hd(e)?e:jd(e)?Gd(e,t):qo(e)?Vs(e):Wd(e)?Jd(e):Vd(e)?e:(console.warn(`Could not parse color: ${e}.`),Vs("red"))}childrenToBlocks(e,t){return e.flatMap(r=>(typeof r!="string"?this.createBlocksElement(r,t):void 0)??[])}getThemedColors(e,t,r){let s=this.blockColorToHex(t,"light"),o=this.blockColorToHex(r,"dark"),d=[];if(e&&(!s||!o)){let c=Array.from(e?.matchAll(/[\w#-]+(?:\([\w\t ,.#-]+\))?/g)??[]);d.push(...c.map(m=>m[0]))}return s||(s=this.blockColorToHex(d?.at(0),"light")),o||(o=this.blockColorToHex(d?.at(1)??d?.at(0),"dark")),s||o?{light:s,dark:o}:void 0}parsePixels(e){return typeof e=="string"?Number(e.slice(0,-2)):e}resolveAssetUrl(e,t){return n(this,Hr).call(this)?.getURL(e,t)??e}childrenToString(e){return e.map(t=>t.toString()).join("")}makeRoot(e,...t){return this.wrapRoot(e,this.childrenToBlocks(t,$o))}wrapRoot(e,t){return this.makeBlock(Ee.BLOCK_ROOT,{},{},{rootConfig:{children:t,height:this.makeRootHeight(u.customPostType?.height??e?.height??"regular")}})}makeStackBlock(e,t,r,s){let o=this.getThemedColors(t?.backgroundColor,t?.lightBackgroundColor,t?.darkBackgroundColor),d=this.makeBlockAlignment(t?.alignment),c=Ko(t,r),m=qd(t,r.stackParentLayout,c);return this.makeBlock(Ee.BLOCK_STACK,t,r,{stackConfig:{alignment:d,backgroundColor:o?.light,backgroundColors:o,border:this.makeBlockBorder(t?.border,t?.borderColor,t?.lightBorderColor,t?.darkBorderColor),children:this.childrenToBlocks(s,{stackParentLayout:{...m,direction:e,alignment:d}}),cornerRadius:this.makeBlockRadius(t?.cornerRadius),direction:e,gap:this.makeBlockGap(t?.gap),padding:this.makeBlockPadding(t?.padding),reverse:t?.reverse}})}makeHStack(e,t,...r){return this.makeStackBlock(Yo.STACK_HORIZONTAL,e,t,r)}makeVStack(e,t,...r){return this.makeStackBlock(Yo.STACK_VERTICAL,e,t,r)}makeZStack(e,t,...r){return this.makeStackBlock(Yo.STACK_DEPTH,e,t,r)}makeText(e,t,...r){let s=this.getThemedColors(e?.color,e?.lightColor,e?.darkColor);return this.makeBlock(Ee.BLOCK_TEXT,e,t,{textConfig:{alignment:this.makeBlockAlignment(e?.alignment),color:s?.light,colors:s,outline:this.makeBlockTextOutline(e?.outline),size:this.makeBlockTextSize(e?.size),style:this.makeBlockTextStyle(e?.style),text:this.childrenToString(r),weight:this.makeBlockTextWeight(e?.weight),selectable:e?.selectable,wrap:e?.wrap,overflow:this.makeBlockTextOverflow(e?.overflow)}})}makeButton(e,t,...r){let s=this.getThemedColors(e?.textColor,e?.lightTextColor,e?.darkTextColor);return this.makeBlock(Ee.BLOCK_BUTTON,e,t,{buttonConfig:{buttonAppearance:this.makeBlockButtonAppearance(e?.appearance),icon:e?.icon,buttonSize:this.makeBlockButtonSize(e?.size),text:this.childrenToString(r),textColor:s?.light,textColors:s,disabled:e?.disabled}})}makeImage(e,t){return e&&this.makeBlock(Ee.BLOCK_IMAGE,e,t,{imageConfig:{description:e?.description,resizeMode:this.makeBlockImageResizeMode(e.resizeMode),url:this.resolveAssetUrl(e.url),width:this.parsePixels(e.imageWidth),height:this.parsePixels(e.imageHeight)}})}makeSpacer(e,t){return this.makeBlock(Ee.BLOCK_SPACER,e,t,{spacerConfig:{size:this.makeBlockSpacerSize(e?.size),shape:this.makeBlockSpacerShape(e?.shape)}})}makeIcon(e,t){let r=this.getThemedColors(e?.color,e?.lightColor,e?.darkColor);return e&&this.makeBlock(Ee.BLOCK_ICON,e,t,{iconConfig:{icon:e.name,color:r?.light,colors:r,size:this.makeBlockIconSize(e.size)}})}makeAvatar(e,t){return e&&this.makeBlock(Ee.BLOCK_AVATAR,e,t,{avatarConfig:{thingId:e.thingId,size:this.makeBlockAvatarSize(e.size),facing:this.makeBlockAvatarFacing(e.facing),background:this.makeBlockAvatarBackground(e.background)}})}makeWebView(e,t){return e&&this.makeBlock(Ee.BLOCK_WEBVIEW,e,t,{webviewConfig:{url:this.resolveAssetUrl(e.url,{webView:!0}),state:e.state}})}makeBlock(e,t,r,s){return{type:e,sizes:Ko(t,r),config:s,actions:(t&&this.makeActions(e,t))??[],id:t?.id,key:t?.key}}ensureRootBlock(e){let t;if(e.type===Ee.BLOCK_ROOT?(e.config?.rootConfig&&u.customPostType?.height&&(e.config.rootConfig.height=this.makeRootHeight(u.customPostType?.height)),t=e):t=this.wrapRoot(void 0,[e]),!t)throw new Error("Could not create root block");return t}};Hr=new WeakMap;function Yd(i){if(typeof i=="string")throw new Error("Root element cannot be a string")}var el=i=>{let e="",t=i.props?Object.keys(i.props).map(r=>r==="onPress"?"":`${r}="${i.props[r]}"`).join(" "):"";e+=`<${i.type}${t?" "+t:""}>`;for(let r of i.children)typeof r=="string"?e+=r:e+=el(r);return e+=`</${i.type}>`,e};function dm(i){return"  ".repeat(i)}function lm(i){let e="",t=0,r=i.split(/>\s*</);for(let s=0;s<r.length;s++){let o=r[s];s===0&&(o=o.trim()),s===r.length-1&&(o=o.trim());let d=o.charAt(0)==="/";d&&t--,e+=dm(t),s!==0&&(e+="<"),e+=o,s!==r.length-1&&(e+=`>
`),!d&&o.indexOf("</")===-1&&o.charAt(o.length-1)!=="/"&&t++}return e}var Ce,tl,jr,oa,Wr,De=class{constructor(e,t,r,s,o){l(this,Ce);this.renderState={};this.currentComponentKey=[];this.currentHookIndex=0;this.actions=new Map;this.forms=new Map;this.realtimeChannels=[];this.realtimeUpdated=!1;this.pendingHooks=[];this.isRendering=!1;this.transformer=new vi(()=>this.assets);this.effects=[];l(this,Wr,!1);this.component=e,this.event=t,this.state={__renderState:{},...r},this.metadata=s,this.state.__realtimeChannels&&(this.realtimeChannels=this.state.__realtimeChannels);let d=ke({reconciler:this,hooks:!0,ui:!0,metadata:s});this.cache=d.cache,this.modLog=d.modLog,this.reddit=d.reddit,this.kvStore=d.kvStore,this.redis=d.redis,this.settings=d.settings,this.scheduler=d.scheduler,this.media=d.media,this.assets=d.assets,this.realtime=d.realtime,this.dimensions=o,this.ui=d.ui,this.hooks={useState:d.useState,useInterval:d.useInterval,useForm:d.useForm,useChannel:d.useChannel}}emitEffect(e,t){this.effects.push(t)}async render(){await this.reconcile(),this.isRendering=!0;let e=await this.buildBlocksUI();return this.isRendering=!1,e}makeUniqueActionID(e){let t=e,r=1;for(;this.actions.has(t);)t=`${e}.${r++}`;return t}async reconcile(){let e=h(this,Ce,jr).call(this),t={type:this.component,props:e,children:[]},r=await this.processBlock(t);if(Yd(r),this.transformer.createBlocksElementOrThrow(r),this.isUserActionRender&&this.blockRenderEventId){let s=this.actions.get(this.blockRenderEventId);s&&await s(this.event.data)}for(let s of this.pendingHooks)await s();this.buildNextState(),h(this,Ce,tl).call(this)}async buildBlocksUI(){let e=h(this,Ce,jr).call(this),t={type:this.component,props:e,children:[]},r=await this.renderElement(e,t);return this.transformer.ensureRootBlock(r)}async renderElement(e,t){let r=await this.processBlock(t);return Yd(r),(u.debug.emitSnapshots||e.debug.emitSnapshots)&&console.debug(lm(el(r))),(u.debug.emitState||e.debug.emitState)&&console.debug(JSON.stringify(this.state,void 0,2)),this.transformer.createBlocksElementOrThrow(r)}async processProps(e){let t=e.props??{},r=["onPress","onMessage"];for(let s of r)if(s in t){let o=t[s],d=o?.name,c=this.makeUniqueActionID(`${e.type}.${d??s}`);this.actions.set(c,o),t[s]=c}}async processBlock(e,t=Ld(),r=[]){let s=e;if(typeof s.type=="string"){let c=[];for(let f=0;f<s.children.length;f++){let S=s.children[f];S!=null&&c.push(await this.processBlock(S,t,[...r,`${s.type}.${f}`]))}let m=c.flat(),y=h(this,Ce,oa).call(this,m);return await this.processProps(s),{type:s.type,props:s.props,children:y}}if(typeof s.type=="function"){let c=t(`${r.length?r.join("."):"root"}.${s.type.name.length?s.type.name:"anonymous"}`);this.currentComponentKey.push(c),this.renderState[c]||(this.renderState[c]={});let m=s.children.flatMap(f=>f),y={...h(this,Ce,jr).call(this),...s.props,children:m},v;for(;v===void 0;)try{v=await s.type(y,h(this,Ce,jr).call(this))}catch(f){if(f instanceof Promise)v=await f;else throw f}if(!this.isInitialRender){let f=this.getPreviousComponentState();if(Object.keys(f).length!==this.currentHookIndex)throw new Error("Invalid hook call. Hooks can only be called at the top-level of a function component. Make sure that you are not calling hooks inside loops, conditions, or nested functions.")}if(this.currentComponentKey.pop(),this.currentHookIndex=0,typeof v=="object")return this.processBlock(v,t,[...r,s.type.name])}if(typeof s=="string")return s;if(typeof s=="number")return`${s}`;let o=[],d="";return Array.isArray(s)?o=s:typeof s.type>"u"&&s.children&&(o=s.children,d="fragmentChild."),{type:"__fragment",props:void 0,children:await Promise.all(o.flatMap(async(c,m)=>await this.processBlock(c,t,[...r,`${d}${m}`])))}}getCurrentComponentKey(){if(!this.currentComponentKey.at(-1))throw new Error("Current component key is missing");return this.currentComponentKey}getCurrentComponentState(){let e=this.currentComponentKey.at(-1);if(!e)throw new Error("Current component key is missing");return this.renderState[e]}getPreviousComponentState(){let e=this.currentComponentKey.at(-1);if(!e)throw new Error("Current component key is missing");return this.state.__renderState[e]||(this.state.__renderState[e]={}),this.state.__renderState[e]}get isInitialRender(){return this.event?this.event.type===sa.RENDER_INITIAL:!1}get isUserActionRender(){return this.event?this.event.type===sa.RENDER_USER_ACTION:!1}get isEffectRender(){return this.event?this.event.type===sa.RENDER_EFFECT_EVENT:!1}get formSubmittedEvent(){return this.event?this.event.formSubmitted:!1}get blockRenderEventId(){return this.event?this.event.id:!1}get realtimeEvent(){if(!this.event)return!1;let e=this.event.realtimeEvent;return e?.event?.channel?e:!1}runHook(e){this.pendingHooks.push(e)}rerenderIn(e){n(this,Wr)||(a(this,Wr,!0),this.effects.push({type:Qd.EFFECT_RERENDER_UI,rerenderUi:{delaySeconds:e/1e3}}))}addRealtimeChannel(e){this.realtimeChannels.push(e),this.realtimeUpdated=!0}removeRealtimeChannel(e){this.realtimeChannels=this.realtimeChannels.filter(t=>t!==e),this.realtimeUpdated=!0}get realtimeEffect(){return this.realtimeUpdated&&this.realtimeChannels.length>0?[{type:Qd.EFFECT_REALTIME_SUB,realtimeSubscriptions:{subscriptionIds:this.realtimeChannels}}]:[]}getEffects(){return[...fi(this.ui),...this.effects,...this.realtimeEffect]}buildNextState(){for(let e of Object.keys(this.renderState))this.renderState[e]=Object.values(this.renderState[e]);this.state={__postData:this.state.__postData,__renderState:this.renderState,__cache:this.state.__cache,...this.realtimeChannels.length>0?{__realtimeChannels:this.realtimeChannels}:{}}}};Ce=new WeakSet,tl=function(){this.actions.clear(),this.currentComponentKey=[],this.currentHookIndex=0,this.pendingHooks=[],this.realtimeChannels=[],this.realtimeUpdated=!1},jr=function(){let e={...se(this.metadata,this.state.__postData?.thingId),modLog:this.modLog,reddit:this.reddit,cache:this.cache,kvStore:this.kvStore,redis:this.redis,settings:this.settings,scheduler:this.scheduler,media:this.media,assets:this.assets,realtime:this.realtime,ui:this.ui,dimensions:this.dimensions,uiEnvironment:{timezone:this.metadata[P.Timezone]?.values[0],locale:this.metadata[P.Language]?.values[0],dimensions:this.dimensions},...this.hooks};return e.debug.effects=this,e},oa=function(e){let t=[];for(let r of e)typeof r=="string"?t.push(r):r.type==="__fragment"?t.push(...h(this,Ce,oa).call(this,r.children)):t.push(r);return t},Wr=new WeakMap;async function mm(i,e){let t=u.customPostType;if(!t)throw new Error("Custom post type not registered");let r=new De((o,d)=>t.render(d),i.blocks,i.state,e,i.dimensions),s=await r.render();return cm.fromJSON({state:r.state,blocks:{ui:s},effects:r.getEffects()})}function il(i){i.provides(um),R("RenderPost",mm)}import{GetFieldsResponse as pm,InstallationSettingsDefinition as gm}from"@devvit/protos";async function hm(){if(!u.installationSettings)throw new Error("Installation settings were not defined.");return pm.fromJSON({fields:{fields:Ue(u.installationSettings)}})}async function fm(i,e){return Ws(i,u.installationSettings,e)}function rl(i){i.provides(gm),R("GetSettingsFields",hm),R("ValidateForm",fm)}import{ContextActionDefinition as bm,ContextActionList as ym,ContextActionResponse as vm}from"@devvit/protos";function aa(i){let e=i.debug.metadata[P.User].values[0];if(!e)throw new Error("User missing from context");return e}function da(i){let e=i.debug.metadata[P.Subreddit].values[0];if(!e)throw new Error("Subreddit missing from context");return e}async function nl(i,e){let t=aa(i),r=da(i);if(!t||!r)throw new Error("User or subreddit missing from context");let s=e.comment?.id&&`t1_${e.comment.id}`,o=e.post?.id&&`t3_${e.post.id}`,d=e.subreddit?.id&&`t5_${e.subreddit.id}`,c=s||o||d;if(!c)throw new Error("targetId is missing from ContextActionRequest");if(s){let f=await i.reddit.getCommentById(s);if(!f)throw new Error(`Comment ${s} not found`);if(f.subredditId!==r)throw new Error("Comment does not belong to the subreddit")}if(o){let f=await i.reddit.getPostById(o);if(!f)throw new Error(`Post ${o} not found`);if(f.subredditId!==r)throw new Error("Post does not belong to the subreddit")}if(d&&d!==r)throw new Error(`Subreddit ${d} ${r} not found`);let m=Vr(e.actionId);if(!m)throw new Error("Action not found");let y=!!m.forUserType?.includes("moderator");if(y&&!sl(i))throw new Error("User is not a moderator");let v={needsModCheck:y};await i.redis.set(`${t}${r}${c}${e.actionId}`,JSON.stringify(v)),await i.redis.expire(`${t}${r}${c}${e.actionId}`,600),console.debug("CSRF token added: "+JSON.stringify(v))}async function sl(i){let e=aa(i),t=da(i),r=await i.reddit.getSubredditInfoById(t);return!!(await i.reddit.getModerators({subredditName:r.name}).all()).find(o=>o.id===e)}async function ol(i,e){let t=aa(i),r=da(i),{actionId:s,thingId:o}=e.state?.__contextAction??{},d=await i.redis.get(`${t}${r}${o}${s}`);if(!d)throw new Error("CSRF token not found");if(JSON.parse(d).needsModCheck&&!await sl(i))throw new Error("User is not a moderator: "+t+"; "+r);console.debug("CSRF token validated: "+d)}var al=i=>`menuItem.${i}`;function Vr(i){return u.menuItems.find((e,t)=>al(t)===i)}async function km(i,e){let t=u.menuItems;if(!t.length)throw new Error("No menu items registered.");let r=t.map((s,o)=>({actionId:al(o),name:s.label,description:s.description,contexts:{subreddit:s.location.includes("subreddit"),post:s.location.includes("post"),comment:s.location.includes("comment")},users:{loggedOut:s.forUserType?.includes("loggedOut"),moderator:s.forUserType?.includes("moderator")},postFilters:s.postFilter==="currentApp"?{currentApp:!0}:void 0}));return ym.fromJSON({actions:r})}async function Cm(i,e){let t=Vr(i.actionId);if(!t)throw new Error(`MenuItem ${i.actionId} not found`);let r=i.comment?.id&&`t1_${i.comment.id}`,s=i.post?.id&&`t3_${i.post.id}`,o=i.subreddit?.id&&`t5_${i.subreddit.id}`,d=r||s||o;p(d,"targetId is missing from ContextActionRequest");let c={targetId:d,location:i.comment?"comment":i.post?"post":"subreddit"},m=Object.assign(ke({ui:!0,metadata:e}),se(e,s,r),{uiEnvironment:{timezone:e[P.Timezone]?.values[0],locale:e[P.Language]?.values[0]}});return await nl(m,i),await t.onPress(c,m),vm.fromJSON({effects:fi(m.ui)})}function dl(i){i.provides(bm),R("GetActions",km),R("OnAction",Cm)}function Ne(i){return i?i===!0?!0:i.enabled:!1}import{SchedulerHandlerDefinition as Sm}from"@devvit/protos";async function Pm(i,e){let t=i.type,r=u.scheduledJobHandlers.get(t);if(!r)throw new Error(`Job ${t} not found`);let s={name:t,data:i.data},o=Object.assign(ke({metadata:e}),se(e));await r(s,o)}function ll(i){i.provides(Sm),R("HandleScheduledAction",Pm)}import{OnAppInstallDefinition as wm,OnAppUpgradeDefinition as Fm,OnAutomoderatorFilterCommentDefinition as xm,OnAutomoderatorFilterPostDefinition as Im,OnCommentCreateDefinition as Am,OnCommentDeleteDefinition as Em,OnCommentReportDefinition as Tm,OnCommentSubmitDefinition as Rm,OnCommentUpdateDefinition as Om,OnModActionDefinition as Mm,OnModMailDefinition as Bm,OnPostCreateDefinition as Um,OnPostDeleteDefinition as Dm,OnPostFlairUpdateDefinition as Nm,OnPostNsfwUpdateDefinition as Lm,OnPostReportDefinition as _m,OnPostSpoilerUpdateDefinition as Hm,OnPostSubmitDefinition as jm,OnPostUpdateDefinition as Wm}from"@devvit/protos";var ki;(function(i){function e(d,c){return d.length<=c?d:`${d.slice(0,c-1)}\u2026`}i.ellipsize=e;function t(d){return d[0]==null?d:`${d[0].toLocaleUpperCase()}${d.slice(1)}`}i.capitalize=t;function r(d){return d==null||/^\s*$/.test(d)}i.isBlank=r;function s(d,c="stack"){return d instanceof Error?`${d[c]||d.stack||d.message||d.name}`:String(d)}i.caughtToString=s;function o(d,c="stack"){return d instanceof Error?`${d[c]||d.stack||d.message||d.name}`:String(d)}i.caughtToStringUntyped=o})(ki||(ki={}));function q(i,e){return p(e),async(t,r)=>{let s={...t,type:i},o=Object.assign(ke({metadata:r}),se(r)),d=await Promise.allSettled(e.map(m=>m(s,o))),c=Vm(d);if(c)throw c.err;return{}}}function ul(i){for(let e of u.triggerOnEventHandlers.keys())switch(e){case"PostSubmit":i.provides(jm),R("OnPostSubmit",q("PostSubmit",u.triggerOnEventHandlers.get(e)));break;case"PostCreate":i.provides(Um),R("OnPostCreate",q("PostCreate",u.triggerOnEventHandlers.get(e)));break;case"PostUpdate":i.provides(Wm),R("OnPostUpdate",q("PostUpdate",u.triggerOnEventHandlers.get(e)));break;case"PostReport":i.provides(_m),R("OnPostReport",q("PostReport",u.triggerOnEventHandlers.get(e)));break;case"PostDelete":i.provides(Dm),R("OnPostDelete",q("PostDelete",u.triggerOnEventHandlers.get(e)));break;case"PostFlairUpdate":i.provides(Nm),R("OnPostFlairUpdate",q("PostFlairUpdate",u.triggerOnEventHandlers.get(e)));break;case"CommentSubmit":i.provides(Rm),R("OnCommentSubmit",q("CommentSubmit",u.triggerOnEventHandlers.get(e)));break;case"CommentCreate":i.provides(Am),R("OnCommentCreate",q("CommentCreate",u.triggerOnEventHandlers.get(e)));break;case"CommentUpdate":i.provides(Om),R("OnCommentUpdate",q("CommentUpdate",u.triggerOnEventHandlers.get(e)));break;case"CommentReport":i.provides(Tm),R("OnCommentReport",q("CommentReport",u.triggerOnEventHandlers.get(e)));break;case"CommentDelete":i.provides(Em),R("OnCommentDelete",q("CommentDelete",u.triggerOnEventHandlers.get(e)));break;case"AppInstall":i.provides(wm),R("OnAppInstall",q("AppInstall",u.triggerOnEventHandlers.get(e)));break;case"AppUpgrade":i.provides(Fm),R("OnAppUpgrade",q("AppUpgrade",u.triggerOnEventHandlers.get(e)));break;case"ModAction":i.provides(Mm),R("OnModAction",q("ModAction",u.triggerOnEventHandlers.get(e)));break;case"ModMail":i.provides(Bm),R("OnModMail",q("ModMail",u.triggerOnEventHandlers.get(e)));break;case"PostNsfwUpdate":i.provides(Lm),R("OnPostNsfwUpdate",q("PostNsfwUpdate",u.triggerOnEventHandlers.get(e)));break;case"PostSpoilerUpdate":i.provides(Hm),R("OnPostSpoilerUpdate",q("PostSpoilerUpdate",u.triggerOnEventHandlers.get(e)));break;case"AutomoderatorFilterPost":i.provides(Im),R("OnAutomoderatorFilterPost",q("AutomoderatorFilterPost",u.triggerOnEventHandlers.get(e)));break;case"AutomoderatorFilterComment":i.provides(xm),R("OnAutomoderatorFilterComment",q("AutomoderatorFilterComment",u.triggerOnEventHandlers.get(e)));break;default:throw new Error(`Unknown trigger event: ${e}`)}}function Vm(i){let e=i.reduce((t,r)=>r.status==="rejected"?[...t,r.reason]:t,[]);if(e.length!==0)return e.length===1?{err:e[0]}:{err:new Error(e.map(t=>ki.caughtToString(t)).join(`
`))}}import{EffectType as pp,HandleUIEventResponse as ca,UIEventHandlerDefinition as gp}from"@devvit/protos";var Il=Qa(Sl(),1);function Pl(i){return i?.constructor===Object}function It(i,e){return Object.is(i,e)?!0:typeof i!=typeof e?!1:Array.isArray(i)&&Array.isArray(e)?wl(i,e):i instanceof Date&&e instanceof Date?i.getTime()===e.getTime():i instanceof RegExp&&e instanceof RegExp?i.toString()===e.toString():Pl(i)&&Pl(e)?mp(i,e):i instanceof ArrayBuffer&&e instanceof ArrayBuffer?Fl(new DataView(i),new DataView(e)):i instanceof DataView&&e instanceof DataView?Fl(i,e):xl(i)&&xl(e)?i.byteLength!==e.byteLength?!1:wl(i,e):!1}function mp(i,e){let t=Object.keys(i),r=Object.keys(e);if(!It(t,r))return!1;for(let s of t)if(!It(i[s],e[s]))return!1;return!0}function wl(i,e){return i.length!==e.length?!1:i.every((t,r)=>It(t,e[r]))}function Fl(i,e){if(i.byteLength!==e.byteLength)return!1;for(let t=0;t<i.byteLength;t++)if(i.getUint8(t)!==e.getUint8(t))return!1;return!0}function xl(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}async function hp(i,e){let t=i.state??{},r=(0,Il.default)(t),s=ke({ui:!0,metadata:e});if(i.event?.formSubmitted&&i.event.formSubmitted.formId){let m=i.event.formSubmitted.formId;if(m.includes("form.hook.")&&u.customPostType){let b=new De((O,L)=>u.customPostType?.render(L)??null,i.event,i.state,e,void 0);return await b.reconcile(),ca.fromJSON({state:b.state,effects:b.getEffects()})}let y=u.formDefinitions.get(m);if(!y)throw new Error(`Form with key ${m} not found`);let v,f;if(r.__contextAction){let{actionId:b,thingId:O}=r.__contextAction,L=Vr(b);L?.location==="post"?v=O:L?.location==="comment"&&(f=O)}let S=Object.assign(s,se(e,v,f),{uiEnvironment:{timezone:e[P.Timezone]?.values[0],locale:e[P.Language]?.values[0]}});await ol(S,i),await y.onSubmit({values:Je(i.event.formSubmitted.results)},S)}else if(i.event?.realtimeEvent){if(u.customPostType){let m=new De((y,v)=>u.customPostType?.render(v)??null,i.event,i.state,e,void 0);return await m.reconcile(),ca.fromJSON({state:m.state,effects:m.getEffects()})}}else if(i.event?.toastAction)throw new Error("Toast actions not yet implemented");let o=!It(t,r),d=fi(s.ui),c=o?[...d,{type:pp.EFFECT_RERENDER_UI,rerenderUi:{delaySeconds:0}}]:d;return ca.fromJSON({state:r,effects:c})}function Al(i){i.provides(gp),R("HandleUIEvent",hp)}import{CustomPostDefinition as lo,UIResponse as iu}from"@devvit/protos";import{UIEventScope as Pp}from"@devvit/protos";var ma="ServerCallRequired";function Zs(i){return i?.message===ma}var fa={now(){return new Date}};function El(i){return`__autocache__${i}`}function Tl(i){return`__lock__${i}`}var fp=300,bp=1e3,Xs=5e3,pa=3,Rl=.1,Ol=1e3,yp=3e4;function Ml(i){if(i.error)throw new Error(i.error);return i.value}var Qe,Ye,Se,Ci,z,Bl,Ul,Dl,ga,Nl,Ll,ha,_l,Qs=class{constructor(e,t,r=fa){l(this,z);l(this,Qe);l(this,Ye,{});l(this,Se);l(this,Ci);a(this,Qe,e),a(this,Ci,t),a(this,Se,r)}async cache(e,t){var d;(d=n(this,Ci)).__cache??(d.__cache={}),a(this,Ye,n(this,Ci).__cache),h(this,z,_l).call(this,t);let r=h(this,z,Bl).call(this,t.key);if(r!==void 0)return r;let s=await h(this,z,ha).call(this,t.key),o=await h(this,z,Ul).call(this,t,s,e);return Ml(o)}};Qe=new WeakMap,Ye=new WeakMap,Se=new WeakMap,Ci=new WeakMap,z=new WeakSet,Bl=function(e){let t=n(this,Ye)[e];if(t){let r=n(this,Se).now().getTime(),s=t?.error&&t?.errorTime&&t.errorCount<pa&&Math.random()<Rl&&t.errorTime+Ol<r;if(t?.expires&&t.expires<r&&t.checkedAt+Ol<r||s){delete n(this,Ye)[e];return}else return Ml(t)}},Ul=async function(e,t,r){let s=t?.expires,o=s?h(this,z,Ll).call(this,s):1;return!t||t?.error&&t.errorCount<pa&&Rl>Math.random()||o>Math.random()?h(this,z,Dl).call(this,e,t,r):t},Dl=async function(e,t,r){let s=Tl(e.key),o=n(this,Se).now().getTime(),d=new Date(o+e.ttl/2);if(await n(this,Qe).set(s,"1",{expiration:d,nx:!0}))return h(this,z,Nl).call(this,e.key,t,r,e.ttl);if(t)return t;{let m=n(this,Se).now();return h(this,z,ga).call(this,m,e.key,e.ttl)}},ga=async function(e,t,r){let s=Math.min(r,bp),o=await h(this,z,ha).call(this,t);if(o)return o;if(n(this,Se).now().getTime()-e.getTime()>=s)throw new Error(`Cache request timed out trying to get data at key: ${t}`);return await new Promise(d=>setTimeout(d,fp)),h(this,z,ga).call(this,e,t,r)},Nl=async function(e,t,r,s){let o=n(this,Se).now().getTime()+s;t=t??{value:null,expires:o,errorCount:0,error:null,errorTime:null,checkedAt:0};try{t.value=await r(),t.error=null,t.errorCount=0,t.errorTime=null}catch(d){t.value=null,t.error=d.message??"Unknown error",t.errorTime=n(this,Se).now().getTime(),t.errorCount++}return n(this,Ye)[e]=t,await n(this,Qe).set(El(e),JSON.stringify(t),{expiration:new Date(o+yp)}),t.error&&t.errorCount<pa&&await n(this,Qe).del(Tl(e)),t},Ll=function(e){let t=n(this,Se).now().getTime(),r=e-t;return r<0?1:r<1e3?.1:r<2e3?.01:r<3e3?.001:0},ha=async function(e){let t=await n(this,Qe).get(El(e));if(t){let r=JSON.parse(t);return r.checkedAt=n(this,Se).now().getTime(),n(this,Ye)[e]=r,r}},_l=function(e){e.ttl<Xs&&(console.warn(`Cache TTL cannot be less than ${Xs} milliseconds! Updating ttl value of ${e.ttl} to ${Xs}.`),e.ttl=Xs)};function Hl(i,e,t=fa){let r=new Qs(i,e,t);return r.cache.bind(r)}import{EffectType as Ys,ToastAppearance as Vl}from"@devvit/protos";function jl(i){let e=i.match(/form\.hook\.(.+)\.0/);if(e?.[1])return e[1]}var ba=class{constructor(e,t,r){this.state=null;this.hookId=e.hookId,this.form=t,this.onSubmit=r,this.onUIEvent=async s=>{s.formSubmitted&&await r(Je(s.formSubmitted.results))}}};function ya(i,e){let t=ce({namespace:"useForm",initializer:r=>new ba(r,i,e)});return vp({id:t.hookId})}function vp(i){return`form.hook.${i.id}.0`}function Wl(i,e){let t=jl(e);return i.getHook({id:t})}var Le,to,Gr,io,eo=class{constructor(e){l(this,Le);l(this,to,0);l(this,Gr);l(this,io,(e,t)=>{let r=t!==void 0?e:"",s=t!==void 0?t:e;n(this,Le).emitEffect(`postMessage${Ya(this,to)._++}`,{type:Ys.EFFECT_WEB_VIEW,webView:{postMessage:{webViewId:r,app:{message:s}}}})});a(this,Le,e),a(this,Gr,{postMessage:n(this,io)})}get webView(){return n(this,Gr)}showForm(e,t){let r=Wl(n(this,Le),e);if(!r)throw new Error("Form does not exist. Make sure you have added it using useForm.");let s=r.form instanceof Function?r.form(t??{}):r.form,o={fields:[],id:e,title:s.title,acceptLabel:s.acceptLabel,cancelLabel:s.cancelLabel,shortDescription:s.description};Pt(s.fields),o.fields=Ue(s.fields),n(this,Le).emitEffect(e,{type:Ys.EFFECT_SHOW_FORM,showForm:{form:o}})}showToast(e){let t;e instanceof Object?t={text:e.text,appearance:e.appearance==="success"?Vl.SUCCESS:Vl.NEUTRAL}:t={text:e},n(this,Le).emitEffect(e.toString(),{type:Ys.EFFECT_SHOW_TOAST,showToast:{toast:t}})}navigateTo(e){let t;typeof e=="string"?t=new URL(e).toString():t=new URL(e.permalink,"https://www.reddit.com").toString(),n(this,Le).emitEffect(t,{type:Ys.EFFECT_NAVIGATE_TO_URL,navigateToUrl:{url:t}})}};Le=new WeakMap,to=new WeakMap,Gr=new WeakMap,io=new WeakMap;import{EffectType as kp,RealtimeSubscriptionStatus as Gl}from"@devvit/protos";var et,Te,tt,At,Jr,ka,ro=class ro{constructor(e,t){l(this,Jr);l(this,et);l(this,Te);l(this,tt);l(this,At);a(this,et,t.context),a(this,Te,!!t.context._devvitContext?.debug.realtime),a(this,At,e),a(this,tt,t.invalidate);let r=t.context.meta[P.App]?.values[0];if(!r)throw Error("useChannel missing app ID metadata");let s=t.context.meta[P.Installation]?.values[0];if(!s)throw Error("useChannel missing install ID from metadata");let o=`${r}:${s}:${e.name}`;if(Object.values(n(this,et)._hooks).filter(c=>c instanceof ro).some(c=>c.state.channel===o))throw Error(`useChannel channel names must be unique; "${o}" duplicated`);this.state={channel:o,connected:!1,subscribed:!1}}async onUIEvent(e){let t=e.realtimeEvent;if(!(!t||!this.state.subscribed))switch(t.status){case Gl.REALTIME_SUBSCRIBED:n(this,Te)&&console.debug(`[realtime] "${this.state.channel}" connected`),this.state.connected=!0,n(this,tt).call(this),await n(this,At).onSubscribed?.();break;case Gl.REALTIME_UNSUBSCRIBED:n(this,Te)&&console.debug(`[realtime] "${this.state.channel}" disconnected`),this.state.connected=!1,n(this,tt).call(this),await n(this,At).onUnsubscribed?.();break;default:n(this,Te)&&console.debug(`[realtime] "${this.state.channel}" received message: ${JSON.stringify(e,void 0,2)}`),n(this,At).onMessage(t.event?.data?.msg);break}}async send(e){if(n(this,Te)&&console.debug(`[realtime] "${this.state.channel}" send message: ${JSON.stringify(e,void 0,2)}`),!this.state.subscribed||!this.state.connected)throw console.debug(`[realtime] "${this.state.channel}" send failed; channel not connected`),Error(`useChannel send failed; "${this.state.channel}" channel not connected`);await n(this,et).devvitContext.realtime.send(this.state.channel,e)}get status(){return this.state.subscribed&&this.state.connected?2:this.state.subscribed&&!this.state.connected?1:!this.state.subscribed&&this.state.connected?3:4}subscribe(){this.state.subscribed||(n(this,Te)&&console.debug(`[realtime] "${this.state.channel}" subscribed`),this.state.subscribed=!0,n(this,tt).call(this),h(this,Jr,ka).call(this))}unsubscribe(){this.state.subscribed&&(n(this,Te)&&console.debug(`[realtime] "${this.state.channel}" unsubscribed`),this.state.subscribed=!1,n(this,tt).call(this),h(this,Jr,ka).call(this))}};et=new WeakMap,Te=new WeakMap,tt=new WeakMap,At=new WeakMap,Jr=new WeakSet,ka=function(){let e=Object.values(n(this,et)._hooks).filter(t=>t instanceof ro&&t.state.subscribed).map(t=>t.state.channel);n(this,et).emitEffect(this.state.channel,{type:kp.EFFECT_REALTIME_SUB,realtimeSubscriptions:{subscriptionIds:e}})};var va=ro;function Ca(i){if(!i.name||/[^a-zA-Z0-9_]/.test(i.name))throw Error(`useChannel error: The name "${i.name}" you provided for the hook is invalid. Valid names can only contain letters, numbers, and underscores (_).`);let e=`useChannel:${i.name}`;return ce({id:e,namespace:e,initializer:t=>new va(i,t)})}import{EffectType as Sa}from"@devvit/protos";function Jl(i){return typeof i=="object"&&i!==null&&"__deleted"in i}var Et,it,Si=class Si{constructor(e,t){l(this,Et);this._segments=[];l(this,it,{});this._prevHooks={};this._prevHookId="";this._effects={};this._changed={};this._touched={};this._requeueEvents=[];this._rootProps={};this._generated={};this._undeliveredHandlers={};this.request=e,this.meta=t,a(this,Et,e.state??{__cache:{}}),this._rootProps=e.props??{}}get devvitContext(){if(!this._devvitContext)throw new Error("Devvit context not available");return this._devvitContext}set devvitContext(e){this._devvitContext=e}get _changedState(){let e={__cache:n(this,Et).__cache??{}};for(let r in this._changed)e[r]=this._state[r];let t=new Set(Object.keys(this._state));return Object.keys(n(this,it)).forEach(r=>{r!=="__cache"&&t.delete(r)}),t.forEach(r=>{if(r==="__cache")return;let s={__deleted:!0};this._state[r]=e[r]=s}),e}get _hooks(){return n(this,it)}set _hooks(e){this._prevHooks=n(this,it),a(this,it,e)}get _state(){return n(this,Et)}set _state(e){a(this,Et,e)}push(e){this._segments.push({...e,next:0})}pop(){this._segments.pop()}addUndeliveredEventHandler(e,t){this._undeliveredHandlers[e]=t}addGlobalUndeliveredEventHandler(e,t){Si.addGlobalUndeliveredEventHandler(e,t)}getHook(e){return n(this,it)[e.id]}static addGlobalUndeliveredEventHandler(e,t){Si._staticUndeliveredHandlers[e]=t}async handleUndeliveredEvent(e){let t={...Si._staticUndeliveredHandlers,...this._undeliveredHandlers};for(let[r,s]of Object.entries(t))await s(e,this)}emitEffect(e,t){this._effects[e]=t}addToRequeueEvents(...e){this._devvitContext?.debug.blocks&&console.debug("[blocks] requeueing events",e);let t=e.reduce((r,s)=>(s.retry?r.retry.push(s):r.normal.push(s),r),{retry:[],normal:[]});this._requeueEvents=[...t.retry,...this._requeueEvents,...t.normal]}get effects(){return Object.values(this._effects)}nextHookId(e){e.key===void 0&&(e.key=this._segments[this._segments.length-1].next+++""),this.push(e);try{let t=[];for(let s=this._segments.length-1;s>=0;s--){let o=this._segments[s];if(o.id){t.unshift(o.id);break}let d=[];o.namespace&&d.push(o.namespace),o.key!==void 0&&o.key!==!1&&d.push(o.key),t.unshift(d.join("-"))}let r=t.join(".");if(this._generated[r]&&!e.shared)throw new Error(`Hook id ${r} already used, cannot register another hook with the same id`);return this._generated[r]=!0,this._prevHookId=r,r}finally{this.pop()}}};Et=new WeakMap,it=new WeakMap,Si._staticUndeliveredHandlers={};var Pi=Si;var rt={};Pi.addGlobalUndeliveredEventHandler("intervals",async(i,e)=>{i.timer&&i.hook&&(delete rt[i.hook],e.emitEffect("timers",{type:Sa.EFFECT_SET_INTERVALS,interval:{intervals:rt}}))});var nt,wi,zr,Fi,Pa=class{constructor(e,t,r){l(this,nt);l(this,wi);l(this,zr);l(this,Fi);this.state={duration:{seconds:0,nanos:0},running:!1};a(this,wi,r.invalidate),a(this,nt,r.hookId),a(this,zr,e),a(this,Fi,r.context);let s=Math.floor(t/1e3),o=t%1e3*1e6;this.state.duration={seconds:s,nanos:o}}onStateLoaded(){this.state.running?rt[n(this,nt)]={duration:this.state.duration}:delete rt[n(this,nt)]}async onUIEvent(e){await n(this,zr).call(this)}start(){rt[n(this,nt)]={duration:this.state.duration},this.state.running=!0,n(this,wi).call(this),n(this,Fi).emitEffect("timers",{type:Sa.EFFECT_SET_INTERVALS,interval:{intervals:rt}})}stop(){delete rt[n(this,nt)],this.state.running=!1,n(this,wi).call(this),n(this,Fi).emitEffect("timers",{type:Sa.EFFECT_SET_INTERVALS,interval:{intervals:rt}})}};nt=new WeakMap,wi=new WeakMap,zr=new WeakMap,Fi=new WeakMap;function wa(i,e){let t=ce({namespace:"useInterval",initializer:r=>new Pa(i,e,r)});return{start:()=>t.start(),stop:()=>t.stop()}}import{UIEventScope as Sp}from"@devvit/protos";var Tt=class extends Error{};import{UIEventScope as zl}from"@devvit/protos";function xa(i){if(i instanceof Error){if(i.message===ma)throw i;return console.error(i),{message:i.message,details:i.stack??""}}else return console.error(i),{message:"Unknown error",details:ki.caughtToString(i)}}var Fe,Re,xi,qr,Ii,Fa=class{constructor(e,t,r){l(this,Fe);l(this,Re);l(this,xi);l(this,qr);l(this,Ii);a(this,Fe,!!r.context.devvitContext.debug.useAsync),n(this,Fe)&&console.debug("[useAsync] v1",t),this.state={data:null,load_state:"initial",error:null,depends:null},a(this,Re,r.hookId),this.initializer=e,a(this,xi,r.invalidate),a(this,qr,r.context),this.localDepends=t.depends??null,a(this,Ii,t)}onStateLoaded(){if(n(this,Fe)&&console.debug("[useAsync] async onLoad ",n(this,Re),this.state),n(this,Fe)&&console.debug("[useAsync] async onLoad have ",this.localDepends,"and",this.state.depends),!It(this.localDepends,this.state.depends)||this.state.load_state==="initial"){n(this,Fe)&&console.debug("[useAsync] attempting to resolve for hookId",n(this,Re)),this.state.load_state="loading",this.state.depends=this.localDepends,n(this,xi).call(this);let e={scope:zl.ALL,hook:n(this,Re),async:!0,asyncRequest:{requestId:n(this,Re)+"-"+JSON.stringify(this.state.depends)}};n(this,Fe)&&console.debug("[useAsync] onLoad requeue"),n(this,qr).addToRequeueEvents(e)}}async onUIEvent(e,t){if(e.asyncRequest){let r={requestId:e.asyncRequest.requestId};try{r.data={value:await this.initializer()}}catch(o){r.error=xa(o)}let s={scope:zl.ALL,asyncResponse:r,hook:n(this,Re)};n(this,Fe)&&console.debug("[useAsync] onReq requeue"),t.addToRequeueEvents(s)}else if(e.asyncResponse){let r=n(this,Re)+"-"+JSON.stringify(this.state.depends);e.asyncResponse.requestId===r?(this.state={...this.state,data:e.asyncResponse.data?.value??null,error:e.asyncResponse.error??null,load_state:e.asyncResponse.error?"error":"loaded"},n(this,Ii).finally&&await n(this,Ii).finally(this.state.data,this.state.error?new Error(this.state.error?.message??"Unknown error"):null),n(this,xi).call(this)):n(this,Fe)&&console.debug("[useAsync] onResp skip, stale event",e.asyncResponse.requestId," !== ",r)}else throw new Error("Unknown event type")}};Fe=new WeakMap,Re=new WeakMap,xi=new WeakMap,qr=new WeakMap,Ii=new WeakMap;function Cp(i,e={}){let t=ce({namespace:"useAsync",initializer:r=>new Fa(i,e,r)});return{data:t.state.data,error:t.state.error,loading:t.state.load_state==="loading"}}var _e,Ai,Rt,Ot,Ia=class{constructor(e,t){this.state={value:null,load_state:"initial",error:null};l(this,_e);l(this,Ai);l(this,Rt);l(this,Ot);a(this,Rt,e),a(this,Ot,t.hookId),a(this,_e,t.invalidate),a(this,Ai,t.context)}async onUIEvent(){if(this.state.load_state==="loading"&&this._promise){try{this.state.value=await this._promise,this.state.load_state="loaded"}catch(e){this.state.load_state="error",this.state.error=xa(e)}n(this,_e).call(this)}else console.warn("Invalid state: ",this.state.load_state,this._promise)}setter(e){this.state.value=e instanceof Function?e(this.state.value):e,this.state.load_state="loaded",n(this,_e).call(this)}onStateLoaded(){if(this._promise=n(this,Ai)._prevHooks[n(this,Ot)]?._promise,this.state.load_state==="loading")throw new Tt;if(this.state.load_state==="error")throw new Error(this.state.error?.message??"Unknown error");if(this.state.load_state==="initial"){let e;try{e=n(this,Rt)instanceof Function?n(this,Rt).call(this):n(this,Rt)}catch(t){console.log("error in loading async",t),this.state.load_state="error",n(this,_e).call(this);return}if(e instanceof Promise){this._promise=e,this.state.load_state="loading";let t={scope:Sp.ALL,asyncRequest:{requestId:n(this,Ot)},hook:n(this,Ot)};throw n(this,Ai).addToRequeueEvents(t),n(this,_e).call(this),new Tt}else this.state.value=e,this.state.load_state="loaded";n(this,_e).call(this)}}};_e=new WeakMap,Ai=new WeakMap,Rt=new WeakMap,Ot=new WeakMap;function Aa(i){let e=ce({namespace:"useState",initializer:t=>new Ia(i,t)});return[e.state.value,e.setter.bind(e)]}var no=class{buildContext(e,t,r){let s=new di(r),o=new oi(r),d=new mi(r),c=new ui(r),m=new pi(r),y=new gi(r),v=new eo(e),f=new ai(r),S=new ni,b=new li(r),O=Hl(d,e._state),L={modLog:s,kvStore:o,redis:d,reddit:c,scheduler:m,settings:y,media:f,assets:S,realtime:b,ui:v,useState:Aa,useChannel:Ca,useInterval:wa,useForm:ya,cache:O,dimensions:t.env?.dimensions,uiEnvironment:{timezone:r[P.Timezone]?.values[0],locale:r[P.Language]?.values[0],dimensions:t.env?.dimensions,colorScheme:t.env?.colorScheme}},M=se(r,t.props?.postId);return M.debug.effects=e,{...M,...L}}};var me=null;function ql(i){return JSON.parse(JSON.stringify(i))}function wp(i){if(!(i!==""&&!/[-.]/.test(i)))throw new Error(`Hook with namespace '${i}' is invalid. Hook namespaces cannot be empty string or contain dashes/dots because they are used as delimiters internally. Please update the hook namespace and try again.`)}function ce({initializer:i,...e}){if(!me)throw new Error("Hooks can only be declared at the top of a component.  You cannot declare hooks outside of components or inside of event handlers.  It's almost always a mistake to declare hooks inside of loops or conditionals.");wp(e.namespace);let t=me.nextHookId(e),r=me,s={hookId:t,invalidate:()=>{r._changed[t]=!0,r._state[t]=r?._hooks[t]?.state},context:me},o=me._state[t]===void 0||Jl(me._state[t]);me._hooks[t]=me._hooks[t]??i(s);let d=me._hooks[t];return o||(d.state=me._state[t]),d.onStateLoaded?.(),o&&d.state!==void 0&&d.state!==null&&s.invalidate(),d}var Fp=null,$l=64,Ei,ao,$r,w,oe,so,Kl,Ea,Zl,Ta,Ra,oo,Oa,Xl,Mt=class{constructor(e){l(this,w);l(this,Ei);l(this,ao,new no);l(this,$r,new vi(()=>this._latestRenderContext?.devvitContext?.assets));this._latestRenderContext=null;n(this,w,oe)&&console.debug("[blocks] BlocksHandler v1"),a(this,Ei,e),Fp=this}async handle(e,t){let r=new Pi(e,t),s=n(this,ao).buildContext(r,e,t);r.devvitContext=s;let o,d=e.events,m=!e.events?.length||d.some(O=>!O.async),y=d.some(O=>O.blocking),v,f,S=[...d];d.length===0&&d.push({scope:Pp.ALL}),n(this,w,oe)&&console.debug("[blocks] starting processing events");let b=0;for(;d.length>0;){if(b++>$l)throw new Error(`Exceeded maximum iterations of ${$l}`);n(this,w,oe)&&console.debug("[blocks] processing events loop iteration",d.length);let O=[];if(!d[0].async)O.push(d.shift());else for(;d[0]?.async;)O.push(d.shift());if(!O.length)throw Error("batch must have at least one event");try{if(O[0].async){let M=ql(r._state);await h(this,w,Kl).call(this,r,...O),r._state=M}else await h(this,w,Zl).call(this,r,...O)}catch(M){if(!Zs(M))throw M;if(n(this,w,oe)&&console.debug("[blocks] caught in handler",M),r._latestRenderContent=void 0,f){r._state=f._state,r._changed=v,r._effects=f._effects;let Y=S.map(Xt=>{let Mo={...Xt};return Mo.retry=!0,Mo});r.addToRequeueEvents(...Y);break}else throw Zs(M)||console.error("[blocks] unhandled error in handler",M),M}n(this,w,oe)&&console.debug("[blocks] remaining events",r._requeueEvents);let L=[];for(let M of r._requeueEvents){if(!m&&!M.async){n(this,w,oe)&&console.debug("[blocks] NOT reprocessing event in BlocksHandler, sync mismatch A",M),L.push(M);continue}if(m&&M.async&&!y){n(this,w,oe)&&console.debug("[blocks] NOT reprocessing event in BlocksHandler, sync mismatch B",M),L.push(M);continue}n(this,w,oe)&&console.debug("[blocks] reprocessing event in BlocksHandler",M),d.push(M)}r._requeueEvents=L,d.length>0&&(v={...r._changed},f={_state:ql(r._state),_effects:{...r._effects}},S=[...d])}if(m){r._latestRenderContent||(r._latestRenderContent=h(this,w,Ta).call(this,n(this,Ei),r.request.props??{},r));let O=r._latestRenderContent;O&&(o=n(this,$r).createBlocksElementOrThrow(O),o=n(this,$r).ensureRootBlock(o))}return{state:r._changedState,effects:r.effects,blocks:o,events:r._requeueEvents}}};Ei=new WeakMap,ao=new WeakMap,$r=new WeakMap,w=new WeakSet,oe=function(){return!!this._latestRenderContext?.devvitContext.debug.blocks},so=function(e,...t){e._hooks={},h(this,w,Ta).call(this,n(this,Ei),e.request.props??{},e)},Kl=async function(e,...t){h(this,w,so).call(this,e,...t),await Promise.all(t.map(async r=>{if(!r.async)throw new Error("You can't mix main and other queues in one batch.  This is likely a platform bug.  Please file an issue in the Discord for someone to help! https://discord.com/channels/1050224141732687912/1115441897079574620");await h(this,w,Ea).call(this,e,r)}))},Ea=async function(e,t){let r=e._hooks[t.hook];if(r?.onUIEvent)try{await r.onUIEvent(t,e)}catch(s){throw Zs(s)?n(this,w,oe)&&console.error("Server call required",s):console.error("Error in event handler",s),s}else await e.handleUndeliveredEvent(t)},Zl=async function(e,...t){for(let r of t)n(this,w,oe)&&console.log("[blocks] handling main queue event",r),n(this,w,oe)&&console.log("[blocks] before",e._state),h(this,w,so).call(this,e,r),await h(this,w,Ea).call(this,e,r),n(this,w,oe)&&console.log("[blocks] after",e._state);h(this,w,so).call(this,e)},Ta=function(e,t,r){n(this,w,oe)&&console.debug("[blocks] renderRoot"),r._generated={},me=r,this._latestRenderContext=r;try{let s=h(this,w,Ra).call(this,e,t,r);if(s.length!==1)throw new Error(`There can only be one root element, received: ${s.length}. Please wrap these elements in a <vstack></vstack> or <hstack></hstack> to continue. Fragments cannot be used as a root element.`);let o=s[0];if(o==="[object Promise]")throw new Error('Root elements cannot be async. To use data from an async endpoint, please use "const [data] = useState(async () => {/** your async code */})".');if(typeof o=="string")throw new Error("The root element must return a valid block, not a string. Try wrapping the element in a <text>your content</text> tag to continue.");return r._latestRenderContent=o,o}catch(s){if(s instanceof Tt)return;throw s}finally{me=null}},Ra=function(e,t,r){r.push({namespace:e.name||"anonymous",...t});try{let s=e(t,r.devvitContext);if(s instanceof Promise)throw new Error(`Components (found: ${e.name??"unknown component"}) cannot be async. To use data from an async endpoint, please use "const [data] = useState(async () => {/** your async code */})".`);return h(this,w,Oa).call(this,s,r)}finally{r.pop()}},oo=function(e,t){return e=e.flat(1/0),e.flatMap((r,s)=>(r&&typeof r=="object"&&"props"in r&&(r.props?.key||(r.props=r.props??{},r.props.key=`${s}`)),h(this,w,Oa).call(this,r,t)))},Oa=function(e,t){if(Array.isArray(e))return h(this,w,oo).call(this,e,t);if(xp(e))if(e.type===void 0)try{return t.push({namespace:"fragment",...e.props}),h(this,w,oo).call(this,e.children,t)}finally{t.pop()}else if(typeof e.type=="function"){let r={...e.props,children:e.children.flat(1/0)};return h(this,w,Ra).call(this,e.type,r,t)}else try{t.push({namespace:e.type,...e.props});let r=h(this,w,oo).call(this,e.children,t),s=h(this,w,Xl).call(this,e.props??{});return[{type:e.type,children:r,props:s}]}finally{t.pop()}else return[(e??"").toString()]},Xl=function(e){let t={};for(let r in e)if(!(typeof e[r]>"u"))if(typeof e[r]=="function"){let s=ce({namespace:r,key:!1,initializer:({hookId:o})=>({hookId:o,state:null,onUIEvent:d=>{if(d.userAction)return e[r](d.userAction.data);if(d.webView?.postMessage)return e[r](d.webView.postMessage.message)}})});t[r]=s.hookId,"captureHookRef"in e[r]&&e[r].captureHookRef()}else{let s=JSON.parse(JSON.stringify(e[r]));s!=null&&(t[r]=s)}return t};function xp(i){return typeof i=="object"&&i!=null&&"type"in i}var Ql=i=>{let e=Number(i.trim().split(".").pop());return isNaN(e)?void 0:e},Yl=i=>{let[e,t,r]=i.trim().split(";");if(!e||!t||!r){console.warn(`Received a malformed devvit-user-agent! Received: '${i}'`);return}if(e!=="Reddit"){console.warn(`Received unknown company name in user agent! Received: '${i}'`);return}if(t==="iOS"){let s=Ql(r);if(s===void 0){console.warn(`Could not parse version number from user agent! Received: '${i}'`);return}return{company:"Reddit",platform:"iOS",rawVersion:r,versionNumber:s}}if(t==="Android"){let s=Ql(r);if(s===void 0){console.warn(`Could not parse version number from user agent! Received: '${i}'`);return}return{company:"Reddit",platform:"Android",rawVersion:r,versionNumber:s}}if(t==="Shreddit")return{company:"Reddit",platform:"Shreddit",rawVersion:r};if(t==="Play")return{company:"Reddit",platform:"Play",rawVersion:r};console.warn("Received unknown platform:",t)},eu=i=>i?i.platform==="Android"?i.versionNumber<1875012:i.platform==="iOS"?i.versionNumber<614973:!1:(console.warn(`Could not parse devvit-user-agent! Received: '${JSON.stringify(i)}'`),!1),Ip=i=>{switch(i){case"Android":return"https://play.google.com/store/apps/details?id=com.reddit.frontpage";case"iOS":return"https://apps.apple.com/us/app/reddit/id1064216828";case"Play":case"Shreddit":break;default:console.error(`No upgrade link for platform: ${i}`)}},Ap=({platform:i},e)=>u.createElement("blocks",null,u.createElement("vstack",{alignment:"middle center",height:100,width:100},u.createElement("vstack",{maxWidth:"300px",gap:"large",alignment:"middle center"},u.createElement("vstack",{gap:"medium",alignment:"middle center"},u.createElement("image",{imageHeight:100,imageWidth:100,url:"https://i.redd.it/p1vmc5ulmpib1.png"}),u.createElement("text",{size:"large",weight:"bold",wrap:!0,alignment:"center"},"Uh oh, the app you're trying to use requires the latest version of Reddit. Please upgrade your app to continue.")),u.createElement("hstack",{alignment:"middle center"},u.createElement("button",{onPress:()=>{let t=Ip(i);t?e.ui.navigateTo(t):console.warn("No upgrade link found for platform:",i)}},"Upgrade"))))),tu=i=>()=>u.createElement(Ap,{platform:i});var Ep=()=>u.createElement("vstack",{alignment:"center middle",width:"100%",height:"100%"},u.createElement("text",null,"This feature is not available yet")),Tp=[[lo,lo.methods.renderPostContent,(i,e)=>u.customPostType?.render(e)??null],[lo,lo.methods.renderPostComposer,(i,e)=>u.createElement(Ep,null)]];function Rp(i){return async(e,t)=>{let r=Yl(t["devvit-user-agent"]?.values?.[0]??"");if(r&&eu(r)){let o=new Mt(tu(r.platform));return iu.fromJSON(await o.handle(e,t))}let s=new Mt(i);return iu.fromJSON(await s.handle(e,t))}}function ru(i){for(let[e,t,r]of Tp)i.provides(e),R(t.name,Rp(r))}var Ti,Kr,Ri,Bt,Ut,Oi,Mi,Dt,st,Zr,Xr,Nt,j,U=class U extends Ms{static configure(e){a(this,Ri,{...n(this,Ri),...e}),Ne(e.http)&&this.use(k.HTTPDefinition),(e.redis===void 0||Ne(e.kvStore)||Ne(e.redis))&&(this.use(k.KVStoreDefinition),this.use(k.RedisAPIDefinition)),Ne(e.media)&&this.use(k.MediaServiceDefinition),Ne(e.modLog)&&this.use(k.ModlogDefinition),Ne(e.redditAPI)&&(this.use(k.FlairDefinition),this.use(k.GraphQLDefinition),this.use(k.LinksAndCommentsDefinition),this.use(k.ListingsDefinition),this.use(k.ModerationDefinition),this.use(k.ModNoteDefinition),this.use(k.NewModmailDefinition),this.use(k.PrivateMessagesDefinition),this.use(k.SubredditsDefinition),this.use(k.UsersDefinition),this.use(k.WidgetsDefinition),this.use(k.WikiDefinition)),Ne(e.realtime)&&this.use(k.RealtimeDefinition)}static addMenuItem(e){n(this,Mi).push(e)}static addCustomPostType(e){a(this,Bt,e)}static createForm(e,t){let r=`form.${n(this,Ut).size}`;return n(this,Ut).set(r,{form:e,onSubmit:t}),r}static addSchedulerJob(e){if(n(this,j)[k.SchedulerDefinition.fullName]||this.use(k.SchedulerDefinition),n(this,Dt).has(e.name))throw new Error(`Job ${e.name} is already defined`);n(this,Dt).set(e.name,e.onRun)}static addSettings(e){Pt(e);let t=e.filter(s=>s.type==="group"||!s.scope||s.scope==="installation"),r=e.filter(s=>s.type!=="group"&&s.scope==="app");t.length>0&&a(this,Oi,t),r.length>0&&a(this,Ti,r),n(this,j)[k.SettingsDefinition.fullName]||this.use(k.SettingsDefinition)}static addTrigger(e){if("events"in e){for(let t of e.events)this.addTrigger({event:t,onEvent:(r,s)=>e.onEvent(r,s)});return this}return n(this,st).has(e.event)?n(this,st).get(e.event)?.push(e.onEvent):n(this,st).set(e.event,[e.onEvent]),U}static provide(e){n(this,Xr).push(e)}static use(e,t){n(this,Nt)[e.fullName]={def:e,options:t??{},handler:void 0};let r={};for(let s of Object.values(e.methods))r[s.name]=(o,d)=>n(this,Nt)[e.fullName].handler?.[s.name]?.(s.requestType?.fromPartial(o??{}),d);return n(this,j)[e.fullName]=r,r}static get redditAPIPlugins(){if(!Ne(n(this,Ri).redditAPI))throw new Error("Reddit API is not enabled. You can enable it by passing `redditAPI: true` to `Devvit.configure`.");return{Flair:n(this,j)[k.FlairDefinition.fullName],GraphQL:n(this,j)[k.GraphQLDefinition.fullName],LinksAndComments:n(this,j)[k.LinksAndCommentsDefinition.fullName],Listings:n(this,j)[k.ListingsDefinition.fullName],Moderation:n(this,j)[k.ModerationDefinition.fullName],ModNote:n(this,j)[k.ModNoteDefinition.fullName],NewModmail:n(this,j)[k.NewModmailDefinition.fullName],PrivateMessages:n(this,j)[k.PrivateMessagesDefinition.fullName],Subreddits:n(this,j)[k.SubredditsDefinition.fullName],Users:n(this,j)[k.UsersDefinition.fullName],Widgets:n(this,j)[k.WidgetsDefinition.fullName],Wiki:n(this,j)[k.WikiDefinition.fullName]}}static get modLogPlugin(){let e=n(this,j)[k.ModlogDefinition.fullName];if(!e)throw new Error("ModLog is not enabled. You can enable it by passing `modLog: true` to `Devvit.configure`");return e}static get schedulerPlugin(){let e=n(this,j)[k.SchedulerDefinition.fullName];if(!e)throw new Error("Scheduler is not enabled. You can enable it by calling `Devvit.addSchedulerJob` at the top level of your app.");return e}static get kvStorePlugin(){let e=n(this,j)[k.KVStoreDefinition.fullName];if(!e)throw new Error("Key Value Store is not enabled. You can enable it by passing `kvStore: true` to `Devvit.configure`");return e}static get redisPlugin(){let e=n(this,j)[k.RedisAPIDefinition.fullName];if(!e)throw new Error("Redis is not enabled. You can enable it by passing `redis: true` to `Devvit.configure`");return e}static get mediaPlugin(){let e=n(this,j)[k.MediaServiceDefinition.fullName];if(!e)throw new Error("MediaService is not enabled. You can enable it by passing `media: true` to `Devvit.configure`");return e}static get settingsPlugin(){let e=n(this,j)[k.SettingsDefinition.fullName];if(!e)throw new Error("Settings must first be configured with `Devvit.addSettings()` before they can be accessed");return e}static get realtimePlugin(){let e=n(this,j)[k.RealtimeDefinition.fullName];if(!e)throw new Error("Realtime is not enabled. You can enable it by passing `realtime: true` to `Devvit.configure`");return e}static get menuItems(){return n(this,Mi)}static get customPostType(){return n(this,Bt)}static get formDefinitions(){return n(this,Ut)}static get scheduledJobHandlers(){return n(this,Dt)}static get installationSettings(){return n(this,Oi)}static get appSettings(){return n(this,Ti)}static get triggerOnEventHandlers(){return n(this,st)}static get assets(){return n(this,Kr)}static get webViewAssets(){return n(this,Zr)}constructor(e){super(e),a(U,Kr,e.assets??{}),a(U,Zr,e.webviewAssets??{});for(let t in n(U,Nt)){let r=n(U,Nt)[t];r.handler=e.use(r.def,r.options)}n(U,Mi).length>0&&dl(e),n(U,Dt).size>0&&ll(e),n(U,Bt)&&(il(e),ru(e)),(n(U,Bt)||n(U,Ut).size>0)&&Al(e),n(U,Oi)&&rl(e),n(U,Ti)&&Nd(e),n(U,st).size>0&&ul(e);for(let t of n(U,Xr))e.provides(t)}};Ti=new WeakMap,Kr=new WeakMap,Ri=new WeakMap,Bt=new WeakMap,Ut=new WeakMap,Oi=new WeakMap,Mi=new WeakMap,Dt=new WeakMap,st=new WeakMap,Zr=new WeakMap,Xr=new WeakMap,Nt=new WeakMap,j=new WeakMap,U.debug={},l(U,Ti),l(U,Kr,{}),l(U,Ri,{}),l(U,Bt),l(U,Ut,new Map),l(U,Oi),l(U,Mi,[]),l(U,Dt,new Map),l(U,st,new Map),l(U,Zr,{}),l(U,Xr,[]),l(U,Nt,{}),l(U,j,{});var u=U;(e=>{function i(t,r,...s){return{type:t,props:r,children:s}}e.createElement=i})(u||(u={}));function K(i){let e=Object.getOwnPropertyDescriptors(i.constructor.prototype);for(let[t,r]of Object.entries(e))r.get&&Object.defineProperty(i,t,{...r,enumerable:!0})}var Ma;(function(i){i[i.bold=1]="bold",i[i.italic=2]="italic",i[i.underline=4]="underline",i[i.strikethrough=8]="strikethrough",i[i.subscript=16]="subscript",i[i.superscript=32]="superscript",i[i.monospace=64]="monospace"})(Ma||(Ma={}));var nu="text",su="raw",ou="br",au="link",du="c/",lu="p/",uu="r/",cu="u/",mu="@",pu="spoilertext",gu="par",hu="h",fu="hr",bu="blockquote",yu="code",vu="li",ku="list",Cu="L",Su="R",Pu="C",wu="table",Fu="embed",xu="img",Iu="gif",Au="video";function Eu(i){return{e:Iu,id:i.mediaId,...i.caption&&{c:i.caption},...i.blur&&{o:i.blur}}}function Tu(i,e){let t={},r=[];return Object.assign(t,Qr(t,r),Yr(t,r),en(t,r),nn(t,r),sn(t,r),on(t,r)),e(t),{e:bu,c:r,...i.author&&{a:i.author}}}function Ru(i,e){let t={},r=[];return Object.assign(t,Ua(t,r)),e(t),{e:yu,c:r,...i.language&&{l:i.language}}}function Ou(i){return{e:du,t:i.permalink}}function Mu(i,e){let t={},r=[];return Object.assign(t,Ua(t,r),rn(t,r)),e(t),{e:hu,l:i.level,c:r}}function Bu(i){return{e:Fu,u:i.sourceUrl,c:i.contentUrl,x:i.width,y:i.height}}function Uu(){return{e:fu}}function Du(i){return{e:xu,id:i.mediaId,...i.caption&&{c:i.caption},...i.blur&&{o:i.blur}}}function Nu(){return{e:ou}}function Lu(i){return{e:au,t:i.text,u:i.url,...i.formatting&&{f:i.formatting},...i.tooltip&&{a:i.tooltip}}}function _u(i,e){let t={},r=[];return Object.assign(t,tc(t,r)),e(t),{e:ku,o:i.ordered,c:r}}function Hu(i){let e={},t=[];return Object.assign(e,Qr(e,t),Yr(e,t),en(e,t),uo(e,t),nn(e,t),sn(e,t),on(e,t)),i(e),{e:vu,c:t}}function ju(i){let e={},t=[];return Object.assign(e,co(e,t),rn(e,t),Ba(e,t),Da(e,t),tn(e,t)),i(e),{e:gu,c:t}}function Wu(i){return{e:lu,t:i.permalink}}function Vu(i){return{e:su,t:i}}function Gu(i){let e={},t=[];return Object.assign(e,co(e,t),rn(e,t),Ba(e,t)),i(e),{e:pu,c:t}}function Ju(i){return{e:uu,t:i.subredditName,l:i.showPrefix}}function zu(i){let e={},t=[],r=[];return Object.assign(e,ic(e,t,r)),i(e),{e:wu,h:t,c:r}}function qu(i){let[e,t]=ec();return i(e),{c:t}}function $u(i,e){let[t,r]=ec();e(t);let s;switch(i.columnAlignment){case"left":s=Cu;break;case"right":s=Su;break;case"center":s=Pu;break}return{...s&&{a:s},...r&&{c:r}}}function Ku(i){let e={},t=[];return Object.assign(e,rc(e,t)),i(e),t}function Zu(i){return{e:nu,t:i.text,...i.formatting&&{f:i.formatting}}}function Xu(i){return{e:cu,t:i.username,l:i.showPrefix}}function Qu(i){return{e:mu,t:i.username,l:i.showPrefix}}function Yu(i){return{e:Au,id:i.mediaId,...i.caption&&{c:i.caption},...i.blur&&{o:i.blur},...i.thumbnail&&{p:i.thumbnail},...i.convertToGif&&{gifify:i.convertToGif}}}function ec(){let i={},e=[];return Object.assign(i,co(i,e),rn(i,e),Da(i,e),tn(i,e)),[i,e]}function Qr(i,e){return{blockQuote(t,r){return e.push(Tu(t,r)),i}}}function Yr(i,e){return{codeBlock(t,r){return e.push(Ru(t,r)),i}}}function nc(i,e){return{embed(t){return e.push(Bu(t)),i}}}function en(i,e){return{heading(t,r){return e.push(Mu(t,r)),i}}}function uo(i,e){return{horizontalRule(){return e.push(Uu()),i}}}function tn(i,e){return{image(t){return e.push(Du(t)),i},animatedImage(t){return e.push(Eu(t)),i}}}function Ba(i,e){return{linebreak(){return e.push(Nu()),i}}}function rn(i,e){return{link(t){return e.push(Lu(t)),i},commentLink(t){return e.push(Ou(t)),i},postLink(t){return e.push(Wu(t)),i},subredditLink(t){return e.push(Ju(t)),i},userLink(t){return e.push(Xu(t)),i},userMention(t){return e.push(Qu(t)),i}}}function nn(i,e){return{list(t,r){return e.push(_u(t,r)),i}}}function tc(i,e){return{item(t){return e.push(Hu(t)),i}}}function sn(i,e){return{paragraph(t){return e.push(ju(t)),i}}}function Ua(i,e){return{rawText(t){return e.push(Vu(t)),i}}}function Da(i,e){return{spoiler(t){return e.push(Gu(t)),i}}}function ic(i,e,t){return{headerCell(r,s){return e.push($u(r,s)),i},row(r){return t.push(Ku(r)),i}}}function on(i,e){return{table(t){return e.push(zu(t)),i}}}function rc(i,e){return{cell(t){return e.push(qu(t)),i}}}function co(i,e){return{text(t){return e.push(Zu(t)),i}}}function sc(i,e){return{video(t){return e.push(Yu(t)),i}}}var Op=function(i,e,t,r,s){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?i!==e||!s:!e.has(i))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?s.call(i,t):s?s.value=t:e.set(i,t),t},Mp=function(i,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?i!==e||!r:!e.has(i))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(i):r?r.value:e.get(i)},mo,Lt=class{constructor(){mo.set(this,void 0);let e=[];Object.assign(this,sn(this,e),en(this,e),uo(this,e),Qr(this,e),Yr(this,e),nc(this,e),nn(this,e),on(this,e),tn(this,e),sc(this,e)),Op(this,mo,{document:e},"f")}build(){return JSON.stringify(Mp(this,mo,"f"))}paragraph(e){return this}heading(e,t){return this}horizontalRule(){return this}blockQuote(e,t){return this}codeBlock(e,t){return this}embed(e){return this}list(e,t){return this}table(e){return this}image(e){return this}animatedImage(e){return this}video(e){return this}};mo=new WeakMap;function Bi(i){let e;return i instanceof Lt?e=i.build():typeof i=="object"?e=JSON.stringify(i):e=i,e}var oc=100,ac=1/0,_t,Ht,ot,Ui,Di,po,W=class{constructor(e){l(this,Di);l(this,_t);l(this,Ht);l(this,ot);l(this,Ui,!1);this.pageSize=oc;this.limit=ac;this.children=[];K(this),this._fetch=e.fetch,this.pageSize=e.pageSize??oc,this.limit=e.limit??ac,a(this,Ht,e.after),a(this,_t,e.before),a(this,ot,e.more),e.children&&(this.children=e.children)}get hasMore(){return!n(this,Ui)||!!(n(this,Ht)||n(this,_t)||n(this,ot))}async*[Symbol.asyncIterator](){let e=0;for(;;){if(e===this.children.length)if(this.hasMore){if((await h(this,Di,po).call(this)).length===0)break}else break;if(yield this.children[e],e++,e===this.limit)break}}setMore(e){a(this,ot,e)}preventInitialFetch(){a(this,Ui,!0)}async all(){for(;this.hasMore&&this.children.length<this.limit;)await h(this,Di,po).call(this);return this.children.slice(0,this.limit)}async get(e){let t=e<=this.limit?e:this.limit;for(;this.hasMore&&this.children.length<t;)await h(this,Di,po).call(this);return this.children.slice(0,t)}};_t=new WeakMap,Ht=new WeakMap,ot=new WeakMap,Ui=new WeakMap,Di=new WeakSet,po=async function(){if(!this.hasMore)throw new Error("This listing does not have any more items to load.");let{children:e,before:t,after:r,more:s}=await this._fetch({before:n(this,_t),after:n(this,Ht),limit:this.pageSize,more:n(this,ot)});return this.children.push(...e),a(this,_t,t),a(this,Ht,r),a(this,ot,s),a(this,Ui,!0),e};var an,Na,ye=class{constructor(){}static get(e,t){let r=u.redditAPIPlugins.ModNote;return new W({hasMore:!0,before:e.before,limit:e.limit,pageSize:e.limit,fetch:async s=>{let o=await r.GetNotes({subreddit:e.subreddit,user:e.user,filter:e.filter,before:s.before,limit:s.limit},t);return{children:o.modNotes?.map(d=>h(this,an,Na).call(this,d))||[],before:o.hasNextPage?o.endCursor:void 0,hasMore:o.hasNextPage}}})}static async delete(e,t){let r=u.redditAPIPlugins.ModNote,{deleted:s}=await r.DeleteNotes(e,t);return!!s}static async add(e,t){let s=await u.redditAPIPlugins.ModNote.PostNotes(e,t);if(!s?.created)throw new Error("Failed to create mod note");return h(this,an,Na).call(this,s.created)}static async addRemovalNote(e,t){await u.redditAPIPlugins.ModNote.PostRemovalNote(e,t)}};an=new WeakSet,Na=function(e){return p(e.id,"Mod note ID is null or undefined"),p(e.createdAt,"Mod note createdAt is null or undefined"),p(e.type,"Mod note type is null or undefined"),p(e.subreddit,"Mod note subreddit is null or undefined"),p(e.subredditId,"Mod note subredditId is null or undefined"),p(e.operator,"Mod note operator is null or undefined"),p(e.operatorId,"Mod note operatorId is null or undefined"),p(e.user,"Mod note user is null or undefined"),p(e.userId,"Mod note userId is null or undefined"),p(e.userNoteData,"Mod note userNote is null or undefined"),p(e.modActionData,"Mod note modAction is null or undefined"),{id:e.id,user:{id:te(e.userId??""),name:e.user},subreddit:{id:$(e.subredditId??""),name:e.subreddit},operator:{id:te(e.operatorId??""),name:e.operator},createdAt:new Date(e.createdAt*1e3),userNote:{note:e.userNoteData?.note,redditId:e.userNoteData?.redditId?he(e.userNoteData?.redditId):void 0,label:e.userNoteData?.label},type:e.type}},l(ye,an);var Q=class{static queryWithQueryString(e,t){return u.redditAPIPlugins.GraphQL.Query({query:e},t)}static query(e,t,r,s){return u.redditAPIPlugins.GraphQL.PersistedQuery({operationName:e,id:t,variables:r},s)}};var dc=["all","wiki","posts","access","mail","config","flair","channels","chat_config","chat_operator","community_chat"];function Bp(i,e){return e.map(t=>(i.includes(t)?"+":"-")+t).join(",")}function La(i){return Bp(i,dc)}function lc(i){return i.filter(e=>dc.includes(e))}var Up=(t=>(t.User="USER_FLAIR",t.Post="LINK_FLAIR",t))(Up||{}),Wt,Ni,Li,_i,Hi,ji,Wi,Vi,Gi,Ji,zi,go,xe=class xe{constructor(e,t,r){l(this,Wt);l(this,Ni);l(this,Li);l(this,_i);l(this,Hi);l(this,ji);l(this,Wi);l(this,Vi);l(this,Gi);l(this,Ji);K(this),p(e.id),p(e.text),a(this,Wt,e.id),a(this,Ni,t),a(this,Li,e.text),a(this,_i,Dp(e.textColor)),a(this,Hi,Np(e.backgroundColor)),a(this,ji,Lp(e.allowableContent)),a(this,Wi,e.modOnly),a(this,Vi,e.maxEmojis),a(this,Gi,e.textEditable),a(this,Ji,r)}get id(){return n(this,Wt)}get text(){return n(this,Li)}get textColor(){return n(this,_i)}get backgroundColor(){return n(this,Hi)}get allowableContent(){return n(this,ji)}get modOnly(){return n(this,Wi)}get maxEmojis(){return n(this,Vi)}get allowUserEdits(){return n(this,Gi)}async delete(){return xe.deleteFlairTemplate(n(this,Wt),n(this,Ni),n(this,Ji))}async edit(e){return xe.editFlairTemplate({id:n(this,Wt),subredditName:n(this,Ni),text:e.text??n(this,Li),allowableContent:e.allowableContent??n(this,ji),backgroundColor:e.backgroundColor??n(this,Hi),maxEmojis:e.maxEmojis??n(this,Vi),modOnly:e.modOnly??n(this,Wi),textColor:e.textColor??n(this,_i),allowUserEdits:e.allowUserEdits??n(this,Gi)},n(this,Ji))}static async createPostFlairTemplate(e,t){var r;return h(r=xe,zi,go).call(r,{...e,flairType:"LINK_FLAIR"},t)}static async createUserFlairTemplate(e,t){var r;return h(r=xe,zi,go).call(r,{...e,flairType:"USER_FLAIR"},t)}static async editFlairTemplate(e,t){var r;return h(r=xe,zi,go).call(r,e,t)}static async getPostFlairTemplates(e,t){return(await u.redditAPIPlugins.Flair.LinkFlair({subreddit:e},t)).flair?.map(o=>new xe(o,e,t))||[]}static async getUserFlairTemplates(e,t){return(await u.redditAPIPlugins.Flair.UserFlair({subreddit:e},t)).flair?.map(o=>new xe(o,e,t))||[]}static async deleteFlairTemplate(e,t,r){await u.redditAPIPlugins.Flair.DeleteFlairTemplate({subreddit:e,flairTemplateId:t},r)}};Wt=new WeakMap,Ni=new WeakMap,Li=new WeakMap,_i=new WeakMap,Hi=new WeakMap,ji=new WeakMap,Wi=new WeakMap,Vi=new WeakMap,Gi=new WeakMap,Ji=new WeakMap,zi=new WeakSet,go=async function(e,t){let{subredditName:r,allowableContent:s="all",backgroundColor:o="transparent",flairType:d="",maxEmojis:c=10,modOnly:m=!1,text:y,textColor:v="dark",allowUserEdits:f=!1,id:S=""}=e;if(m&&f)throw new Error("Cannot have a mod only flair that is editable by users");let O=await u.redditAPIPlugins.Flair.FlairTemplate({subreddit:r,allowableContent:s,backgroundColor:o,flairType:d,maxEmojis:c,modOnly:m,text:y,textColor:v,textEditable:f,flairTemplateId:S,cssClass:"",overrideCss:!1},t);return new xe(O,r,t)},l(xe,zi);var ne=xe;function dn(i){return{flairCssClass:i.flairCssClass,user:i.user,flairText:i.flairText}}var at,_a,Ha,jt=class jt{static async getUserFlairBySubreddit(e,t){return u.redditAPIPlugins.Flair.FlairList(e,t)}static setUserFlair(e,t){var r;return h(r=jt,at,_a).call(r,e,t)}static setPostFlair(e,t){var r;return h(r=jt,at,_a).call(r,{...e,postId:de(e.postId)},t)}static async removePostFlair(e,t,r){var s;return h(s=jt,at,Ha).call(s,e,t,void 0,r)}static async removeUserFlair(e,t,r){var s;return h(s=jt,at,Ha).call(s,e,void 0,t,r)}};at=new WeakSet,_a=async function(e,t){await u.redditAPIPlugins.Flair.SelectFlair({subreddit:e.subredditName,flairTemplateId:e.flairTemplateId??"",text:e.text??"",name:e.username,link:e.postId,backgroundColor:e.backgroundColor??"",textColor:e.textColor??"dark",cssClass:e.cssClass??"",returnRtjson:"none"},t)},Ha=async function(e,t,r,s){await u.redditAPIPlugins.Flair.SelectFlair({subreddit:e,name:r??"",link:t??"",flairTemplateId:"",backgroundColor:"",text:"",textColor:"",cssClass:"",returnRtjson:"none"},s)},l(jt,at);var ve=jt;function Dp(i){if(p(i,"Flair text color is required"),i==="light"||i==="dark")return i;throw new Error(`Invalid flair text color: ${i}`)}function Np(i){if(!i||i.length===0||i==="transparent")return"transparent";if(/^#([A-Fa-f0-9]{6})$/.test(i))return i;throw new Error(`Invalid flair background color: ${i}`)}function Lp(i){if(i==="all"||i==="text"||i==="emoji")return i;throw new Error(`Invalid allowable content: ${i}`)}import"@devvit/protos";import{Block as pc,UIResponse as qp}from"@devvit/protos";var Va=Qa(mc(),1);var Wa=i=>"text"in i?i.text:zp(i.richtext),zp=i=>i instanceof Lt?i.build():typeof i=="object"?JSON.stringify(i):i;var $p={NONE:0,BLOCKS:1,UNRECOGNIZED:-1},qi,un,$i,cn,Ki,mn,pn,gn,Gt,hn,fn,bn,yn,vn,kn,dt,Cn,Sn,Jt,Zi,lt,Xi,Qi,Yi,ut,ct,mt,er,pt,gt,ht,He,Pn,wn,tr,ir,B,D=class D{constructor(e,t){l(this,qi);l(this,un);l(this,$i);l(this,cn);l(this,Ki);l(this,mn);l(this,pn);l(this,gn);l(this,Gt);l(this,hn);l(this,fn);l(this,bn);l(this,yn);l(this,vn);l(this,kn);l(this,dt);l(this,Cn);l(this,Sn);l(this,Jt);l(this,Zi);l(this,lt);l(this,Xi);l(this,Qi);l(this,Yi);l(this,ut);l(this,ct);l(this,mt);l(this,er);l(this,pt);l(this,gt);l(this,ht);l(this,He);l(this,Pn);l(this,wn);l(this,tr);l(this,ir);l(this,B);K(this),p(e.id,"Post is missing id"),p(e.title,"Post is missing title"),p(e.createdUtc,"Post is missing created date"),p(e.author,"Post is missing author name"),p(e.subreddit,"Post is missing subreddit name"),p(e.subredditId,"Post is missing subreddit id"),p(e.url,"Post is missing url"),p(e.permalink,"Post is missing permalink"),a(this,qi,de(`t3_${e.id}`)),a(this,$i,e.author),a(this,un,e.authorFullname?te(e.authorFullname):void 0),a(this,Ki,$(e.subredditId)),a(this,mn,e.subreddit),a(this,bn,e.score??0),a(this,yn,e.numComments??0),a(this,vn,e.numReports??0);let r=new Date(0);r.setUTCSeconds(e.createdUtc),a(this,cn,r),a(this,gn,e.title),a(this,Gt,e.selftext),a(this,hn,e.selftextHtml),a(this,fn,e.url),a(this,pn,e.permalink),e.thumbnail&&e.thumbnail!=="self"&&e.thumbnail!=="nsfw"&&e.thumbnailHeight!=null&&e.thumbnailWidth!=null&&a(this,kn,{url:e.thumbnail,height:e.thumbnailHeight,width:e.thumbnailWidth}),a(this,dt,e.approved??!1),a(this,Cn,e.approvedAtUtc??0),a(this,Sn,e.bannedAtUtc??0),a(this,lt,e.removed??!1),a(this,Xi,e.removedBy),a(this,Qi,e.removedByCategory),a(this,Jt,e.spam??!1),a(this,Zi,e.stickied??!1),a(this,Yi,e.archived??!1),a(this,ut,e.edited??!1),a(this,ct,e.locked??!1),a(this,mt,e.over18??!1),a(this,er,e.quarantine??!1),a(this,pt,e.spoiler),a(this,gt,e.hidden??!1),a(this,ht,e.ignoreReports??!1),a(this,He,e.distinguished),a(this,wn,e.secureMedia),a(this,tr,(e.modReports??[]).map(([s])=>s)),a(this,ir,(e.userReports??[]).map(([s])=>s)),a(this,B,t),(e.linkFlairBackgroundColor||e.linkFlairCssClass||e.linkFlairText||e.linkFlairType||e.linkFlairTemplateId||e.linkFlairRichtext||e.linkFlairTextColor)&&a(this,Pn,{backgroundColor:e.linkFlairBackgroundColor,cssClass:e.linkFlairCssClass,text:e.linkFlairText,type:e.linkFlairType,templateId:e.linkFlairTemplateId,richtext:(e.linkFlairRichtext??[]).map(({e:s,t:o,a:d,u:c})=>({elementType:s,text:o,emojiRef:d,url:c})),textColor:e.linkFlairTextColor})}get id(){return n(this,qi)}get authorId(){return n(this,un)}get authorName(){return n(this,$i)}get subredditId(){return n(this,Ki)}get subredditName(){return n(this,mn)}get permalink(){return n(this,pn)}get title(){return n(this,gn)}get body(){return n(this,Gt)}get bodyHtml(){return n(this,hn)}get url(){return n(this,fn)}get thumbnail(){return n(this,kn)}get createdAt(){return n(this,cn)}get score(){return n(this,bn)}get numberOfComments(){return n(this,yn)}get numberOfReports(){return n(this,vn)}get approved(){return n(this,dt)}get approvedAtUtc(){return n(this,Cn)}get bannedAtUtc(){return n(this,Sn)}get spam(){return n(this,Jt)}get stickied(){return n(this,Zi)}get removed(){return n(this,lt)}get removedBy(){return n(this,Xi)}get removedByCategory(){return n(this,Qi)}get archived(){return n(this,Yi)}get edited(){return n(this,ut)}get locked(){return n(this,ct)}get nsfw(){return n(this,mt)}get quarantined(){return n(this,er)}get spoiler(){return n(this,pt)}get hidden(){return n(this,gt)}get ignoringReports(){return n(this,ht)}get distinguishedBy(){return n(this,He)}get comments(){return X.getComments({postId:this.id},n(this,B))}get flair(){return n(this,Pn)}get secureMedia(){return n(this,wn)}get userReportReasons(){return n(this,ir)}get modReportReasons(){return n(this,tr)}toJSON(){return{id:this.id,authorId:this.authorId,authorName:this.authorName,subredditId:this.subredditId,subredditName:this.subredditName,permalink:this.permalink,title:this.title,body:this.body,bodyHtml:this.bodyHtml,url:this.url,thumbnail:this.thumbnail,score:this.score,numberOfComments:this.numberOfComments,numberOfReports:this.numberOfReports,createdAt:this.createdAt,approved:this.approved,spam:this.spam,stickied:this.stickied,removed:this.removed,removedBy:n(this,Xi),removedByCategory:n(this,Qi),archived:this.archived,edited:this.edited,locked:this.locked,nsfw:this.nsfw,quarantined:this.quarantined,spoiler:this.spoiler,hidden:this.hidden,ignoringReports:this.ignoringReports,distinguishedBy:this.distinguishedBy,flair:this.flair,secureMedia:this.secureMedia,modReportReasons:n(this,tr),userReportReasons:n(this,ir)}}isApproved(){return n(this,dt)}isSpam(){return n(this,Jt)}isStickied(){return n(this,Zi)}isRemoved(){return n(this,lt)}isArchived(){return n(this,Yi)}isEdited(){return n(this,ut)}isLocked(){return n(this,ct)}isNsfw(){return n(this,mt)}isQuarantined(){return n(this,er)}isSpoiler(){return n(this,pt)}isHidden(){return n(this,gt)}isIgnoringReports(){return n(this,ht)}isDistinguishedBy(){return n(this,He)}async edit(e){let t=await D.edit({id:this.id,...e},n(this,B));a(this,Gt,t.body),a(this,ut,t.edited)}async setSuggestedCommentSort(e){await D.setSuggestedCommentSort({id:this.id,subredditId:n(this,Ki),suggestedSort:e},n(this,B))}async setCustomPostPreview(e){await D.setCustomPostPreview({id:this.id,ui:e},n(this,B))}async setTextFallback(e){let t=await D.setTextFallback(e,this.id,n(this,B));a(this,Gt,t.body),a(this,ut,t.edited)}async addComment(e){return X.submit({id:this.id,...e},n(this,B))}async delete(){return D.delete(this.id,n(this,B))}async approve(){await D.approve(this.id,n(this,B)),a(this,dt,!0),a(this,lt,!1)}async remove(e=!1){await D.remove(this.id,e,n(this,B)),a(this,lt,!0),a(this,Jt,e),a(this,dt,!1)}async lock(){await D.lock(this.id,n(this,B)),a(this,ct,!0)}async unlock(){await D.unlock(this.id,n(this,B)),a(this,ct,!1)}async hide(){await D.hide(this.id,n(this,B)),a(this,gt,!0)}async unhide(){await D.unhide(this.id,n(this,B)),a(this,gt,!1)}async markAsNsfw(){await D.markAsNsfw(this.id,n(this,B)),a(this,mt,!0)}async unmarkAsNsfw(){await D.unmarkAsNsfw(this.id,n(this,B)),a(this,mt,!1)}async markAsSpoiler(){await D.markAsSpoiler(this.id,n(this,B)),a(this,pt,!0)}async unmarkAsSpoiler(){await D.unmarkAsSpoiler(this.id,n(this,B)),a(this,pt,!1)}async sticky(e){await D.sticky(this.id,e,n(this,B))}async unsticky(){await D.unsticky(this.id,n(this,B))}async distinguish(){let{distinguishedBy:e}=await D.distinguish(this.id,!1,n(this,B));a(this,He,e)}async distinguishAsAdmin(){let{distinguishedBy:e}=await D.distinguish(this.id,!0,n(this,B));a(this,He,e)}async undistinguish(){let{distinguishedBy:e}=await D.undistinguish(this.id,n(this,B));a(this,He,e)}async ignoreReports(){await D.ignoreReports(this.id,n(this,B)),a(this,ht,!0)}async unignoreReports(){await D.unignoreReports(this.id,n(this,B)),a(this,ht,!1)}async getAuthor(){return C.getByUsername(n(this,$i),n(this,B))}async crosspost(e){return D.crosspost({...e,postId:this.id},n(this,B))}addRemovalNote(e){return ye.addRemovalNote({itemIds:[n(this,qi)],...e},n(this,B))}async getEnrichedThumbnail(){return Kp({id:this.id},n(this,B))}static async getById(e,t){let r=u.redditAPIPlugins.LinksAndComments,s=St(e)?e:`t3_${e}`,o=await r.Info({subreddits:[],thingIds:[s]},t);if(!o.data?.children?.length)throw new Error("could not find post");let d=o.data.children[0];if(!d?.data)throw new Error("could not find post");return new D(d.data,t)}static async submit(e,t){let r=u.redditAPIPlugins.LinksAndComments,s;if("preview"in e){p(t,"Missing metadata in `SubmitPostOptions`");let c=await new De(()=>e.preview,void 0,{},t,void 0).buildBlocksUI(),m=pc.encode(c).finish(),{textFallback:y,...v}=e,f=y?Wa(y):"",S={kind:"custom",sr:e.subredditName,richtextJson:(0,Va.fromByteArray)(m),richtextFallback:f,...v};s=await r.SubmitCustomPost(S,t)}else s=await r.Submit({kind:"kind"in e?e.kind:"url"in e?"link":"self",sr:e.subredditName,richtextJson:"richtext"in e?Bi(e.richtext):void 0,...e},t);if("kind"in e&&["image","video","videogif"].includes(e.kind)&&!s.json?.data?.id&&"url"in e)throw new Error(`Post of ${e.kind} type with ${e.url} is being created asynchronously and should be updated in the subreddit soon.`);if(!s.json?.data?.id||s.json?.errors?.length)throw new Error(`failed to submit post - either post ID is empty or request failed with errors: ${s.json?.errors}`);return D.getById(`t3_${s.json.data.id}`,t)}static async crosspost(e,t){let r=u.redditAPIPlugins.LinksAndComments,{postId:s,subredditName:o,...d}=e,c=await r.Submit({kind:"crosspost",sr:o,crosspostFullname:de(s),...d},t);if(!c.json?.data?.id||c.json?.errors?.length)throw new Error("failed to crosspost post");return D.getById(`t3_${c.json.data.id}`,t)}static async edit(e,t){let r=u.redditAPIPlugins.LinksAndComments,{id:s}=e,o;if("richtext"in e&&(o=Bi(e.richtext)),(await r.EditUserText({thingId:s,text:"text"in e?e.text:"",richtextJson:o},t)).json?.errors?.length)throw new Error("Failed to edit post");return D.getById(s,t)}static async setSuggestedCommentSort(e,t){if(!(await Q.query("SetSuggestedSort","cf6052acc7fefaa65b710625b81dba8041f258313aafe9730e2a3dc855e5d10d",{input:{subredditId:e.subredditId,postId:e.id,sort:e.suggestedSort}},t)).data?.setSuggestedSort?.ok)throw new Error("Failed to set suggested sort")}static async setCustomPostPreview(e,t){if(!t)throw new Error("Failed to set custom post preview. Metadata not found");let r=u.redditAPIPlugins.LinksAndComments,s=new Mt(e.ui),d=qp.fromJSON(await s.handle({events:[]},t)).blocks,c=(0,Va.fromByteArray)(pc.encode(d).finish());await r.SetCustomPostPreview({thingId:e.id,bodyType:$p.BLOCKS,blocksRenderContent:c},t)}static async setTextFallback(e,t,r){if(!("text"in e)&&!("richtext"in e))throw new Error(`No text fallback provided for post ${t}.`);let s=u.redditAPIPlugins.LinksAndComments,o=Wa(e);if((await s.EditCustomPost({thingId:t,richtextFallback:o},r)).json?.errors?.length)throw new Error("Failed to set post text fallback");return D.getById(t,r)}static async delete(e,t){await u.redditAPIPlugins.LinksAndComments.Del({id:e},t)}static async approve(e,t){await u.redditAPIPlugins.Moderation.Approve({id:e},t)}static async remove(e,t=!1,r){await u.redditAPIPlugins.Moderation.Remove({id:e,spam:t},r)}static async hide(e,t){await u.redditAPIPlugins.LinksAndComments.Hide({id:e},t)}static async unhide(e,t){await u.redditAPIPlugins.LinksAndComments.Unhide({id:e},t)}static async markAsNsfw(e,t){await u.redditAPIPlugins.LinksAndComments.MarkNSFW({id:e},t)}static async unmarkAsNsfw(e,t){await u.redditAPIPlugins.LinksAndComments.UnmarkNSFW({id:e},t)}static async markAsSpoiler(e,t){await u.redditAPIPlugins.LinksAndComments.Spoiler({id:e},t)}static async unmarkAsSpoiler(e,t){await u.redditAPIPlugins.LinksAndComments.Unspoiler({id:e},t)}static async sticky(e,t,r){await u.redditAPIPlugins.LinksAndComments.SetSubredditSticky({id:e,state:!0,num:t},r)}static async unsticky(e,t){await u.redditAPIPlugins.LinksAndComments.SetSubredditSticky({id:e,state:!1},t)}static async lock(e,t){await u.redditAPIPlugins.LinksAndComments.Lock({id:e},t)}static async unlock(e,t){await u.redditAPIPlugins.LinksAndComments.Unlock({id:e},t)}static async distinguish(e,t,r){let d=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:t?"admin":"yes",sticky:!1},r)).json?.data?.things?.[0]?.data;return p(d),{distinguishedBy:d.distinguished}}static async undistinguish(e,t){let o=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:"no",sticky:!1},t)).json?.data?.things?.[0]?.data;return p(o),{distinguishedBy:o.distinguished}}static async ignoreReports(e,t){await u.redditAPIPlugins.Moderation.IgnoreReports({id:e},t)}static async unignoreReports(e,t){await u.redditAPIPlugins.Moderation.UnignoreReports({id:e},t)}static getControversialPosts(e={},t){return this.getSortedPosts({...e,sort:"controversial"},t)}static getTopPosts(e={},t){return this.getSortedPosts({...e,sort:"top"},t)}static getSortedPosts(e,t){let r=u.redditAPIPlugins.Listings;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.Sort({show:"all",sort:e.sort,t:e.timeframe,subreddit:e.subredditName,...s},t);return ln(o,t)}})}static getHotPosts(e={location:"GLOBAL"},t){let r=u.redditAPIPlugins.Listings;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.Hot({g:e.location,show:"all",subreddit:e.subredditName,...s},t);return ln(o,t)}})}static getNewPosts(e,t){let r=u.redditAPIPlugins.Listings;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.New({show:"all",subreddit:e.subredditName,...s},t);return ln(o,t)}})}static getRisingPosts(e,t){let r=u.redditAPIPlugins.Listings;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,fetch:async s=>{let o=await r.Rising({show:"all",subreddit:e.subredditName,...s},t);return ln(o,t)}})}static getPostsByUser(e,t){let r=u.redditAPIPlugins.Users;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,async fetch(s){let o=await r.UserWhere({username:e.username,where:"submitted",...s},t);return ln(o,t)}})}};qi=new WeakMap,un=new WeakMap,$i=new WeakMap,cn=new WeakMap,Ki=new WeakMap,mn=new WeakMap,pn=new WeakMap,gn=new WeakMap,Gt=new WeakMap,hn=new WeakMap,fn=new WeakMap,bn=new WeakMap,yn=new WeakMap,vn=new WeakMap,kn=new WeakMap,dt=new WeakMap,Cn=new WeakMap,Sn=new WeakMap,Jt=new WeakMap,Zi=new WeakMap,lt=new WeakMap,Xi=new WeakMap,Qi=new WeakMap,Yi=new WeakMap,ut=new WeakMap,ct=new WeakMap,mt=new WeakMap,er=new WeakMap,pt=new WeakMap,gt=new WeakMap,ht=new WeakMap,He=new WeakMap,Pn=new WeakMap,wn=new WeakMap,tr=new WeakMap,ir=new WeakMap,B=new WeakMap;var V=D;function ln(i,e){if(!i.data?.children)throw new Error("Listing response is missing children");return{children:i.data.children.map(r=>new V(r.data,e)),before:i.data.before,after:i.data.after}}async function Kp(i,e){let o=(await Q.query("GetThumbnailV2","81580ce4e23d748c5a59a1618489b559bf4518b6a73af41f345d8d074c8b2ce9",{id:i.id},e)).data?.postInfoById?.thumbnailV2;if(o){if(!o.image)return}else throw new Error("Failed to get thumbnail");return{attribution:o.attribution,image:{url:o.image.url,width:o.image.dimensions.width,height:o.image.dimensions.height},isObfuscatedDefault:o.isObfuscatedDefault,...o.obfuscatedImage&&{obfuscatedImage:{url:o.obfuscatedImage.url,width:o.obfuscatedImage.dimensions.width,height:o.obfuscatedImage.dimensions.height}}}}var Zp=(_=>(_.Custom="CUSTOM",_.Reddit="REDDIT",_.Instagram="INSTAGRAM",_.Twitter="TWITTER",_.Tiktok="TIKTOK",_.Twitch="TWITCH",_.Facebook="FACEBOOK",_.Youtube="YOUTUBE",_.Tumblr="TUMBLR",_.Spotify="SPOTIFY",_.Soundcloud="SOUNDCLOUD",_.Beacons="BEACONS",_.Linktree="LINKTREE",_.Discord="DISCORD",_.Venmo="VENMO",_.CashApp="CASH_APP",_.Patreon="PATREON",_.Kofi="KOFI",_.Paypal="PAYPAL",_.Cameo="CAMEO",_.Onlyfans="ONLYFANS",_.Substack="SUBSTACK",_.Kickstarter="KICKSTARTER",_.Indiegogo="INDIEGOGO",_.BuyMeACoffee="BUY_ME_A_COFFEE",_.Shopify="SHOPIFY",_))(Zp||{}),Fn,rr,xn,In,An,En,Tn,ft,Rn,On,Me,zt=class zt{constructor(e,t){l(this,Fn);l(this,rr);l(this,xn);l(this,In);l(this,An);l(this,En);l(this,Tn);l(this,ft,new Map);l(this,Rn);l(this,On);l(this,Me);K(this),p(e.id,"User ID is missing or undefined"),p(e.name,"Username is missing or undefined"),p(e.createdUtc,"User is missing created date"),a(this,Fn,te(Os(e.id)?e.id:`t2_${e.id}`)),a(this,rr,e.name),a(this,En,e.over18??!1),a(this,Tn,e.isEmployee??!1);let r=new Date(0);if(r.setUTCSeconds(e.createdUtc),a(this,xn,r),a(this,In,e.linkKarma??0),a(this,An,e.commentKarma??0),e.modPermissions)for(let[s,o]of Object.entries(e.modPermissions))n(this,ft).set(s,lc(o));a(this,Rn,new URL(e.subreddit?.url??"","https://www.reddit.com").toString()),a(this,On,e.subreddit?.url??""),a(this,Me,t)}get id(){return n(this,Fn)}get username(){return n(this,rr)}get createdAt(){return n(this,xn)}get linkKarma(){return n(this,In)}get commentKarma(){return n(this,An)}get nsfw(){return n(this,En)}get isAdmin(){return n(this,Tn)}get modPermissions(){return n(this,ft)}get url(){return n(this,Rn)}get permalink(){return n(this,On)}toJSON(){return{id:this.id,username:this.username,createdAt:this.createdAt,linkKarma:this.linkKarma,commentKarma:this.commentKarma,nsfw:this.nsfw,modPermissionsBySubreddit:Object.fromEntries(this.modPermissions)}}async getModPermissionsForSubreddit(e){if(n(this,ft).has(e))return n(this,ft).get(e);let t=await zt.getSubredditUsersByType({subredditName:e,type:"moderators",username:this.username},n(this,Me)).all();if(t.length===0)return[];let r=t[0].modPermissions.get(e)??[];return r.length>0&&n(this,ft).set(e,r),r}getComments(e){return X.getCommentsByUser({username:this.username,...e},n(this,Me))}getPosts(e){return V.getPostsByUser({username:this.username,...e},n(this,Me))}async getUserFlairBySubreddit(e){let t=await ve.getUserFlairBySubreddit({subreddit:e,name:n(this,rr)},n(this,Me));return t.users[0]?dn(t.users[0]):void 0}getSnoovatarUrl(){return zt.getSnoovatarUrl(this.username,n(this,Me))}async getSocialLinks(){let r=await Q.query("GetUserSocialLinks","2aca18ef5f4fc75fb91cdaace3e9aeeae2cb3843b5c26ad511e6f01b8521593a",{name:this.username},n(this,Me));return r.data?.user?.profile?.socialLinks?r.data.user.profile.socialLinks.map(s=>({...s,handle:s.handle??void 0})):[]}static async getById(e,t){let r=await gc(e,t);return r==null?void 0:zt.getByUsername(r,t)}static async getByUsername(e,t){let r=u.redditAPIPlugins.Users;try{let s=await r.UserAbout({username:e},t);if(s.data?.id)return new zt(s.data,t)}catch(s){if(s instanceof Error&&s.message.includes("404 Not Found"))return;throw s}}static async getFromMetadata(e,t){p(t);let r=t?.[e]?.values[0];return r?zt.getById(te(r),t):Promise.resolve(void 0)}static getSubredditUsersByType(e,t){let r=u.redditAPIPlugins.Subreddits;return new W({hasMore:!0,pageSize:e.pageSize,limit:e.limit,after:e.after,before:e.before,fetch:async s=>{let o=await r.AboutWhere({where:e.type,user:e.username,subreddit:e.subredditName,show:"all",...s},t);return Qp(o,e.subredditName,t)}})}static async createRelationship(e,t){let r=u.redditAPIPlugins.Users,{type:s,subredditName:o,username:d,permissions:c,...m}=e,y=await r.Friend({type:s,subreddit:o,name:d,permissions:c?La(c):void 0,...m},t);if(y.json?.errors?.length)throw new Error(y.json.errors.join(`
`))}static async removeRelationship(e,t){await u.redditAPIPlugins.Users.Unfriend({type:e.type,subreddit:e.subredditName,name:e.username},t)}static async setModeratorPermissions(e,t,r,s){let d=await u.redditAPIPlugins.Users.SetPermissions({subreddit:t,name:e,type:"moderator",permissions:La(r)},s);if(d.json?.errors?.length)throw new Error(d.json.errors.join(`
`))}static async getSnoovatarUrl(e,t){return(await Q.query("GetSnoovatarUrlByName","c47fd42345af268616d2d8904b56856acdc05cf61d3650380f539ad7d596ac0c",{username:e},t)).data?.redditorInfoByName?.snoovatarIcon?.url}static getOverview(e,t){let r=u.redditAPIPlugins.Users;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,async fetch(s){let o=await r.UserWhere({username:e.username,where:"overview",...s},t);return Xp(o,t)}})}};Fn=new WeakMap,rr=new WeakMap,xn=new WeakMap,In=new WeakMap,An=new WeakMap,En=new WeakMap,Tn=new WeakMap,ft=new WeakMap,Rn=new WeakMap,On=new WeakMap,Me=new WeakMap;var C=zt;function Xp(i,e){if(!i.data?.children)throw new Error("Listing response is missing children");return{children:i.data.children.map(r=>{if(r.kind==="t3")return new V(r.data,e);if(r.kind==="t1")return new X(r.data,e);throw new Error(`Type ${r.kind} is not supported`)}),before:i.data.before,after:i.data.after}}async function Qp(i,e,t){let r=u.redditAPIPlugins.Users;if(!i.data?.children)throw new Error("Listing response is missing children");let s=i.data.children.map(v=>(p(v.data?.id,"User id is still from listing data"),v.data.id)),o=100,d=[];for(let v=0;v<s.length;v+=o)d.push(s.slice(v,v+o));let m=(await Promise.all(d.map(v=>r.UserDataByAccountIds({ids:v.join(",")},t)))).reduce((v,f)=>({...v,...f.users}),{});return{children:i.data.children.map(v=>{let f=v.data?.id;p(f,"User id is missing from listing");let S=m[f];return p(S,"User data is missing from response"),new C({id:f,name:S.name,linkKarma:S.linkKarma,commentKarma:S.commentKarma,createdUtc:S.createdUtc,over18:S.profileOver18,snoovatarSize:[],modPermissions:{[e]:v.data?.modPermissions??[]}},t)}),before:i.data.before,after:i.data.after}}async function gc(i,e){return(await u.redditAPIPlugins.Users.UserDataByAccountIds({ids:i},e))?.users?.[i]?.name}async function wd(i){p(i);let e=i?.[P.Username]?.values[0];if(e)return e;let t=i?.[P.User]?.values[0];if(t)return gc(t,i)}var qt,Mn,nr,sr,Bn,Un,or,Dn,Nn,ar,bt,Ln,_n,$t,yt,vt,je,Kt,We,Hn,jn,Wn,Vn,Gn,Jn,zn,kt,Z,Be,fo,bo,H=class H{constructor(e,t){l(this,qt);l(this,Mn);l(this,nr);l(this,sr);l(this,Bn);l(this,Un);l(this,or);l(this,Dn);l(this,Nn);l(this,ar);l(this,bt);l(this,Ln);l(this,_n);l(this,$t);l(this,yt);l(this,vt);l(this,je);l(this,Kt);l(this,We);l(this,Hn);l(this,jn);l(this,Wn);l(this,Vn);l(this,Gn);l(this,Jn);l(this,zn);l(this,kt);l(this,Z);var s;K(this),p(e.id,"Comment id is null or undefined"),p(e.body,"Comment body is null or undefined"),p(e.createdUtc,"Comment is missing created date"),p(e.author,"Comment author is null or undefined"),p(e.parentId,"Comment parentId is null or undefined"),p(e.linkId,"Comment linkId is null or undefined"),p(e.permalink,"Comment permalink is null or undefined"),p(e.subreddit,"Comment is missing subreddit name"),p(e.subredditId,"Comment is missing subreddit id"),a(this,qt,Yt(`t1_${e.id}`)),a(this,Mn,e.authorFullname?te(e.authorFullname):void 0),a(this,nr,e.author),a(this,sr,e.body),a(this,Dn,$(e.subredditId)),a(this,Nn,e.subreddit),a(this,Un,Uo(e.parentId)?Yt(e.parentId):de(e.parentId)),a(this,or,de(e.linkId)),a(this,$t,e.edited??!1),a(this,yt,e.locked??!1),a(this,vt,e.removed??!1),a(this,je,e.stickied??!1),a(this,bt,e.approved??!1),a(this,Ln,e.approvedAtUtc??0),a(this,_n,e.bannedAtUtc??0),a(this,Kt,e.spam??!1),a(this,We,e.distinguished),a(this,Hn,e.numReports??0),a(this,jn,e.collapsedBecauseCrowdControl??!1),a(this,Wn,e.score??0),a(this,Vn,e.permalink),a(this,zn,new URL(e.permalink??"","https://www.reddit.com/").toString()),a(this,kt,e.ignoreReports??!1),a(this,Gn,(e.modReports??[]).map(([o])=>o)),a(this,Jn,(e.userReports??[]).map(([o])=>o));let r=new Date(0);r.setUTCSeconds(e.createdUtc),a(this,Bn,r),a(this,ar,h(s=H,Be,fo).call(s,{postId:n(this,or),commentId:n(this,qt)},t)),a(this,Z,t)}get id(){return n(this,qt)}get authorId(){return n(this,Mn)}get authorName(){return n(this,nr)}get subredditId(){return n(this,Dn)}get subredditName(){return n(this,Nn)}get body(){return n(this,sr)}get createdAt(){return n(this,Bn)}get parentId(){return n(this,Un)}get postId(){return n(this,or)}get replies(){return n(this,ar)}get distinguishedBy(){return n(this,We)}get locked(){return n(this,yt)}get stickied(){return n(this,je)}get removed(){return n(this,vt)}get approved(){return n(this,bt)}get approvedAtUtc(){return n(this,Ln)}get bannedAtUtc(){return n(this,_n)}get spam(){return n(this,Kt)}get edited(){return n(this,$t)}get numReports(){return n(this,Hn)}get collapsedBecauseCrowdControl(){return n(this,jn)}get score(){return n(this,Wn)}get permalink(){return n(this,Vn)}get userReportReasons(){return n(this,Jn)}get modReportReasons(){return n(this,Gn)}get url(){return n(this,zn)}get ignoringReports(){return n(this,kt)}toJSON(){return{id:this.id,authorName:this.authorName,subredditId:this.subredditId,subredditName:this.subredditName,body:this.body,createdAt:this.createdAt,parentId:this.parentId,postId:this.postId,replies:this.replies,approved:this.approved,locked:this.locked,removed:this.removed,stickied:this.stickied,spam:this.spam,edited:this.edited,distinguishedBy:this.distinguishedBy,numReports:this.numReports,collapsedBecauseCrowdControl:this.collapsedBecauseCrowdControl,score:this.score,permalink:this.permalink,modReportReasons:this.modReportReasons,userReportReasons:this.userReportReasons,url:this.url,ignoringReports:this.ignoringReports}}isLocked(){return n(this,yt)}isApproved(){return n(this,bt)}isRemoved(){return n(this,vt)}isSpam(){return n(this,Kt)}isStickied(){return n(this,je)}isDistinguished(){return!!n(this,We)}isEdited(){return n(this,$t)}isIgnoringReports(){return n(this,kt)}async delete(){return H.delete(this.id,n(this,Z))}async edit(e){let t=await H.edit({id:this.id,...e},n(this,Z));return a(this,sr,t.body),a(this,$t,t.edited),this}async approve(){await H.approve(this.id,n(this,Z)),a(this,bt,!0),a(this,vt,!1)}async remove(e=!1){await H.remove(this.id,e,n(this,Z)),a(this,vt,!0),a(this,Kt,e),a(this,bt,!1)}async lock(){await H.lock(this.id,n(this,Z)),a(this,yt,!0)}async unlock(){await H.unlock(this.id,n(this,Z)),a(this,yt,!1)}async reply(e){return H.submit({id:this.id,...e},n(this,Z))}async getAuthor(){return C.getByUsername(n(this,nr),n(this,Z))}async distinguish(e=!1){let{distinguishedBy:t,stickied:r}=await H.distinguish(this.id,e,!1,n(this,Z));a(this,We,t),a(this,je,r)}async distinguishAsAdmin(e=!1){let{distinguishedBy:t,stickied:r}=await H.distinguish(this.id,e,!0,n(this,Z));a(this,We,t),a(this,je,r)}async undistinguish(){let{distinguishedBy:e,stickied:t}=await H.undistinguish(this.id,n(this,Z));a(this,We,e),a(this,je,t)}async ignoreReports(){await H.ignoreReports(this.id,n(this,Z)),a(this,kt,!0)}async unignoreReports(){await H.unignoreReports(this.id,n(this,Z)),a(this,kt,!1)}addRemovalNote(e){return ye.addRemovalNote({itemIds:[n(this,qt)],...e},n(this,Z))}static async getById(e,t){let r=u.redditAPIPlugins.LinksAndComments,s=Ve(e)?e:`t1_${e}`,o=await r.Info({subreddits:[],thingIds:[s]},t);if(!o.data?.children?.[0]?.data)throw new Error("not found");return new H(o.data.children[0].data,t)}static getComments(e,t){var d;let{postId:r,commentId:s,...o}=e;return h(d=H,Be,fo).call(d,{postId:de(r),commentId:s?Yt(s):void 0,...o},t)}static async edit(e,t){let r=u.redditAPIPlugins.LinksAndComments,{id:s}=e,o;"richtext"in e&&(o=Bi(e.richtext));let d=await r.EditUserText({thingId:s,text:"text"in e?e.text:"",richtextJson:o},t);if(d.json?.errors?.length)throw new Error("Failed to edit comment");let c=d.json?.data?.things?.[0]?.data;return p(c),new H(c,t)}static async delete(e,t){await u.redditAPIPlugins.LinksAndComments.Del({id:e},t)}static async approve(e,t){await u.redditAPIPlugins.Moderation.Approve({id:e},t)}static async remove(e,t=!1,r){await u.redditAPIPlugins.Moderation.Remove({id:e,spam:t},r)}static async lock(e,t){await u.redditAPIPlugins.LinksAndComments.Lock({id:e},t)}static async unlock(e,t){await u.redditAPIPlugins.LinksAndComments.Unlock({id:e},t)}static async submit(e,t){let r=u.redditAPIPlugins.LinksAndComments,{id:s}=e,o;"richtext"in e&&(o=Bi(e.richtext));let d=await r.Comment({thingId:s,text:"text"in e?e.text:"",richtextJson:o},t);if(d.json?.errors?.length)throw new Error("failed to reply to comment");let c=d.json?.data?.things?.[0]?.data;return p(c),new H(c,t)}static async distinguish(e,t,r,s){let c=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:r?"admin":"yes",sticky:t},s)).json?.data?.things?.[0]?.data;return p(c),{distinguishedBy:c.distinguished,stickied:!!c.stickied}}static async undistinguish(e,t){let o=(await u.redditAPIPlugins.Moderation.Distinguish({id:e,how:"no",sticky:!1},t)).json?.data?.things?.[0]?.data;return p(o),{distinguishedBy:o.distinguished,stickied:!!o.stickied}}static getCommentsByUser(e,t){let r=u.redditAPIPlugins.Users;return new W({hasMore:!0,before:e.before,after:e.after,pageSize:e.pageSize,limit:e.limit,async fetch(s){let o=await r.UserWhere({username:e.username,where:"comments",...s},t);return p(o.data,"Failed to get comments for user"),{children:o.data.children?.map(c=>new H(c.data,t))||[],before:o.data.before,after:o.data.after}}})}static async ignoreReports(e,t){await u.redditAPIPlugins.Moderation.IgnoreReports({id:e},t)}static async unignoreReports(e,t){await u.redditAPIPlugins.Moderation.UnignoreReports({id:e},t)}};qt=new WeakMap,Mn=new WeakMap,nr=new WeakMap,sr=new WeakMap,Bn=new WeakMap,Un=new WeakMap,or=new WeakMap,Dn=new WeakMap,Nn=new WeakMap,ar=new WeakMap,bt=new WeakMap,Ln=new WeakMap,_n=new WeakMap,$t=new WeakMap,yt=new WeakMap,vt=new WeakMap,je=new WeakMap,Kt=new WeakMap,We=new WeakMap,Hn=new WeakMap,jn=new WeakMap,Wn=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,Jn=new WeakMap,zn=new WeakMap,kt=new WeakMap,Z=new WeakMap,Be=new WeakSet,fo=function(e,t,r=0){return new W({limit:e.limit,pageSize:e.pageSize,fetch:async s=>{var S,b;let o=s.limit,d=u.redditAPIPlugins.Listings,c=u.redditAPIPlugins.LinksAndComments,m=e.commentId;if(s.more)if(s.more.children.length){let O=s.more;(!o||o>100)&&(o=100);let L=O.children.splice(0,o),M=await c.MoreChildren({linkId:e.postId,children:L,sort:e.sort},t);if(!M.json?.data?.things?.length)return{children:[]};let{children:Y}=h(S=H,Be,bo).call(S,M.json.data.things,e.postId,e,t);return{children:Y,more:O.children.length?O:void 0}}else m=s.more.parentId,r=r+s.more.depth;let v=(await d.Comments({article:e.postId.substring(3),comment:m?.substring(3),limit:o,depth:e.depth,sort:e.sort},t)).listings?.[1]?.data?.children??[],f=v[0];return m&&f?.data?.replyList?.data&&(v=f.data.replyList.data.children),h(b=H,Be,bo).call(b,v,m??e.postId,e,t,r)}})},bo=function(e,t,r,s,o=0){var y,v;let d=[],c,m={};for(let f of e){if(!f.data||(f.data.depth!=null&&(f.data.depth=f.data.depth+o),f.data.depth!=null&&r.depth!=null&&f.data.depth>=r.depth))continue;let S=f.data.parentId?m[f.data.parentId]:void 0;if(f.kind==="t1"){if(f.data.name===t)continue;let b=new H(f.data,s);if(m[b.id]=b,a(b,ar,h(y=H,Be,fo).call(y,{...r,postId:b.postId,commentId:b.id},s,o)),"replyList"in f.data&&f.data.replyList?.data){let{children:O,more:L}=h(v=H,Be,bo).call(v,f.data.replyList.data.children,b.id,r,s,o);O.length&&b.replies.children.push(...O),L&&b.replies.setMore(L)}b.replies.preventInitialFetch(),S?S.replies.children.push(b):d.push(b)}else if(f.kind==="more"&&f.data.parentId&&f.data.depth!=null){let b={parentId:Uo(f.data.parentId)?Yt(f.data.parentId):de(f.data.parentId),children:f.data.children??[],depth:f.data.depth};S?S.replies.setMore(b):b.parentId===t&&(c=b)}}return{children:d,more:c}},l(H,Be);var X=H;function Ds(i,e){let t=u.redditAPIPlugins.Moderation;return new W({hasMore:!0,after:i.after,before:i.before,limit:i.limit,pageSize:i.pageSize,fetch:async r=>{let s=await t.AboutLog({subreddit:i.subredditName,mod:i.moderatorUsernames?i.moderatorUsernames.join(","):void 0,type:i.type,...r},e);return Yp(s)}})}function Yp(i){if(!i.data?.children)throw new Error("AboutLogResponse is missing children");return{children:i.data.children.map(t=>{if(!t.data)throw new Error("ModAction from AboutLogResponse is missing or invalid");let{id:r,mod:s,modId36:o,createdUtc:d,subreddit:c,subredditNamePrefixed:m,action:y,srId36:v,description:f,details:S,targetAuthor:b,targetBody:O,targetFullname:L,targetPermalink:M,targetTitle:Y}=t.data;p(r,"ModAction from AboutLogResponse is missing id"),p(s,"ModAction from AboutLogResponse is missing mod"),p(o,"ModAction from AboutLogResponse is missing modId36"),p(d,"ModAction from AboutLogResponse is missing createdUtc"),p(c,"ModAction from AboutLogResponse is missing subreddit"),p(m,"ModAction from AboutLogResponse is missing subredditNamePrefixed"),p(y,"ModAction from AboutLogResponse is missing action"),p(v,"ModAction from AboutLogResponse is missing srId36");let Xt=new Date(0);return Xt.setUTCSeconds(d),{id:r,type:y,moderatorName:s,moderatorId:`t2_${o}`,createdAt:Xt,subredditName:c,subredditId:`t5_${v}`,description:f,details:S,target:L?{id:L,author:b,body:O,permalink:M,title:Y}:void 0}}),after:i.data.after,before:i.data.before}}import"@devvit/protos";var eg=(d=>(d.New="New",d.InProgress="InProgress",d.Archived="Archived",d.Appeals="Appeals",d.JoinRequests="JoinRequests",d.Filtered="Filtered",d))(eg||{}),tg={0:"New",1:"InProgress",2:"Archived",3:"Appeals",4:"JoinRequests",5:"Filtered"},ig=(b=>(b.Highlighted="Highlighted",b.Unhighlighted="Unhighlighted",b.Archived="Archived",b.Unarchived="Unarchived",b.ReportedToAdmins="ReportedToAdmins",b.Muted="Muted",b.Unmuted="Unmuted",b.Banned="Banned",b.Unbanned="Unbanned",b.Approved="Approved",b.Disapproved="Disapproved",b.Filtered="Filtered",b.Unfiltered="Unfiltered",b))(ig||{}),rg={0:"Highlighted",1:"Unhighlighted",2:"Archived",3:"Unarchived",4:"ReportedToAdmins",5:"Muted",6:"Unmuted",7:"Banned",8:"Unbanned",9:"Approved",10:"Disapproved",11:"Filtered",12:"Unfiltered"},N,G,re,hc,fc,Ns=class{constructor(e){l(this,G);l(this,N);this.notificationSubjectPrefix="[notification]";a(this,N,e)}async bulkReadConversations(e,t){let r=u.redditAPIPlugins.NewModmail,{conversationIds:s}=await r.BulkReadConversations({entity:e.join(","),state:t},n(this,N));return s}async getConversations(e){let r=await u.redditAPIPlugins.NewModmail.GetConversations({after:e.after,entity:e.subreddits?e.subreddits.join(","):void 0,limit:e.limit,sort:e.sort,state:e.state},n(this,N)),s={};for(let o in r.conversations)s[o]=h(this,G,re).call(this,{protoConversation:r.conversations[o],protoMessages:r.messages,protoModActions:{}});return{conversations:s,viewerId:r.viewerId,conversationIds:r.conversationIds}}async getConversation(e){let r=await u.redditAPIPlugins.NewModmail.GetConversation({...e,markRead:!!e.markRead},n(this,N));return{participantSubreddit:r.participantSubreddit,conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async getSubreddits(){let e=u.redditAPIPlugins.NewModmail,{subreddits:t}=await e.Subreddits({},n(this,N));return t}async createConversation(e){let r=await u.redditAPIPlugins.NewModmail.CreateConversation({body:e.body,isAuthorHidden:e.isAuthorHidden??!1,srName:e.subredditName,subject:e.subject,to:e.to?e.to:void 0},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async createModDiscussionConversation(e){return Ga({subject:e.subject,bodyMarkdown:e.bodyMarkdown,subredditId:$(e.subredditId),isInternal:!0,participantType:"MODERATOR",conversationType:"INTERNAL"},n(this,N))}async createModInboxConversation(e){return Ga({subject:e.subject,bodyMarkdown:e.bodyMarkdown,subredditId:$(e.subredditId),isInternal:!1,participantType:"PARTICIPANT_USER",conversationType:"SR_USER"},n(this,N))}async createModNotification(e){let t=e.subject;return e.subject.startsWith(this.notificationSubjectPrefix)||(t=`${this.notificationSubjectPrefix} ${e.subject}`),Ga({subject:t,bodyMarkdown:e.bodyMarkdown,subredditId:$(e.subredditId),isInternal:!1,participantType:"PARTICIPANT_USER",conversationType:"SR_USER"},n(this,N))}async reply(e){let r=await u.redditAPIPlugins.NewModmail.CreateConversationMessage({body:e.body,conversationId:e.conversationId,isAuthorHidden:e.isAuthorHidden??!1,isInternal:e.isInternal??!1},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:{}}),user:r.user}}async highlightConversation(e){let r=await u.redditAPIPlugins.NewModmail.HighlightConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async unhighlightConversation(e){let r=await u.redditAPIPlugins.NewModmail.UnhighlightConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async archiveConversation(e){let r=await u.redditAPIPlugins.NewModmail.ArchiveConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async unarchiveConversation(e){let r=await u.redditAPIPlugins.NewModmail.UnarchiveConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversation,protoMessages:r.messages,protoModActions:r.modActions})}}async muteConversation(e){let r=await u.redditAPIPlugins.NewModmail.MuteConversation({conversationId:e.conversationId,numHours:e.numHours},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async unmuteConversation(e){let r=await u.redditAPIPlugins.NewModmail.UnmuteConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async readConversations(e){await u.redditAPIPlugins.NewModmail.Read({conversationIds:e.join(",")},n(this,N))}async unreadConversations(e){await u.redditAPIPlugins.NewModmail.Unread({conversationIds:e.join(",")},n(this,N))}async approveConversation(e){let r=await u.redditAPIPlugins.NewModmail.ApproveConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async disapproveConversation(e){let r=await u.redditAPIPlugins.NewModmail.DisapproveConversation({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async tempBanConversation(e){let r=await u.redditAPIPlugins.NewModmail.TempBan({...e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async unbanConversation(e){let r=await u.redditAPIPlugins.NewModmail.Unban({conversationId:e},n(this,N));return{conversation:h(this,G,re).call(this,{protoConversation:r.conversations,protoMessages:r.messages,protoModActions:r.modActions}),user:r.user}}async getUnreadCount(){return await u.redditAPIPlugins.NewModmail.UnreadCount({},n(this,N))}async getUserConversations(e){return await u.redditAPIPlugins.NewModmail.UserConversations({conversationId:e},n(this,N))}};N=new WeakMap,G=new WeakSet,re=function({protoConversation:e,protoMessages:t,protoModActions:r}){return{...e,state:tg[e.state],messages:h(this,G,hc).call(this,e,t),modActions:h(this,G,fc).call(this,e,r)}},hc=function(e,t){let r={},s=e.objIds.filter(o=>o.key==="messages").map(({id:o})=>o);for(let o of s){let d=t[o];d&&(r[o]=d)}return r},fc=function(e,t){let r={},s=e.objIds.filter(o=>o.key==="modActions").map(({id:o})=>o);for(let o of s){let d=t[o];d&&(r[o]={...d,actionType:rg[d.actionTypeId]})}return r};async function Ga(i,e){let t=e[P.AppUser]?.values[0],o=await Q.query("CreateModmailConversation","5f9ae20b0c7bdffcafb80241728a72e67cd4239bc09f67284b79d4aa706ee0e5",{subject:i.subject,bodyMarkdown:i.bodyMarkdown,subredditId:i.subredditId,authorId:t,isInternal:i.isInternal,participantType:i.participantType,conversationType:i.conversationType},e);if(o.data?.createModmailConversationV2?.ok)return o.data?.createModmailConversationV2?.conversationId;throw new Error("modmail conversation creation failed; ${response.data?.createModmailConversationV2?.errors[0].message}")}var dr,lr,qn,$n,Kn,Zn,Ja=class Ja{constructor(e,t){l(this,dr);l(this,lr);l(this,qn);l(this,$n);l(this,Kn);l(this,Zn);if(K(this),p(e.id,"PrivateMessage: Invalid data, no id"),p(e.name,"PrivateMessage: Invalid data, no name"),p(e.created,"PrivateMessage: Invalid data, no created date"),a(this,dr,he(e.name)),e.author!=null)a(this,lr,{type:"user",username:e.author,id:e.authorFullname?te(e.authorFullname):void 0});else if(e.subreddit!=null)a(this,lr,{type:"subreddit",name:e.subreddit,id:e.subredditId?$(e.subredditId):void 0});else throw new Error("PrivateMessage: Invalid data, no author or subreddit");a(this,qn,e.body??""),a(this,$n,e.bodyHtml??"");let r=new Date(0);r.setUTCSeconds(e.createdUtc),a(this,Kn,r),a(this,Zn,t)}static async getMessages(e,t){let r=u.redditAPIPlugins.PrivateMessages;return new W({...e,fetch:async s=>{let o=await r.MessageWhere({...s,where:e.type??"inbox"},t);return{after:o.data?.after,before:o.data?.before,children:o.data?.children?.map(d=>new Ja(d.data,t)).filter(Boolean)||[]}}})}static async send({to:e,subject:t,text:r},s){await u.redditAPIPlugins.PrivateMessages.Compose({to:e,subject:t,text:r,fromSr:""},s)}static async sendAsSubreddit({to:e,fromSubredditName:t,subject:r,text:s},o){await u.redditAPIPlugins.PrivateMessages.Compose({to:e,fromSr:t,subject:r,text:s},o)}static async markAllAsRead(e){await u.redditAPIPlugins.PrivateMessages.ReadAllMessages({filterTypes:""},e)}get id(){return n(this,dr)}get from(){return n(this,lr)}get body(){return n(this,qn)}get bodyHtml(){return n(this,$n)}get created(){return n(this,Kn)}async markAsRead(){await u.redditAPIPlugins.PrivateMessages.ReadMessage({id:n(this,dr)},n(this,Zn))}};dr=new WeakMap,lr=new WeakMap,qn=new WeakMap,$n=new WeakMap,Kn=new WeakMap,Zn=new WeakMap;var wt=Ja;var Fd=(o=>(o.Reports="reports",o.Spam="spam",o.Modqueue="modqueue",o.Unmoderated="unmoderated",o.Edited="edited",o))(Fd||{}),bc=class{},yc=class{},vc=class{},kc=class{},ur,F,Xn,Qn,Yn,es,ts,is,rs,ns,ss,cr,E,Ie=class Ie{constructor(e,t){l(this,ur);l(this,F);l(this,Xn);l(this,Qn);l(this,Yn);l(this,es);l(this,ts);l(this,is);l(this,rs);l(this,ns);l(this,ss);l(this,cr);l(this,E);K(this),p(e.id,"Subreddit id is missing or undefined"),p(e.displayName,"Subreddit name is missing or undefined"),a(this,ur,$(`t5_${e.id}`)),a(this,F,e.displayName),p(e.createdUtc,"Subreddit is missing created date");let r=new Date(0);r.setUTCSeconds(e.createdUtc),a(this,Xn,r),a(this,Qn,ng(e.subredditType)),a(this,Yn,e.title),a(this,es,e.description),p(e.lang,"Subreddit is missing language"),a(this,ts,e.lang),a(this,is,e.subscribers??0),a(this,rs,e.activeUserCount??0),a(this,ns,e.over18??!1),a(this,cr,e.url??""),a(this,ss,{acceptFollowers:e.acceptFollowers??!1,allOriginalContent:e.allOriginalContent??!1,allowChatPostCreation:e.allowChatPostCreation??!1,allowDiscovery:e.allowDiscovery??!1,allowGalleries:e.allowGalleries??!1,allowImages:e.allowImages??!1,allowPolls:e.allowPolls??!1,allowPredictionContributors:e.allowPredictionContributors??!1,allowPredictions:e.allowPredictions??!1,allowPredictionsTournament:e.allowPredictionsTournament??!1,allowTalks:e.allowTalks??!1,allowVideoGifs:e.allowVideogifs??!1,allowVideos:e.allowVideos??!1,chatPostEnabled:e.isChatPostFeatureEnabled??!1,collectionsEnabled:e.collectionsEnabled??!1,crosspostable:e.isCrosspostableSubreddit??!1,emojisEnabled:e.emojisEnabled??!1,eventPostsEnabled:e.eventPostsEnabled??!1,linkFlairEnabled:e.linkFlairEnabled??!1,originalContentTagEnabled:e.originalContentTagEnabled??!1,restrictCommenting:e.restrictCommenting??!1,restrictPosting:e.restrictPosting??!1,shouldArchivePosts:e.shouldArchivePosts??!1,spoilersEnabled:e.spoilersEnabled??!1,wikiEnabled:e.wikiEnabled??!1,allowedPostType:sg(e.submissionType),allowedMediaInComments:(e.allowedMediaInComments??[]).map(og),bannerBackgroundColor:e.bannerBackgroundColor,bannerBackgroundImage:e.bannerBackgroundImage,bannerImage:e.bannerImg,communityIcon:e.communityIcon,headerTitle:e.headerTitle,keyColor:e.keyColor,mobileBannerImage:e.mobileBannerImage,primaryColor:e.primaryColor,userFlairs:{enabled:e.userFlairEnabledInSr??!1,usersCanAssign:e.canAssignUserFlair??!1,userFlairBackgroundColor:e.userFlairBackgroundColor,userFlairTextColor:e.userFlairTextColor},postFlairs:{enabled:e.linkFlairEnabled??!1,usersCanAssign:e.canAssignLinkFlair??!1},url:new URL(n(this,cr),"https://www.reddit.com").toString()}),a(this,E,t)}get id(){return n(this,ur)}get name(){return n(this,F)}get createdAt(){return n(this,Xn)}get type(){return n(this,Qn)}get title(){return n(this,Yn)}get description(){return n(this,es)}get language(){return n(this,ts)}get numberOfSubscribers(){return n(this,is)}get numberOfActiveUsers(){return n(this,rs)}get nsfw(){return n(this,ns)}get settings(){return n(this,ss)}get userFlairsEnabled(){return this.settings.userFlairs.enabled}get postFlairsEnabled(){return this.settings.postFlairs.enabled}get usersCanAssignUserFlairs(){return this.settings.userFlairs.usersCanAssign}get usersCanAssignPostFlairs(){return this.settings.postFlairs.usersCanAssign}get url(){return this.settings.url}get permalink(){return n(this,cr)}toJSON(){return{id:this.id,name:this.name,createdAt:this.createdAt,type:this.type,title:this.title,description:this.description,language:this.language,nsfw:this.nsfw,numberOfSubscribers:this.numberOfSubscribers,numberOfActiveUsers:this.numberOfActiveUsers,settings:this.settings}}async submitPost(e){let t={...e,subredditName:n(this,F)};return V.submit(t,n(this,E))}getControversialPosts(e={}){if(!n(this,F))throw new Error("subreddit missing displayName - it might not have been fetched");return V.getControversialPosts({...e,subredditName:n(this,F)},n(this,E))}getTopPosts(e={}){if(!n(this,F))throw new Error("subreddit missing displayName - it might not have been fetched");return V.getTopPosts({...e,subredditName:n(this,F)},n(this,E))}getApprovedUsers(e={}){return C.getSubredditUsersByType({type:"contributors",subredditName:n(this,F),...e},n(this,E))}approveUser(e){return C.createRelationship({username:e,subredditName:n(this,F),type:"contributor"},n(this,E))}removeUser(e){return C.removeRelationship({username:e,subredditName:n(this,F),type:"contributor"},n(this,E))}getWikiContributors(e={}){return C.getSubredditUsersByType({type:"wikicontributors",subredditName:n(this,F),...e},n(this,E))}addWikiContributor(e){return C.createRelationship({username:e,subredditName:n(this,F),type:"wikicontributor"},n(this,E))}removeWikiContributor(e){return C.removeRelationship({username:e,subredditName:n(this,F),type:"wikicontributor"},n(this,E))}getBannedUsers(e={}){return C.getSubredditUsersByType({type:"banned",subredditName:n(this,F),...e},n(this,E))}banUser(e){return C.createRelationship({username:e.username,subredditName:n(this,F),type:"banned",banReason:e.reason,banMessage:e.message,note:e.note,duration:e.duration,banContext:e.context},n(this,E))}unbanUser(e){return C.removeRelationship({username:e,subredditName:n(this,F),type:"banned"},n(this,E))}getBannedWikiContributors(e={}){return C.getSubredditUsersByType({type:"wikibanned",subredditName:n(this,F),...e},n(this,E))}banWikiContributor(e){return C.createRelationship({username:e.username,subredditName:n(this,F),type:"wikibanned",banReason:e.reason,note:e.note,duration:e.duration},n(this,E))}unbanWikiContributor(e){return C.removeRelationship({username:e,subredditName:n(this,F),type:"wikibanned"},n(this,E))}getModerators(e={}){return C.getSubredditUsersByType({type:"moderators",subredditName:n(this,F),...e},n(this,E))}inviteModerator(e,t){return C.createRelationship({type:"moderator_invite",subredditName:n(this,F),username:e,permissions:t??[]},n(this,E))}revokeModeratorInvite(e){return C.removeRelationship({username:e,subredditName:n(this,F),type:"moderator_invite"},n(this,E))}removeModerator(e){return C.removeRelationship({type:"moderator",subredditName:n(this,F),username:e},n(this,E))}setModeratorPermissions(e,t){return C.setModeratorPermissions(e,n(this,F),t,n(this,E))}getMutedUsers(e={}){return C.getSubredditUsersByType({type:"muted",subredditName:n(this,F),...e},n(this,E))}muteUser(e,t){return C.createRelationship({username:e,subredditName:n(this,F),type:"muted",note:t},n(this,E))}unmuteUser(e){return C.removeRelationship({username:e,subredditName:n(this,F),type:"muted"},n(this,E))}getModerationLog(e){return Ds({subredditName:n(this,F),...e},n(this,E))}getUserFlairTemplates(){return ne.getUserFlairTemplates(n(this,F),n(this,E))}getPostFlairTemplates(){return ne.getPostFlairTemplates(n(this,F),n(this,E))}createPostFlairTemplate(e){return ne.createPostFlairTemplate({subredditName:n(this,F),...e},n(this,E))}createUserFlairTemplate(e){return ne.createUserFlairTemplate({subredditName:n(this,F),...e},n(this,E))}async getUserFlair(e){if(e?.usernames!==void 0)return{users:await Promise.all(e.usernames.map(async r=>{let s=await ve.getUserFlairBySubreddit({subreddit:n(this,F),name:r},n(this,E));return dn(s.users[0])}))};{let t=await ve.getUserFlairBySubreddit({...e,subreddit:n(this,F)},n(this,E));return{next:t.next,prev:t.prev,users:t.users.map(r=>dn(r))}}}getModQueue(e={type:"all"}){return Ie.aboutLocation({...e,location:"modqueue",subreddit:n(this,F)},n(this,E))}getReports(e={type:"all"}){return Ie.aboutLocation({...e,location:"reports",subreddit:n(this,F)},n(this,E))}getSpam(e={type:"all"}){return Ie.aboutLocation({...e,location:"spam",subreddit:n(this,F)},n(this,E))}getUnmoderated(e={type:"all"}){return Ie.aboutLocation({...e,location:"unmoderated",subreddit:n(this,F)},n(this,E))}getEdited(e={type:"all"}){return Ie.aboutLocation({...e,location:"edited",subreddit:n(this,F)},n(this,E))}static aboutLocation(e,t){let r=u.redditAPIPlugins.Moderation,s;switch(e.type){case"post":s="links";break;case"comment":s="comments";break;default:s=void 0}return new W({...e,fetch:async o=>{let d=await r.AboutLocation({...o,...e,only:s},t);return Cc(d,t)}})}getCommentsAndPostsByIds(e){let t=u.redditAPIPlugins.LinksAndComments;return new W({fetch:async()=>{let r=await t.Info({thingIds:e,subreddits:[n(this,ur)]},n(this,E));return Cc(r,n(this,E))}})}static async addRemovalReason(e,t,r,s){return(await u.redditAPIPlugins.Subreddits.SubredditAddRemovalReason({title:t,message:r,subreddit:e},s)).id}static async getRemovalReasons(e,t){let s=await u.redditAPIPlugins.Subreddits.SubredditGetRemovalReasons({subreddit:e},t);return s.order.map(o=>({...s.data[o]}))}static async getFromMetadata(e){p(e);let t=e?.[P.SubredditName]?.values[0];if(t)return Ie.getByName(t,e);let r=e?.[P.Subreddit]?.values[0];return p(r),Ie.getById($(r),e)}static async getById(e,t){let r=await Wo(e,t);if(r)return Ie.getByName(r,t)}static async getByName(e,t){let s=await u.redditAPIPlugins.Subreddits.SubredditAbout({subreddit:e},t);if(!s?.data)throw new Error("not found");return new Ie(s.data,t)}};ur=new WeakMap,F=new WeakMap,Xn=new WeakMap,Qn=new WeakMap,Yn=new WeakMap,es=new WeakMap,ts=new WeakMap,is=new WeakMap,rs=new WeakMap,ns=new WeakMap,ss=new WeakMap,cr=new WeakMap,E=new WeakMap;var le=Ie;async function xd(i,e){let o=(await Q.query("GetSubredditInfoById","315a9b75c22a017d526afdf2d274616946156451aacfd56dfb91e7ad3f7a2fde",{id:i},e)).data?.subredditInfoById;if(!o)throw new Error("subreddit info not found");return o}async function Id(i,e){let o=(await Q.query("GetSubredditInfoByName","4aa69726c7e3f5d33ab2bee22b3d74fce645824fddd5ea3ec6dfe30bdb4295cb",{name:i},e)).data?.subredditInfoByName;if(!o)throw new Error("subreddit info not found");return o}async function Ad(i,e){let o=(await Q.query("GetSubredditLeaderboard","18ead70c46b6446d45ecd8b679b16d9a929a933d6ef25d8262a459cb18b72848",{id:i},e)).data?.subredditInfoById?.leaderboard;if(!o)throw new Error("subreddit leaderboard not found");if(!o.summary)throw new Error("subreddit leaderboard summary not found");return{id:o.id,summary:o.summary}}async function Ed(i,e){let o=(await Q.query("GetSubredditStyles","d491d17ea8858f563ea578b26b9595d64adecf4bf34557d567c7e53c470f5f22",{id:i},e)).data?.subredditInfoById?.styles;if(!o)throw new Error("subreddit styles not found");return o}function ng(i){if(i==="public"||i==="private"||i==="restricted"||i==="employees_only"||i==="gold_only"||i==="gold_restricted"||i==="archived"||i==="user")return i;throw new Error(`invalid subreddit type: ${i}`)}function sg(i){if(i==="any"||i==="link"||i==="self")return i;throw new Error(`invalid allowed post type: ${i}`)}function og(i){if(i==="animated"||i==="giphy"||i==="static"||i==="expression")return i;throw new Error(`invalid comment media type: ${i}`)}function Cc(i,e){let r=(i.data?.children??[]).map(d=>{let c=s(d);if(c!=null)return c;let m=o(d);return m??null}).filter(Boolean);return{after:i.data?.after,before:i.data?.before,children:r};function s(d){try{return new V(d.data,e)}catch{return null}}function o(d){try{return new X(d.data,e)}catch{return null}}}async function Wo(i,e){return(await u.redditAPIPlugins.LinksAndComments.Info({thingIds:[i],subreddits:[]},e)).data?.children[0]?.data?.displayName}async function Td(i,e){return Sc("GetVaultContactByAddress","3e2f7966a5c120e64fd2795d06a46595c52d988185be98d3ed71c3f81ae80d2e",{provider:"ethereum",address:i},e)}async function Rd(i,e){return Sc("GetVaultContactByUserId","a854ddc19d0e22c4f36ed917fdbd568f299f3571427e393aee5e2972080fffe9",{provider:"ethereum",userId:i},e)}async function Sc(i,e,t,r){let o=(await Q.query(i,e,t,r))?.data?.vault?.contact;return{provider:o?.provider,userId:te(o?.userId),address:o?.address,createdAt:o?.createdAt,isActive:o?.isActive}}import{CommunityListWidget_CommunityData as ag,GetWidgetsResponse_WidgetItem as ae}from"@devvit/protos";var os,as,ds,ls,qa=class qa{constructor(e,t,r){l(this,os);l(this,as);l(this,ds);l(this,ls);K(this),a(this,os,e.id),a(this,as,e.shortName),a(this,ds,t),a(this,ls,r)}get id(){return n(this,os)}get name(){return n(this,as)}get subredditName(){return n(this,ds)}toJSON(){return{id:this.id,name:this.name,subredditName:this.subredditName}}delete(){return qa.delete(this.subredditName,this.id,n(this,ls))}static async getWidgets(e,t){let s=await u.redditAPIPlugins.Widgets.GetWidgets({subreddit:e},t);p(s.layout,"Failed to load widgets for subreddit");let o=s.items,d=[];for(let c of s.layout.sidebar?.order??[]){let m=o[c];switch(m?.kind){case"image":d.push(new yo(m,e,t));break;case"calendar":d.push(new vo(m,e,t));break;case"textarea":d.push(new ko(m,e,t));break;case"button":d.push(new Co(m,e,t));break;case"community-list":d.push(new So(m,e,t));break;case"post-flair":d.push(new Po(m,e,t));break;case"custom":d.push(new wo(m,e,t));break;case"subreddit-rules":{let y=await u.redditAPIPlugins.Subreddits.SubredditAboutRules({subreddit:e},t);d.push(new za(y,m,e,t));break}default:throw new Error(`Unknown widget type: ${m.kind}`)}}return d}static async delete(e,t,r){await u.redditAPIPlugins.Widgets.DeleteWidget({subreddit:e,id:t},r)}static async reorder(e,t,r){await u.redditAPIPlugins.Widgets.OrderWidgets({subreddit:e,order:t},r)}static async add(e,t){switch(e?.type){case"image":return yo.create(e,t);case"calendar":return vo.create(e,t);case"textarea":return ko.create(e,t);case"button":return Co.create(e,t);case"community-list":return So.create(e,t);case"post-flair":return Po.create(e,t);case"custom":return wo.create(e,t);default:throw new Error("Unknown widget type")}}};os=new WeakMap,as=new WeakMap,ds=new WeakMap,ls=new WeakMap;var ie=qa,us,Fo=class Fo extends ie{constructor(t,r,s){super(t,r,s);l(this,us);a(this,us,t.data.map(o=>(p(o.url,"Image widget data is missing url"),p(o.height,"Image widget data is missing height"),p(o.width,"Image widget data is missing width"),p(o.linkUrl,"Image widget data is missing linkUrl"),{url:o.url,height:o.height,width:o.width,linkUrl:o.linkUrl})))}get images(){return n(this,us)}toJSON(){return{...super.toJSON(),images:this.images}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddImageWidget(t,r);return new Fo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateImageWidget(t,r);return new Fo(ae.fromJSON(o),t.subreddit,r)}};us=new WeakMap;var yo=Fo,cs,ms,ps,xo=class xo extends ie{constructor(t,r,s){super(t,r,s);l(this,cs);l(this,ms);l(this,ps);p(t.googleCalendarId,"Calendar widget data is missing googleCalendarId"),p(t.configuration,"Calendar widget data is missing configuration"),p(t.styles,"Calendar widget data is missing styles"),a(this,cs,t.googleCalendarId),a(this,ms,t.configuration),a(this,ps,t.styles)}get googleCalendarId(){return n(this,cs)}get configuration(){return n(this,ms)}get styles(){return n(this,ps)}toJSON(){return{...super.toJSON(),googleCalendarId:this.googleCalendarId,configuration:this.configuration,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddCalendarWidget(t,r);return new xo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateCalendarWidget(t,r);return new xo(ae.fromJSON(o),t.subreddit,r)}};cs=new WeakMap,ms=new WeakMap,ps=new WeakMap;var vo=xo,gs,hs,Io=class Io extends ie{constructor(t,r,s){super(t,r,s);l(this,gs);l(this,hs);p(t.text,"Textarea widget data is missing text"),p(t.styles,"Textarea widget data is missing styles"),a(this,gs,t.text),a(this,hs,t.styles)}get text(){return n(this,gs)}get styles(){return n(this,hs)}toJSON(){return{...super.toJSON(),text:this.text,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddTextAreaWidget(t,r);return new Io(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateTextAreaWidget(t,r);return new Io(ae.fromJSON(o),t.subreddit,r)}};gs=new WeakMap,hs=new WeakMap;var ko=Io,fs,bs,ys,Ao=class Ao extends ie{constructor(t,r,s){super(t,r,s);l(this,fs);l(this,bs);l(this,ys);p(t.styles,"Button widget data is missing styles"),a(this,fs,t.buttons),a(this,bs,t.description??""),a(this,ys,t.styles)}get buttons(){return n(this,fs)}get description(){return n(this,bs)}get styles(){return n(this,ys)}toJSON(){return{...super.toJSON(),buttons:this.buttons,description:this.description,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddButtonWidget(t,r);return new Ao(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateButtonWidget(t,r);return new Ao(ae.fromJSON(o),t.subreddit,r)}};fs=new WeakMap,bs=new WeakMap,ys=new WeakMap;var Co=Ao,vs,ks,Eo=class Eo extends ie{constructor(t,r,s){super(t,r,s);l(this,vs);l(this,ks);a(this,vs,t.data.map(o=>ag.fromJSON(o))),p(t.styles,"Community list widget data is missing styles"),a(this,ks,t.styles)}get communities(){return n(this,vs)}get styles(){return n(this,ks)}toJSON(){return{...super.toJSON(),communities:this.communities,styles:this.styles}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddCommunityListWidget(t,r);return new Eo(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateCommunityListWidget(t,r);return new Eo(ae.fromJSON(o),t.subreddit,r)}};vs=new WeakMap,ks=new WeakMap;var So=Eo,Cs,Ss,Ps,To=class To extends ie{constructor(t,r,s){super(t,r,s);l(this,Cs);l(this,Ss);l(this,Ps);if(p(t.styles,"Post flair widget data is missing styles"),a(this,Cs,t.styles),a(this,Ss,t.order.map(o=>t.templates[o])),!(t.display&&t.display==="list"||t.display==="cloud"))throw new Error("Post flair widget data is missing display type");a(this,Ps,t.display)}get styles(){return n(this,Cs)}get templates(){return n(this,Ss)}get display(){return n(this,Ps)}toJSON(){return{...super.toJSON(),styles:this.styles,templates:this.templates,display:this.display}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddPostFlairWidget(t,r);return new To(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdatePostFlairWidget(t,r);return new To(ae.fromJSON(o),t.subreddit,r)}};Cs=new WeakMap,Ss=new WeakMap,Ps=new WeakMap;var Po=To,ws,Fs,xs,Is,As,Ro=class Ro extends ie{constructor(t,r,s){super(t,r,s);l(this,ws);l(this,Fs);l(this,xs);l(this,Is);l(this,As);p(t.stylesheetUrl,"Custom widget data is missing stylesheetUrl"),p(t.height,"Custom widget data is missing height"),p(t.css,"Custom widget data is missing css"),a(this,ws,t.imageData??[]),a(this,Fs,t.text??""),a(this,xs,t.stylesheetUrl),a(this,Is,t.height),a(this,As,t.css)}get images(){return n(this,ws)}get text(){return n(this,Fs)}get stylesheetUrl(){return n(this,xs)}get height(){return n(this,Is)}get css(){return n(this,As)}toJSON(){return{...super.toJSON(),images:this.images,text:this.text,stylesheetUrl:this.stylesheetUrl,height:this.height,css:this.css}}static async create(t,r){let o=await u.redditAPIPlugins.Widgets.AddCustomWidget(t,r);return new Ro(ae.fromJSON(o),t.subreddit,r)}static async update(t,r){let o=await u.redditAPIPlugins.Widgets.UpdateCustomWidget(t,r);return new Ro(ae.fromJSON(o),t.subreddit,r)}};ws=new WeakMap,Fs=new WeakMap,xs=new WeakMap,Is=new WeakMap,As=new WeakMap;var wo=Ro,Es,za=class extends ie{constructor(t,r,s,o){super(r,s,o);l(this,Es);let d=t.rules.map(({description:c,priority:m,shortName:y,violationReason:v})=>(p(c,"Subreddit rule is missing description"),p(m,"Subreddit rule is missing priority"),p(y,"Subreddit rule is missing shortName"),p(v,"Subreddit rule is missing violationReason"),{description:c,priority:m,shortName:y,violationReason:v}));a(this,Es,d)}get rules(){return n(this,Es)}toJSON(){return{...super.toJSON(),rules:this.rules}}};Es=new WeakMap;var dg=(r=>(r[r.SUBREDDIT_PERMISSIONS=0]="SUBREDDIT_PERMISSIONS",r[r.APPROVED_CONTRIBUTORS_ONLY=1]="APPROVED_CONTRIBUTORS_ONLY",r[r.MODS_ONLY=2]="MODS_ONLY",r))(dg||{}),pe,ge,mr,pr,gr,hr,fr,br,Ae,we=class we{constructor(e,t,r,s){l(this,pe);l(this,ge);l(this,mr);l(this,pr);l(this,gr);l(this,hr);l(this,fr);l(this,br);l(this,Ae);K(this),a(this,pe,e),a(this,ge,t),a(this,mr,r.contentMd),a(this,pr,r.contentHtml),a(this,gr,r.revisionId),a(this,hr,new Date(r.revisionDate*1e3)),a(this,fr,r.reason??""),a(this,br,r.revisionBy?.data?new C(r.revisionBy.data,s):void 0),a(this,Ae,s)}get name(){return n(this,pe)}get subredditName(){return n(this,ge)}get content(){return n(this,mr)}get contentHtml(){return n(this,pr)}get revisionId(){return n(this,gr)}get revisionDate(){return n(this,hr)}get revisionReason(){return n(this,fr)}get revisionAuthor(){return n(this,br)}toJSON(){return{name:n(this,pe),subredditName:n(this,ge),content:n(this,mr),contentHtml:n(this,pr),revisionId:n(this,gr),revisionDate:n(this,hr),revisionReason:n(this,fr),revisionAuthor:n(this,br)?.toJSON()}}async update(e,t){return we.updatePage({subredditName:n(this,ge),page:n(this,pe),content:e,reason:t},n(this,Ae))}async getRevisions(e){return we.getPageRevisions({subredditName:n(this,ge),page:n(this,pe),...e},n(this,Ae))}async revertTo(e){return we.revertPage(n(this,ge),n(this,pe),e,n(this,Ae))}async getSettings(){return we.getPageSettings(n(this,ge),n(this,pe),n(this,Ae))}async updateSettings(e){return we.updatePageSettings({subredditName:n(this,ge),page:n(this,pe),listed:e.listed,permLevel:e.permLevel},n(this,Ae))}async addEditor(e){return we.addEditor(n(this,ge),n(this,pe),e,n(this,Ae))}async removeEditor(e){return we.removeEditor(n(this,ge),n(this,pe),e,n(this,Ae))}static async getPage(e,t,r){let o=await u.redditAPIPlugins.Wiki.GetWikiPage({subreddit:e,page:t},r);return p(o.data,"Failed to get wiki page"),new we(t,e,o.data,r)}static async getPages(e,t){return(await u.redditAPIPlugins.Wiki.GetWikiPages({subreddit:e},t)).data||[]}static async createPage(e,t){return we.updatePage(e,t)}static async updatePage(e,t){return await u.redditAPIPlugins.Wiki.EditWikiPage({subreddit:e.subredditName,page:e.page,content:e.content,reason:e.reason??""},t),we.getPage(e.subredditName,e.page,t)}static getPageRevisions(e,t){let r=u.redditAPIPlugins.Wiki;return new W({hasMore:!0,after:e.after,limit:e.limit,pageSize:e.pageSize,async fetch(s){let o=await r.GetWikiPageRevisions({subreddit:e.subredditName,page:e.page,limit:s.limit,after:s.after,before:s.before},t);return lg(o,t)}})}static async revertPage(e,t,r,s){await u.redditAPIPlugins.Wiki.RevertWikiPage({subreddit:e,page:t,revision:r},s)}static async getPageSettings(e,t,r){let o=await u.redditAPIPlugins.Wiki.GetWikiPageSettings({subreddit:e,page:t},r);return p(o.data,"Failed to get wiki page settings"),new Oo(o.data,r)}static async updatePageSettings(e,t){let s=await u.redditAPIPlugins.Wiki.UpdateWikiPageSettings({subreddit:e.subredditName,page:e.page,listed:e.listed?"on":"",permlevel:e.permLevel},t);return p(s.data,"Failed to update wiki page settings"),new Oo(s.data,t)}static async addEditor(e,t,r,s){await u.redditAPIPlugins.Wiki.AllowEditor({act:"add",subreddit:e,page:t,username:r},s)}static async removeEditor(e,t,r,s){await u.redditAPIPlugins.Wiki.AllowEditor({act:"del",subreddit:e,page:t,username:r},s)}};pe=new WeakMap,ge=new WeakMap,mr=new WeakMap,pr=new WeakMap,gr=new WeakMap,hr=new WeakMap,fr=new WeakMap,br=new WeakMap,Ae=new WeakMap;var ue=we,yr,vr,kr,Cr,Sr,Pr,$a=class{constructor(e,t){l(this,yr);l(this,vr);l(this,kr);l(this,Cr);l(this,Sr);l(this,Pr);a(this,yr,e.id),a(this,vr,e.page),a(this,kr,new Date(e.timestamp)),p(e.author?.data,"Wiki page revision author details are missing"),a(this,Cr,new C(e.author.data,t)),a(this,Sr,e.reason??""),a(this,Pr,e.revisionHidden??!1)}get id(){return n(this,yr)}get page(){return n(this,vr)}get date(){return n(this,kr)}get author(){return n(this,Cr)}get reason(){return n(this,Sr)}get hidden(){return n(this,Pr)}toJSON(){return{id:n(this,yr),page:n(this,vr),date:n(this,kr),author:n(this,Cr).toJSON(),reason:n(this,Sr),hidden:n(this,Pr)}}};yr=new WeakMap,vr=new WeakMap,kr=new WeakMap,Cr=new WeakMap,Sr=new WeakMap,Pr=new WeakMap;var wr,Fr,xr,Oo=class{constructor(e,t){l(this,wr);l(this,Fr);l(this,xr);a(this,wr,e.listed),a(this,Fr,e.permLevel),a(this,xr,e.editors.map(r=>(p(r.data,"Wiki page editor details are missing"),new C(r.data,t))))}get listed(){return n(this,wr)}get permLevel(){return n(this,Fr)}get editors(){return n(this,xr)}toJSON(){return{listed:n(this,wr),permLevel:n(this,Fr),editors:n(this,xr).map(e=>e.toJSON())}}};wr=new WeakMap,Fr=new WeakMap,xr=new WeakMap;function lg(i,e){return p(i.data?.children,"Wiki page revision listing is missing children"),{children:i.data.children.map(r=>new $a(r,e)),before:i.data.before,after:i.data.after}}var ug=["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"],cg=["border-image","border-image-source","behavior","expression","list-style-image","cursor","content"],mg=["onload","onerror","onclick","onmouseover"];function pg(i){return/xmlns=["']http:\/\/www\.w3\.org\/2000\/svg["']/.test(i)?i:i.replace(/<svg\b/,'<svg xmlns="http://www.w3.org/2000/svg"')}function Pc(i){if(i){if(!i.trim().startsWith("<svg")){console.log("The provided string is not a valid SVG.");return}try{let e=new RegExp(`<\\s*(${ug.join("|")})\\b`,"gi"),t=new RegExp(`(${cg.join("|")})\\s*:\\s*url\\s*\\((['"]?)(.*?)\\2\\)`,"gi"),r=new RegExp(`(${mg.join("|")})\\s*(=\\s*(['"]?)(.*?)\\3)?`,"gi");i=i.trim().replace(/\s+/g," "),i=pg(i);let s=i.match(e)||[],o=i.match(t)||[],d=i.match(r)||[],c=!1;return s.length>0&&(c=!0,console.warn(`Disallowed elements detected in SVG: ${s.map(m=>m.replace("<","")).join(", ")}`)),o.length>0&&(c=!0,console.warn(`Disallowed styles detected in SVG: ${o.map(m=>m.split(":")[0]).join(", ")}`)),d.length>0&&(c=!0,console.warn(`Disallowed attributes detected in SVG: ${d.map(m=>m.split("=")[0]).join(", ")}`)),c?void 0:i}catch{return}}}function TS(i,...e){let t="";return i.forEach((r,s)=>{t+=r;let o=e[s];o!==void 0&&(t+=`${o}`)}),t=Pc(t),t===void 0?"":`data:image/svg+xml;charset=UTF-8,${encodeURIComponent(t)}`}import{EffectType as wc}from"@devvit/protos";import{WebViewVisibility as gg}from"@devvit/protos";var Ir,Ts,Rs,Ar,Zt,Ka=class{constructor(e,t){this.state={messageCount:0};l(this,Ir);l(this,Ts);l(this,Rs);l(this,Ar);l(this,Zt);this.postMessage=e=>{n(this,Zt).emitEffect(`postMessage${this.state.messageCount++}`,{type:wc.EFFECT_WEB_VIEW,webView:{postMessage:{webViewId:n(this,Ir),app:{message:e}}}})};this.mount=()=>{let t=(n(this,Zt)?.devvitContext?.assets).getURL(n(this,Ts),{webView:!0});if(!t)throw Error("useWebView fullscreen request failed; web view asset could not be found");n(this,Zt).emitEffect("fullscreen",{type:wc.EFFECT_WEB_VIEW,webView:{fullscreen:{id:n(this,Ir),show:!0,url:t}}})};a(this,Ts,t.url??"index.html"),a(this,Ir,e.hookId),a(this,Rs,t.onMessage),a(this,Ar,t.onUnmount),a(this,Zt,e.context)}async onUIEvent(e){if(e.webView?.fullScreen)!(e.webView.fullScreen.visibility===gg.WEBVIEW_VISIBLE)&&n(this,Ar)&&await n(this,Ar).call(this,this);else if(e.webView?.postMessage){let{message:t}=e.webView.postMessage;await n(this,Rs).call(this,t,this)}}};Ir=new WeakMap,Ts=new WeakMap,Rs=new WeakMap,Ar=new WeakMap,Zt=new WeakMap;function hg(i){let e=ce({namespace:"useWebView",initializer:t=>new Ka(t,i)});return{postMessage:e.postMessage,mount:e.mount}}export{xg as ALL_ICON_NAMES,Fd as AboutLocations,vc as AuthorFlairSettings,Co as ButtonWidget,vo as CalendarWidget,X as Comment,So as CommunityListWidget,wo as CustomWidget,u as Devvit,ve as Flair,ne as FlairTemplate,Up as FlairType,Ge as Hook,yo as ImageWidget,W as Listing,ig as ModMailActionType,eg as ModMailConversationState,Ns as ModMailService,ye as ModNote,V as Post,kc as PostFlairSettings,Po as PostFlairWidget,wt as PrivateMessage,Lt as RichTextBuilder,Do as SettingScope,Zp as SocialLinkType,le as Subreddit,bc as SubredditDescription,za as SubredditRulesWidget,yc as SubredditWikiSettings,ko as TextAreaWidget,C as User,ie as Widget,ue as WikiPage,dg as WikiPagePermissionLevel,$a as WikiPageRevision,Oo as WikiPageSettings,dn as convertUserFlairProtoToAPI,wd as getCurrentUsernameFromMetadata,Ds as getModerationLog,xd as getSubredditInfoById,Id as getSubredditInfoByName,Ad as getSubredditLeaderboard,Wo as getSubredditNameById,Ed as getSubredditStyles,Td as getVaultByAddress,Rd as getVaultByUserId,TS as svg,Cp as useAsync,Ca as useChannel,ya as useForm,wa as useInterval,Aa as useState,hg as useWebView};
/*! Bundled license information:

shallow-clone/index.js:
  (*!
   * shallow-clone <https://github.com/jonschlinkert/shallow-clone>
   *
   * Copyright (c) 2015-present, Jon Schlinkert.
   * Released under the MIT License.
   *)

isobject/index.js:
  (*!
   * isobject <https://github.com/jonschlinkert/isobject>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   *)

is-plain-object/index.js:
  (*!
   * is-plain-object <https://github.com/jonschlinkert/is-plain-object>
   *
   * Copyright (c) 2014-2017, Jon Schlinkert.
   * Released under the MIT License.
   *)
*/
//# sourceMappingURL=public-api.min.js.map
